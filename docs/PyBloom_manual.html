<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=na2xy4REgy2vjVAZtpZNcyWqADZi4Syx-AEk2KH_Q_ghpxpI3AaQyNkCBlHoR0O4');.lst-kix_cj425lmmnyn-5>li:before{content:"\0025a0  "}.lst-kix_cj425lmmnyn-3>li:before{content:"\0025cf  "}.lst-kix_cj425lmmnyn-7>li:before{content:"\0025cb  "}.lst-kix_h6b3e0fu5msk-0>li:before{content:"\0025cf  "}ol.lst-kix_6y0i73whe6lv-4.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-4 0}.lst-kix_cj425lmmnyn-4>li:before{content:"\0025cb  "}.lst-kix_cj425lmmnyn-8>li:before{content:"\0025a0  "}.lst-kix_cj425lmmnyn-6>li:before{content:"\0025cf  "}.lst-kix_qkzlw47atwrv-0>li:before{content:"\0025cf  "}.lst-kix_h6b3e0fu5msk-7>li:before{content:"\0025cb  "}.lst-kix_cj425lmmnyn-0>li:before{content:"\0025cf  "}.lst-kix_cj425lmmnyn-1>li:before{content:"\0025cb  "}.lst-kix_h6b3e0fu5msk-8>li:before{content:"\0025a0  "}.lst-kix_x8wmrurtf44y-5>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-5}.lst-kix_cj425lmmnyn-2>li:before{content:"\0025a0  "}ol.lst-kix_fk6b7sf0hlj1-1.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-1 0}.lst-kix_i5xp5zly0jsh-4>li:before{content:"\0025cb  "}.lst-kix_i5xp5zly0jsh-5>li:before{content:"\0025a0  "}ol.lst-kix_fzq4hyp3z704-2.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-2 0}.lst-kix_i5xp5zly0jsh-2>li:before{content:"\0025a0  "}.lst-kix_i5xp5zly0jsh-6>li:before{content:"\0025cf  "}.lst-kix_6y0i73whe6lv-6>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-6}.lst-kix_p9jeeg26zh3l-7>li:before{content:"\0025cb  "}.lst-kix_p9jeeg26zh3l-8>li:before{content:"\0025a0  "}.lst-kix_i5xp5zly0jsh-3>li:before{content:"\0025cf  "}ul.lst-kix_lfztvpyzdcg4-0{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-1{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-2{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-3{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-4{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-5{list-style-type:none}.lst-kix_i5xp5zly0jsh-0>li:before{content:"\0025cf  "}.lst-kix_i5xp5zly0jsh-1>li:before{content:"\0025cb  "}.lst-kix_qkzlw47atwrv-6>li:before{content:"\0025cf  "}.lst-kix_qkzlw47atwrv-5>li:before{content:"\0025a0  "}.lst-kix_qkzlw47atwrv-7>li:before{content:"\0025cb  "}ol.lst-kix_fk6b7sf0hlj1-6.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-6 0}.lst-kix_qkzlw47atwrv-4>li:before{content:"\0025cb  "}.lst-kix_qkzlw47atwrv-8>li:before{content:"\0025a0  "}.lst-kix_cg5y8vd7hzo1-6>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-6}.lst-kix_qkzlw47atwrv-2>li:before{content:"\0025a0  "}ul.lst-kix_lfztvpyzdcg4-6{list-style-type:none}ul.lst-kix_lfztvpyzdcg4-7{list-style-type:none}.lst-kix_p9jeeg26zh3l-0>li:before{content:"\0025cf  "}.lst-kix_qkzlw47atwrv-1>li:before{content:"\0025cb  "}.lst-kix_qkzlw47atwrv-3>li:before{content:"\0025cf  "}ul.lst-kix_lfztvpyzdcg4-8{list-style-type:none}.lst-kix_p9jeeg26zh3l-1>li:before{content:"\0025cb  "}.lst-kix_h6b3e0fu5msk-6>li:before{content:"\0025cf  "}.lst-kix_p9jeeg26zh3l-3>li:before{content:"\0025cf  "}.lst-kix_h6b3e0fu5msk-4>li:before{content:"\0025cb  "}.lst-kix_h6b3e0fu5msk-5>li:before{content:"\0025a0  "}.lst-kix_p9jeeg26zh3l-2>li:before{content:"\0025a0  "}.lst-kix_p9jeeg26zh3l-4>li:before{content:"\0025cb  "}.lst-kix_h6b3e0fu5msk-3>li:before{content:"\0025cf  "}.lst-kix_h6b3e0fu5msk-1>li:before{content:"\0025cb  "}.lst-kix_i5xp5zly0jsh-8>li:before{content:"\0025a0  "}.lst-kix_p9jeeg26zh3l-6>li:before{content:"\0025cf  "}.lst-kix_p9jeeg26zh3l-5>li:before{content:"\0025a0  "}.lst-kix_h6b3e0fu5msk-2>li:before{content:"\0025a0  "}.lst-kix_i5xp5zly0jsh-7>li:before{content:"\0025cb  "}.lst-kix_56dz60690vq9-4>li:before{content:"\0025cb  "}.lst-kix_56dz60690vq9-8>li:before{content:"\0025a0  "}ol.lst-kix_x8wmrurtf44y-8.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-8 0}.lst-kix_56dz60690vq9-6>li:before{content:"\0025cf  "}.lst-kix_uzoy1gxgh4yr-5>li:before{content:"\0025a0  "}ol.lst-kix_58h2zo181w0b-8.start{counter-reset:lst-ctn-kix_58h2zo181w0b-8 0}.lst-kix_56dz60690vq9-0>li:before{content:"\0025cf  "}.lst-kix_uzoy1gxgh4yr-1>li:before{content:"\0025cb  "}.lst-kix_uzoy1gxgh4yr-3>li:before{content:"\0025cf  "}.lst-kix_56dz60690vq9-2>li:before{content:"\0025a0  "}ul.lst-kix_56dz60690vq9-0{list-style-type:none}.lst-kix_25plgfjdzvww-5>li:before{content:"\0025a0  "}.lst-kix_5lajacp8xtx-2>li:before{content:"\0025a0  "}ul.lst-kix_56dz60690vq9-2{list-style-type:none}ul.lst-kix_56dz60690vq9-1{list-style-type:none}ul.lst-kix_56dz60690vq9-4{list-style-type:none}.lst-kix_25plgfjdzvww-3>li:before{content:"\0025cf  "}.lst-kix_25plgfjdzvww-7>li:before{content:"\0025cb  "}ul.lst-kix_56dz60690vq9-3{list-style-type:none}ul.lst-kix_56dz60690vq9-6{list-style-type:none}ul.lst-kix_56dz60690vq9-5{list-style-type:none}ul.lst-kix_56dz60690vq9-8{list-style-type:none}ul.lst-kix_56dz60690vq9-7{list-style-type:none}.lst-kix_5lajacp8xtx-0>li:before{content:"\0025cf  "}ul.lst-kix_4b7n7ocx3ukf-0{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-1{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-4{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-5{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-2{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-3{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-8{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-6{list-style-type:none}ul.lst-kix_4b7n7ocx3ukf-7{list-style-type:none}ul.lst-kix_qbgeynhpr352-4{list-style-type:none}ul.lst-kix_qbgeynhpr352-3{list-style-type:none}ul.lst-kix_qbgeynhpr352-6{list-style-type:none}ol.lst-kix_3af0dumxif4f-0.start{counter-reset:lst-ctn-kix_3af0dumxif4f-0 0}ul.lst-kix_qbgeynhpr352-5{list-style-type:none}ul.lst-kix_qbgeynhpr352-0{list-style-type:none}ul.lst-kix_qbgeynhpr352-2{list-style-type:none}ul.lst-kix_qbgeynhpr352-1{list-style-type:none}.lst-kix_3af0dumxif4f-3>li{counter-increment:lst-ctn-kix_3af0dumxif4f-3}ul.lst-kix_qbgeynhpr352-8{list-style-type:none}ul.lst-kix_qbgeynhpr352-7{list-style-type:none}.lst-kix_1ufwrhq5s9bo-5>li:before{content:"\0025a0  "}.lst-kix_25plgfjdzvww-1>li:before{content:"\0025cb  "}.lst-kix_1ufwrhq5s9bo-7>li:before{content:"\0025cb  "}.lst-kix_5lajacp8xtx-4>li:before{content:"\0025cb  "}.lst-kix_1ufwrhq5s9bo-1>li:before{content:"\0025cb  "}.lst-kix_i2pzk9m7og7r-7>li:before{content:"\0025cb  "}.lst-kix_5lajacp8xtx-6>li:before{content:"\0025cf  "}.lst-kix_5lajacp8xtx-8>li:before{content:"\0025a0  "}.lst-kix_1ufwrhq5s9bo-3>li:before{content:"\0025cf  "}.lst-kix_i2pzk9m7og7r-1>li:before{content:"\0025cb  "}.lst-kix_uzoy1gxgh4yr-7>li:before{content:"\0025cb  "}.lst-kix_i2pzk9m7og7r-3>li:before{content:"\0025cf  "}.lst-kix_i2pzk9m7og7r-5>li:before{content:"\0025a0  "}ol.lst-kix_fzq4hyp3z704-4{list-style-type:none}ul.lst-kix_bbe3apiqyqg-0{list-style-type:none}.lst-kix_t561m010kzjr-4>li:before{content:"\0025cb  "}ol.lst-kix_fzq4hyp3z704-3{list-style-type:none}.lst-kix_j57fv3wuyn3u-6>li:before{content:"\0025cf  "}ol.lst-kix_fzq4hyp3z704-6{list-style-type:none}ul.lst-kix_bbe3apiqyqg-2{list-style-type:none}ol.lst-kix_fzq4hyp3z704-5{list-style-type:none}ul.lst-kix_bbe3apiqyqg-1{list-style-type:none}.lst-kix_sdoc5wmcfyvd-1>li:before{content:"\0025cb  "}.lst-kix_sdoc5wmcfyvd-5>li:before{content:"\0025a0  "}ol.lst-kix_fzq4hyp3z704-8{list-style-type:none}ul.lst-kix_bbe3apiqyqg-4{list-style-type:none}ol.lst-kix_fzq4hyp3z704-7{list-style-type:none}ul.lst-kix_bbe3apiqyqg-3{list-style-type:none}.lst-kix_j57fv3wuyn3u-3>li:before{content:"\0025cf  "}.lst-kix_j57fv3wuyn3u-7>li:before{content:"\0025cb  "}.lst-kix_sdoc5wmcfyvd-0>li:before{content:"\0025cf  "}.lst-kix_sdoc5wmcfyvd-4>li:before{content:"\0025cb  "}ul.lst-kix_bbe3apiqyqg-6{list-style-type:none}ul.lst-kix_bbe3apiqyqg-5{list-style-type:none}.lst-kix_bofdqd71d47w-1>li:before{content:"\0025cb  "}ul.lst-kix_bbe3apiqyqg-8{list-style-type:none}ul.lst-kix_y5trfcno6bze-8{list-style-type:none}ul.lst-kix_bbe3apiqyqg-7{list-style-type:none}.lst-kix_j57fv3wuyn3u-2>li:before{content:"\0025a0  "}.lst-kix_cg5y8vd7hzo1-5>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-5}ul.lst-kix_y5trfcno6bze-6{list-style-type:none}.lst-kix_p5yirv1jpwo4-2>li:before{content:"\0025a0  "}ul.lst-kix_y5trfcno6bze-7{list-style-type:none}ol.lst-kix_fzq4hyp3z704-0{list-style-type:none}ul.lst-kix_y5trfcno6bze-4{list-style-type:none}ul.lst-kix_y5trfcno6bze-5{list-style-type:none}ol.lst-kix_fzq4hyp3z704-2{list-style-type:none}.lst-kix_t561m010kzjr-3>li:before{content:"\0025cf  "}ul.lst-kix_y5trfcno6bze-2{list-style-type:none}ol.lst-kix_fzq4hyp3z704-1{list-style-type:none}ol.lst-kix_3af0dumxif4f-5.start{counter-reset:lst-ctn-kix_3af0dumxif4f-5 0}.lst-kix_p5yirv1jpwo4-3>li:before{content:"\0025cf  "}ul.lst-kix_y5trfcno6bze-3{list-style-type:none}ul.lst-kix_y5trfcno6bze-0{list-style-type:none}ul.lst-kix_y5trfcno6bze-1{list-style-type:none}ol.lst-kix_x8wmrurtf44y-4.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-4 0}.lst-kix_t561m010kzjr-8>li:before{content:"\0025a0  "}.lst-kix_t561m010kzjr-7>li:before{content:"\0025cb  "}ul.lst-kix_m9cxbjaluxza-6{list-style-type:none}ul.lst-kix_m9cxbjaluxza-5{list-style-type:none}ul.lst-kix_m9cxbjaluxza-4{list-style-type:none}.lst-kix_58h2zo181w0b-5>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-5,lower-roman) ". "}ul.lst-kix_m9cxbjaluxza-3{list-style-type:none}.lst-kix_3af0dumxif4f-4>li{counter-increment:lst-ctn-kix_3af0dumxif4f-4}.lst-kix_4b7n7ocx3ukf-3>li:before{content:"\0025cf  "}ul.lst-kix_m9cxbjaluxza-8{list-style-type:none}.lst-kix_58h2zo181w0b-4>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-4,lower-latin) ". "}.lst-kix_58h2zo181w0b-8>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-8,lower-roman) ". "}ul.lst-kix_m9cxbjaluxza-7{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-7.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-7 0}.lst-kix_4b7n7ocx3ukf-4>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-4>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-4}.lst-kix_4b7n7ocx3ukf-8>li:before{content:"\0025a0  "}.lst-kix_bofdqd71d47w-6>li:before{content:"\0025cf  "}.lst-kix_p5yirv1jpwo4-6>li:before{content:"\0025cf  "}.lst-kix_4b7n7ocx3ukf-7>li:before{content:"\0025cb  "}.lst-kix_sdoc5wmcfyvd-8>li:before{content:"\0025a0  "}.lst-kix_58h2zo181w0b-0>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-0,decimal) ". "}.lst-kix_bofdqd71d47w-5>li:before{content:"\0025a0  "}ol.lst-kix_cg5y8vd7hzo1-1.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-1 0}.lst-kix_t561m010kzjr-0>li:before{content:"\0025cf  "}.lst-kix_6y0i73whe6lv-0>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-0}.lst-kix_58h2zo181w0b-1>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-1,lower-latin) ". "}.lst-kix_bofdqd71d47w-2>li:before{content:"\0025a0  "}.lst-kix_p5yirv1jpwo4-7>li:before{content:"\0025cb  "}ol.lst-kix_cg5y8vd7hzo1-6.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-6 0}.lst-kix_py2f4bwpfzpw-1>li:before{content:"\0025cb  "}.lst-kix_58h2zo181w0b-6>li{counter-increment:lst-ctn-kix_58h2zo181w0b-6}ul.lst-kix_ejij1tdx1ysp-8{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-7{list-style-type:none}.lst-kix_py2f4bwpfzpw-0>li:before{content:"\0025cf  "}ul.lst-kix_ejij1tdx1ysp-6{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-5{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-4{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-3{list-style-type:none}ul.lst-kix_m9cxbjaluxza-2{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-2{list-style-type:none}ul.lst-kix_m9cxbjaluxza-1{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-1{list-style-type:none}ul.lst-kix_m9cxbjaluxza-0{list-style-type:none}ul.lst-kix_ejij1tdx1ysp-0{list-style-type:none}.lst-kix_88i1oz4b3gu-6>li:before{content:"\0025cf  "}.lst-kix_88i1oz4b3gu-3>li:before{content:"\0025cf  "}.lst-kix_88i1oz4b3gu-7>li:before{content:"\0025cb  "}.lst-kix_6y0i73whe6lv-5>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-5}.lst-kix_py2f4bwpfzpw-8>li:before{content:"\0025a0  "}ul.lst-kix_cj425lmmnyn-2{list-style-type:none}ul.lst-kix_cj425lmmnyn-3{list-style-type:none}.lst-kix_88i1oz4b3gu-2>li:before{content:"\0025a0  "}ul.lst-kix_cj425lmmnyn-4{list-style-type:none}ul.lst-kix_cj425lmmnyn-5{list-style-type:none}ul.lst-kix_cj425lmmnyn-6{list-style-type:none}ul.lst-kix_cj425lmmnyn-7{list-style-type:none}ul.lst-kix_cj425lmmnyn-8{list-style-type:none}.lst-kix_py2f4bwpfzpw-5>li:before{content:"\0025a0  "}ol.lst-kix_6y0i73whe6lv-8.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-8 0}ul.lst-kix_cj425lmmnyn-0{list-style-type:none}.lst-kix_py2f4bwpfzpw-4>li:before{content:"\0025cb  "}ul.lst-kix_cj425lmmnyn-1{list-style-type:none}ul.lst-kix_5delk18t3op6-7{list-style-type:none}.lst-kix_s98g8i4ywsfn-6>li:before{content:"\0025cf  "}ul.lst-kix_5delk18t3op6-8{list-style-type:none}.lst-kix_56dz60690vq9-5>li:before{content:"\0025a0  "}ul.lst-kix_3icvz93ra4bf-1{list-style-type:none}ul.lst-kix_3icvz93ra4bf-2{list-style-type:none}ul.lst-kix_3icvz93ra4bf-0{list-style-type:none}ul.lst-kix_axmeg88m4pyq-8{list-style-type:none}.lst-kix_uzoy1gxgh4yr-6>li:before{content:"\0025cf  "}ul.lst-kix_axmeg88m4pyq-7{list-style-type:none}ul.lst-kix_axmeg88m4pyq-6{list-style-type:none}ul.lst-kix_axmeg88m4pyq-5{list-style-type:none}ul.lst-kix_98wfnne75xhj-8{list-style-type:none}ul.lst-kix_axmeg88m4pyq-4{list-style-type:none}ul.lst-kix_98wfnne75xhj-7{list-style-type:none}ul.lst-kix_axmeg88m4pyq-3{list-style-type:none}ul.lst-kix_98wfnne75xhj-6{list-style-type:none}ul.lst-kix_axmeg88m4pyq-2{list-style-type:none}ul.lst-kix_98wfnne75xhj-5{list-style-type:none}ul.lst-kix_axmeg88m4pyq-1{list-style-type:none}ul.lst-kix_98wfnne75xhj-4{list-style-type:none}ul.lst-kix_axmeg88m4pyq-0{list-style-type:none}ul.lst-kix_98wfnne75xhj-3{list-style-type:none}.lst-kix_uzoy1gxgh4yr-2>li:before{content:"\0025a0  "}ul.lst-kix_98wfnne75xhj-2{list-style-type:none}ul.lst-kix_98wfnne75xhj-1{list-style-type:none}ul.lst-kix_98wfnne75xhj-0{list-style-type:none}.lst-kix_56dz60690vq9-1>li:before{content:"\0025cb  "}ol.lst-kix_3af0dumxif4f-4.start{counter-reset:lst-ctn-kix_3af0dumxif4f-4 0}.lst-kix_5lajacp8xtx-1>li:before{content:"\0025cb  "}.lst-kix_92iveofhhirf-6>li:before{content:"\0025cf  "}.lst-kix_25plgfjdzvww-4>li:before{content:"\0025cb  "}.lst-kix_fzq4hyp3z704-0>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-0}.lst-kix_48wcz73c6zez-6>li:before{content:"\0025cf  "}.lst-kix_ntxkhbg2445v-3>li:before{content:"\0025cf  "}.lst-kix_92iveofhhirf-2>li:before{content:"\0025a0  "}ul.lst-kix_5delk18t3op6-1{list-style-type:none}.lst-kix_48wcz73c6zez-2>li:before{content:"\0025a0  "}ul.lst-kix_5delk18t3op6-2{list-style-type:none}.lst-kix_s98g8i4ywsfn-2>li:before{content:"\0025a0  "}ol.lst-kix_x8wmrurtf44y-3.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-3 0}.lst-kix_ntxkhbg2445v-7>li:before{content:"\0025cb  "}ul.lst-kix_5delk18t3op6-0{list-style-type:none}ul.lst-kix_5delk18t3op6-5{list-style-type:none}ul.lst-kix_5delk18t3op6-6{list-style-type:none}ol.lst-kix_fzq4hyp3z704-7.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-7 0}ul.lst-kix_5delk18t3op6-3{list-style-type:none}.lst-kix_25plgfjdzvww-8>li:before{content:"\0025a0  "}ul.lst-kix_5delk18t3op6-4{list-style-type:none}.lst-kix_fk6b7sf0hlj1-3>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-3}.lst-kix_fx74svfagk4i-2>li:before{content:"\0025a0  "}.lst-kix_1ufwrhq5s9bo-8>li:before{content:"\0025a0  "}.lst-kix_77g4tffjdcrq-8>li:before{content:"\0025a0  "}ol.lst-kix_cg5y8vd7hzo1-2.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-2 0}.lst-kix_25plgfjdzvww-0>li:before{content:"\0025cf  "}.lst-kix_1ufwrhq5s9bo-0>li:before{content:"\0025cf  "}.lst-kix_77g4tffjdcrq-0>li:before{content:"\0025cf  "}.lst-kix_4b7n7ocx3ukf-0>li:before{content:"\0025cf  "}.lst-kix_5lajacp8xtx-5>li:before{content:"\0025a0  "}.lst-kix_58h2zo181w0b-4>li{counter-increment:lst-ctn-kix_58h2zo181w0b-4}ol.lst-kix_fzq4hyp3z704-6.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-6 0}.lst-kix_1ufwrhq5s9bo-4>li:before{content:"\0025cb  "}.lst-kix_fzq4hyp3z704-7>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-7}.lst-kix_77g4tffjdcrq-4>li:before{content:"\0025cb  "}.lst-kix_6y0i73whe6lv-7>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-7}.lst-kix_i2pzk9m7og7r-2>li:before{content:"\0025a0  "}.lst-kix_x8wmrurtf44y-6>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-6}ul.lst-kix_3icvz93ra4bf-5{list-style-type:none}ul.lst-kix_3icvz93ra4bf-6{list-style-type:none}ul.lst-kix_3icvz93ra4bf-3{list-style-type:none}.lst-kix_i2pzk9m7og7r-6>li:before{content:"\0025cf  "}ul.lst-kix_3icvz93ra4bf-4{list-style-type:none}ul.lst-kix_3icvz93ra4bf-7{list-style-type:none}.lst-kix_fx74svfagk4i-6>li:before{content:"\0025cf  "}ul.lst-kix_3icvz93ra4bf-8{list-style-type:none}.lst-kix_ubjpd5qffklj-4>li:before{content:"\0025cb  "}.lst-kix_n7irori58ofp-5>li:before{content:"\0025a0  "}.lst-kix_ubjpd5qffklj-5>li:before{content:"\0025a0  "}.lst-kix_rqzxisgvhpw-1>li:before{content:"\0025cb  "}.lst-kix_ejij1tdx1ysp-8>li:before{content:"\0025a0  "}.lst-kix_ubjpd5qffklj-2>li:before{content:"\0025a0  "}.lst-kix_n7irori58ofp-3>li:before{content:"\0025cf  "}.lst-kix_n7irori58ofp-8>li:before{content:"\0025a0  "}.lst-kix_bk2lp42napbm-8>li:before{content:"\0025a0  "}.lst-kix_ejij1tdx1ysp-5>li:before{content:"\0025a0  "}.lst-kix_3af0dumxif4f-6>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-6,decimal) ". "}.lst-kix_ubjpd5qffklj-7>li:before{content:"\0025cb  "}.lst-kix_rqzxisgvhpw-3>li:before{content:"\0025cf  "}.lst-kix_ejij1tdx1ysp-6>li:before{content:"\0025cf  "}.lst-kix_3af0dumxif4f-8>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-8,lower-roman) ". "}.lst-kix_3af0dumxif4f-3>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-3,decimal) ". "}.lst-kix_lfztvpyzdcg4-5>li:before{content:"\0025a0  "}.lst-kix_cg5y8vd7hzo1-4>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-4}.lst-kix_bk2lp42napbm-3>li:before{content:"\0025cf  "}.lst-kix_ejij1tdx1ysp-0>li:before{content:"\0025cf  "}.lst-kix_3af0dumxif4f-1>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-1,lower-latin) ". "}.lst-kix_n7irori58ofp-0>li:before{content:"\0025cf  "}.lst-kix_lfztvpyzdcg4-6>li:before{content:"\0025cf  "}.lst-kix_rqzxisgvhpw-4>li:before{content:"\0025cb  "}.lst-kix_n7irori58ofp-2>li:before{content:"\0025a0  "}.lst-kix_lfztvpyzdcg4-8>li:before{content:"\0025a0  "}.lst-kix_bk2lp42napbm-6>li:before{content:"\0025cf  "}.lst-kix_rqzxisgvhpw-6>li:before{content:"\0025cf  "}.lst-kix_ejij1tdx1ysp-3>li:before{content:"\0025cf  "}.lst-kix_x8wmrurtf44y-7>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-7}.lst-kix_bk2lp42napbm-1>li:before{content:"\0025cb  "}.lst-kix_w784fo642qqt-8>li:before{content:"\0025a0  "}.lst-kix_lfztvpyzdcg4-3>li:before{content:"\0025cf  "}.lst-kix_bk2lp42napbm-0>li:before{content:"\0025cf  "}.lst-kix_w784fo642qqt-7>li:before{content:"\0025cb  "}.lst-kix_lfztvpyzdcg4-0>li:before{content:"\0025cf  "}.lst-kix_w784fo642qqt-2>li:before{content:"\0025a0  "}ol.lst-kix_fk6b7sf0hlj1-0.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-0 0}.lst-kix_w784fo642qqt-0>li:before{content:"\0025cf  "}.lst-kix_w784fo642qqt-5>li:before{content:"\0025a0  "}.lst-kix_48wcz73c6zez-7>li:before{content:"\0025cb  "}ol.lst-kix_fk6b7sf0hlj1-7.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-7 0}ol.lst-kix_58h2zo181w0b-3{list-style-type:none}.lst-kix_fk6b7sf0hlj1-8>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-8}ol.lst-kix_58h2zo181w0b-2{list-style-type:none}ol.lst-kix_58h2zo181w0b-5{list-style-type:none}ol.lst-kix_58h2zo181w0b-4{list-style-type:none}ol.lst-kix_58h2zo181w0b-1{list-style-type:none}ol.lst-kix_58h2zo181w0b-0{list-style-type:none}.lst-kix_fk6b7sf0hlj1-4>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-4}ol.lst-kix_3af0dumxif4f-3.start{counter-reset:lst-ctn-kix_3af0dumxif4f-3 0}.lst-kix_3a8kzc81evhk-5>li:before{content:"\0025a0  "}ol.lst-kix_fzq4hyp3z704-8.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-8 0}.lst-kix_3a8kzc81evhk-0>li:before{content:"\0025cf  "}.lst-kix_cg5y8vd7hzo1-0>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-0}.lst-kix_98wfnne75xhj-7>li:before{content:"\0025cb  "}.lst-kix_3af0dumxif4f-0>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-0,decimal) ". "}.lst-kix_98wfnne75xhj-6>li:before{content:"\0025cf  "}.lst-kix_3a8kzc81evhk-2>li:before{content:"\0025a0  "}.lst-kix_98wfnne75xhj-1>li:before{content:"\0025cb  "}.lst-kix_98wfnne75xhj-4>li:before{content:"\0025cb  "}.lst-kix_3a8kzc81evhk-8>li:before{content:"\0025a0  "}.lst-kix_3a8kzc81evhk-7>li:before{content:"\0025cb  "}.lst-kix_fk6b7sf0hlj1-0>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-0}.lst-kix_s98g8i4ywsfn-5>li:before{content:"\0025a0  "}ul.lst-kix_rqzxisgvhpw-8{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-2.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-2 0}.lst-kix_l03kqrm6e75t-0>li:before{content:"\0025cf  "}ul.lst-kix_rqzxisgvhpw-3{list-style-type:none}ul.lst-kix_rqzxisgvhpw-2{list-style-type:none}ul.lst-kix_rqzxisgvhpw-1{list-style-type:none}ul.lst-kix_rqzxisgvhpw-0{list-style-type:none}ul.lst-kix_rqzxisgvhpw-7{list-style-type:none}ul.lst-kix_rqzxisgvhpw-6{list-style-type:none}ul.lst-kix_rqzxisgvhpw-5{list-style-type:none}ul.lst-kix_rqzxisgvhpw-4{list-style-type:none}ul.lst-kix_j73bfzta9g61-5{list-style-type:none}ul.lst-kix_6an29lgub9tb-8{list-style-type:none}ol.lst-kix_x8wmrurtf44y-5.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-5 0}ul.lst-kix_j73bfzta9g61-6{list-style-type:none}ul.lst-kix_j73bfzta9g61-3{list-style-type:none}.lst-kix_913ncbera2sx-1>li:before{content:"\0025cb  "}.lst-kix_913ncbera2sx-3>li:before{content:"\0025cf  "}ol.lst-kix_3af0dumxif4f-1.start{counter-reset:lst-ctn-kix_3af0dumxif4f-1 0}ul.lst-kix_j73bfzta9g61-4{list-style-type:none}ul.lst-kix_6an29lgub9tb-5{list-style-type:none}ul.lst-kix_6an29lgub9tb-4{list-style-type:none}ul.lst-kix_6an29lgub9tb-7{list-style-type:none}ul.lst-kix_j73bfzta9g61-7{list-style-type:none}ul.lst-kix_6an29lgub9tb-6{list-style-type:none}ul.lst-kix_j73bfzta9g61-8{list-style-type:none}ul.lst-kix_6an29lgub9tb-1{list-style-type:none}ul.lst-kix_6an29lgub9tb-0{list-style-type:none}.lst-kix_fk6b7sf0hlj1-1>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-1}ul.lst-kix_6an29lgub9tb-3{list-style-type:none}ul.lst-kix_6an29lgub9tb-2{list-style-type:none}.lst-kix_l03kqrm6e75t-2>li:before{content:"\0025a0  "}ul.lst-kix_j73bfzta9g61-1{list-style-type:none}ul.lst-kix_j73bfzta9g61-2{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-5.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-5 0}ul.lst-kix_j73bfzta9g61-0{list-style-type:none}ul.lst-kix_465g4ir25w4-1{list-style-type:none}ul.lst-kix_465g4ir25w4-0{list-style-type:none}ul.lst-kix_465g4ir25w4-3{list-style-type:none}ul.lst-kix_465g4ir25w4-2{list-style-type:none}.lst-kix_92iveofhhirf-5>li:before{content:"\0025a0  "}ul.lst-kix_465g4ir25w4-5{list-style-type:none}ul.lst-kix_465g4ir25w4-4{list-style-type:none}ul.lst-kix_465g4ir25w4-7{list-style-type:none}ul.lst-kix_465g4ir25w4-6{list-style-type:none}.lst-kix_92iveofhhirf-3>li:before{content:"\0025cf  "}ul.lst-kix_465g4ir25w4-8{list-style-type:none}.lst-kix_qbgeynhpr352-1>li:before{content:"\0025cb  "}.lst-kix_qbgeynhpr352-3>li:before{content:"\0025cf  "}.lst-kix_48wcz73c6zez-1>li:before{content:"\0025cb  "}ol.lst-kix_58h2zo181w0b-7{list-style-type:none}ol.lst-kix_58h2zo181w0b-6{list-style-type:none}ol.lst-kix_58h2zo181w0b-8{list-style-type:none}.lst-kix_ntxkhbg2445v-8>li:before{content:"\0025a0  "}.lst-kix_s98g8i4ywsfn-3>li:before{content:"\0025cf  "}ul.lst-kix_qx3u4m1fazqq-1{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-2{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-3{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-4{list-style-type:none}.lst-kix_fx74svfagk4i-3>li:before{content:"\0025cf  "}ul.lst-kix_qx3u4m1fazqq-5{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-6{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-7{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-8{list-style-type:none}.lst-kix_cg5y8vd7hzo1-8>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-8}.lst-kix_ntxkhbg2445v-2>li:before{content:"\0025a0  "}.lst-kix_cg5y8vd7hzo1-1>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-1}ul.lst-kix_uzoy1gxgh4yr-1{list-style-type:none}.lst-kix_ntxkhbg2445v-0>li:before{content:"\0025cf  "}ul.lst-kix_uzoy1gxgh4yr-0{list-style-type:none}ul.lst-kix_uzoy1gxgh4yr-3{list-style-type:none}ul.lst-kix_uzoy1gxgh4yr-2{list-style-type:none}ul.lst-kix_uzoy1gxgh4yr-5{list-style-type:none}ul.lst-kix_uzoy1gxgh4yr-4{list-style-type:none}.lst-kix_cg5y8vd7hzo1-7>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-7}ul.lst-kix_uzoy1gxgh4yr-7{list-style-type:none}ul.lst-kix_qx3u4m1fazqq-0{list-style-type:none}ul.lst-kix_uzoy1gxgh4yr-6{list-style-type:none}ol.lst-kix_x8wmrurtf44y-7.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-7 0}ul.lst-kix_uzoy1gxgh4yr-8{list-style-type:none}.lst-kix_77g4tffjdcrq-1>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-3>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-3,decimal) ". "}.lst-kix_x8wmrurtf44y-5>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-5,lower-roman) ". "}.lst-kix_l03kqrm6e75t-8>li:before{content:"\0025a0  "}.lst-kix_77g4tffjdcrq-3>li:before{content:"\0025cf  "}.lst-kix_fx74svfagk4i-5>li:before{content:"\0025a0  "}.lst-kix_x8wmrurtf44y-3>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-3}ul.lst-kix_py2f4bwpfzpw-7{list-style-type:none}.lst-kix_j73bfzta9g61-3>li:before{content:"\0025cf  "}ul.lst-kix_py2f4bwpfzpw-6{list-style-type:none}.lst-kix_j57fv3wuyn3u-5>li:before{content:"\0025a0  "}ul.lst-kix_py2f4bwpfzpw-8{list-style-type:none}ul.lst-kix_py2f4bwpfzpw-3{list-style-type:none}.lst-kix_t561m010kzjr-6>li:before{content:"\0025cf  "}ul.lst-kix_py2f4bwpfzpw-2{list-style-type:none}ul.lst-kix_py2f4bwpfzpw-5{list-style-type:none}.lst-kix_t561m010kzjr-1>li:before{content:"\0025cb  "}ul.lst-kix_py2f4bwpfzpw-4{list-style-type:none}.lst-kix_3icvz93ra4bf-6>li:before{content:"\0025cf  "}.lst-kix_sdoc5wmcfyvd-7>li:before{content:"\0025cb  "}.lst-kix_j57fv3wuyn3u-0>li:before{content:"\0025cf  "}.lst-kix_j57fv3wuyn3u-8>li:before{content:"\0025a0  "}ol.lst-kix_6y0i73whe6lv-7{list-style-type:none}ol.lst-kix_6y0i73whe6lv-8{list-style-type:none}ol.lst-kix_6y0i73whe6lv-3{list-style-type:none}ol.lst-kix_6y0i73whe6lv-4{list-style-type:none}ol.lst-kix_6y0i73whe6lv-5{list-style-type:none}ol.lst-kix_6y0i73whe6lv-6{list-style-type:none}.lst-kix_p5yirv1jpwo4-1>li:before{content:"\0025cb  "}.lst-kix_fk6b7sf0hlj1-7>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-7}.lst-kix_3icvz93ra4bf-3>li:before{content:"\0025cf  "}.lst-kix_sdoc5wmcfyvd-2>li:before{content:"\0025a0  "}ul.lst-kix_3a8kzc81evhk-5{list-style-type:none}ul.lst-kix_3a8kzc81evhk-4{list-style-type:none}.lst-kix_4b7n7ocx3ukf-2>li:before{content:"\0025a0  "}ul.lst-kix_3a8kzc81evhk-3{list-style-type:none}.lst-kix_58h2zo181w0b-7>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-7,lower-latin) ". "}ul.lst-kix_3a8kzc81evhk-2{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-7{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-8{list-style-type:none}ul.lst-kix_3a8kzc81evhk-8{list-style-type:none}ul.lst-kix_3a8kzc81evhk-7{list-style-type:none}ul.lst-kix_3a8kzc81evhk-6{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-3{list-style-type:none}.lst-kix_4b7n7ocx3ukf-5>li:before{content:"\0025a0  "}ul.lst-kix_1ufwrhq5s9bo-4{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-5{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-6{list-style-type:none}ul.lst-kix_3a8kzc81evhk-1{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-0{list-style-type:none}ul.lst-kix_3a8kzc81evhk-0{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-1{list-style-type:none}ul.lst-kix_1ufwrhq5s9bo-2{list-style-type:none}.lst-kix_bofdqd71d47w-7>li:before{content:"\0025cb  "}.lst-kix_p5yirv1jpwo4-4>li:before{content:"\0025cb  "}.lst-kix_58h2zo181w0b-8>li{counter-increment:lst-ctn-kix_58h2zo181w0b-8}.lst-kix_bofdqd71d47w-4>li:before{content:"\0025cb  "}.lst-kix_fzq4hyp3z704-6>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-6}.lst-kix_j73bfzta9g61-6>li:before{content:"\0025cf  "}.lst-kix_58h2zo181w0b-2>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-2,lower-roman) ". "}.lst-kix_axmeg88m4pyq-5>li:before{content:"\0025a0  "}.lst-kix_axmeg88m4pyq-2>li:before{content:"\0025a0  "}.lst-kix_465g4ir25w4-6>li:before{content:"\0025cf  "}.lst-kix_cg5y8vd7hzo1-3>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-3,decimal) ". "}.lst-kix_cyi7g9f17ovx-4>li:before{content:"\0025cb  "}.lst-kix_76zx3u59ad6i-0>li:before{content:"\0025cf  "}.lst-kix_465g4ir25w4-3>li:before{content:"\0025cf  "}.lst-kix_cg5y8vd7hzo1-6>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-6,decimal) ". "}.lst-kix_88i1oz4b3gu-5>li:before{content:"\0025a0  "}.lst-kix_qbgeynhpr352-6>li:before{content:"\0025cf  "}.lst-kix_y5trfcno6bze-3>li:before{content:"\0025cf  "}ol.lst-kix_6y0i73whe6lv-0{list-style-type:none}.lst-kix_88i1oz4b3gu-0>li:before{content:"\0025cf  "}ol.lst-kix_6y0i73whe6lv-1{list-style-type:none}.lst-kix_88i1oz4b3gu-8>li:before{content:"\0025a0  "}ol.lst-kix_6y0i73whe6lv-2{list-style-type:none}.lst-kix_y5trfcno6bze-6>li:before{content:"\0025cf  "}.lst-kix_py2f4bwpfzpw-3>li:before{content:"\0025cf  "}ul.lst-kix_py2f4bwpfzpw-1{list-style-type:none}ul.lst-kix_py2f4bwpfzpw-0{list-style-type:none}.lst-kix_py2f4bwpfzpw-6>li:before{content:"\0025cf  "}.lst-kix_fk6b7sf0hlj1-5>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-5,lower-roman) ". "}ol.lst-kix_cg5y8vd7hzo1-1{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-0{list-style-type:none}.lst-kix_uzoy1gxgh4yr-0>li:before{content:"\0025cf  "}ol.lst-kix_cg5y8vd7hzo1-7{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-6{list-style-type:none}.lst-kix_s98g8i4ywsfn-0>li:before{content:"\0025cf  "}.lst-kix_s98g8i4ywsfn-8>li:before{content:"\0025a0  "}ol.lst-kix_cg5y8vd7hzo1-8{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-3{list-style-type:none}.lst-kix_6y0i73whe6lv-7>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-7,lower-latin) ". "}ol.lst-kix_cg5y8vd7hzo1-2{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-5{list-style-type:none}.lst-kix_fzq4hyp3z704-2>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-2,lower-roman) ". "}ol.lst-kix_cg5y8vd7hzo1-4{list-style-type:none}.lst-kix_gtg4eczq4yk-3>li:before{content:"\0025cf  "}.lst-kix_l03kqrm6e75t-5>li:before{content:"\0025a0  "}.lst-kix_bbe3apiqyqg-5>li:before{content:"\0025a0  "}.lst-kix_i2pzk9m7og7r-0>li:before{content:"\0025cf  "}.lst-kix_3af0dumxif4f-0>li{counter-increment:lst-ctn-kix_3af0dumxif4f-0}.lst-kix_56dz60690vq9-3>li:before{content:"\0025cf  "}.lst-kix_76zx3u59ad6i-3>li:before{content:"\0025cf  "}ul.lst-kix_913ncbera2sx-2{list-style-type:none}ul.lst-kix_913ncbera2sx-3{list-style-type:none}ul.lst-kix_913ncbera2sx-0{list-style-type:none}.lst-kix_25plgfjdzvww-2>li:before{content:"\0025a0  "}ul.lst-kix_913ncbera2sx-1{list-style-type:none}ul.lst-kix_913ncbera2sx-6{list-style-type:none}.lst-kix_5delk18t3op6-4>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-0>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-0,decimal) ". "}ul.lst-kix_913ncbera2sx-7{list-style-type:none}ul.lst-kix_913ncbera2sx-4{list-style-type:none}ul.lst-kix_913ncbera2sx-5{list-style-type:none}ul.lst-kix_913ncbera2sx-8{list-style-type:none}.lst-kix_913ncbera2sx-6>li:before{content:"\0025cf  "}.lst-kix_ntxkhbg2445v-5>li:before{content:"\0025a0  "}.lst-kix_58h2zo181w0b-5>li{counter-increment:lst-ctn-kix_58h2zo181w0b-5}.lst-kix_cyi7g9f17ovx-7>li:before{content:"\0025cb  "}.lst-kix_48wcz73c6zez-4>li:before{content:"\0025cb  "}.lst-kix_92iveofhhirf-0>li:before{content:"\0025cf  "}.lst-kix_fx74svfagk4i-0>li:before{content:"\0025cf  "}.lst-kix_m9cxbjaluxza-4>li:before{content:"\0025cb  "}.lst-kix_77g4tffjdcrq-6>li:before{content:"\0025cf  "}.lst-kix_3af0dumxif4f-7>li{counter-increment:lst-ctn-kix_3af0dumxif4f-7}.lst-kix_1ufwrhq5s9bo-6>li:before{content:"\0025cf  "}.lst-kix_92iveofhhirf-8>li:before{content:"\0025a0  "}.lst-kix_i2pzk9m7og7r-8>li:before{content:"\0025a0  "}.lst-kix_5lajacp8xtx-7>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-8>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-8,lower-roman) ". "}ul.lst-kix_88i1oz4b3gu-0{list-style-type:none}.lst-kix_uzoy1gxgh4yr-8>li:before{content:"\0025a0  "}.lst-kix_fx74svfagk4i-8>li:before{content:"\0025a0  "}ul.lst-kix_88i1oz4b3gu-6{list-style-type:none}ul.lst-kix_88i1oz4b3gu-5{list-style-type:none}.lst-kix_6an29lgub9tb-3>li:before{content:"\0025cf  "}ul.lst-kix_88i1oz4b3gu-8{list-style-type:none}ul.lst-kix_88i1oz4b3gu-7{list-style-type:none}ul.lst-kix_88i1oz4b3gu-2{list-style-type:none}ul.lst-kix_88i1oz4b3gu-1{list-style-type:none}ul.lst-kix_88i1oz4b3gu-4{list-style-type:none}ul.lst-kix_88i1oz4b3gu-3{list-style-type:none}.lst-kix_x8wmrurtf44y-0>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-0}ol.lst-kix_x8wmrurtf44y-1.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-1 0}ul.lst-kix_p5yirv1jpwo4-0{list-style-type:none}.lst-kix_fk6b7sf0hlj1-6>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-6}ul.lst-kix_p5yirv1jpwo4-2{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-1{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-5{list-style-type:none}.lst-kix_qx3u4m1fazqq-0>li:before{content:"\0025cf  "}ol.lst-kix_cg5y8vd7hzo1-4.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-4 0}ol.lst-kix_fk6b7sf0hlj1-6{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-7{list-style-type:none}.lst-kix_qx3u4m1fazqq-1>li:before{content:"\0025cb  "}ol.lst-kix_fk6b7sf0hlj1-8{list-style-type:none}.lst-kix_qx3u4m1fazqq-2>li:before{content:"\0025a0  "}.lst-kix_qx3u4m1fazqq-4>li:before{content:"\0025cb  "}.lst-kix_qx3u4m1fazqq-3>li:before{content:"\0025cf  "}.lst-kix_qx3u4m1fazqq-5>li:before{content:"\0025a0  "}.lst-kix_qx3u4m1fazqq-7>li:before{content:"\0025cb  "}.lst-kix_qx3u4m1fazqq-6>li:before{content:"\0025cf  "}.lst-kix_fzq4hyp3z704-3>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-3}ol.lst-kix_x8wmrurtf44y-6.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-6 0}ol.lst-kix_58h2zo181w0b-1.start{counter-reset:lst-ctn-kix_58h2zo181w0b-1 0}.lst-kix_cg5y8vd7hzo1-2>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-2}ul.lst-kix_bofdqd71d47w-2{list-style-type:none}ul.lst-kix_bofdqd71d47w-1{list-style-type:none}ul.lst-kix_bofdqd71d47w-4{list-style-type:none}ul.lst-kix_bofdqd71d47w-3{list-style-type:none}ul.lst-kix_bofdqd71d47w-6{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-2{list-style-type:none}ul.lst-kix_bofdqd71d47w-5{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-3{list-style-type:none}ul.lst-kix_bofdqd71d47w-8{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-0{list-style-type:none}ul.lst-kix_bofdqd71d47w-7{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-1{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-6{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-7{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-4{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-5{list-style-type:none}ul.lst-kix_bofdqd71d47w-0{list-style-type:none}ul.lst-kix_i5xp5zly0jsh-8{list-style-type:none}.lst-kix_fzq4hyp3z704-4>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-4,lower-latin) ". "}ul.lst-kix_5lajacp8xtx-8{list-style-type:none}ul.lst-kix_5lajacp8xtx-7{list-style-type:none}ol.lst-kix_3af0dumxif4f-2.start{counter-reset:lst-ctn-kix_3af0dumxif4f-2 0}.lst-kix_fzq4hyp3z704-5>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-5,lower-roman) ". "}.lst-kix_fzq4hyp3z704-6>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-6,decimal) ". "}ul.lst-kix_5lajacp8xtx-0{list-style-type:none}ol.lst-kix_x8wmrurtf44y-3{list-style-type:none}.lst-kix_fk6b7sf0hlj1-6>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-6,decimal) ". "}ol.lst-kix_x8wmrurtf44y-4{list-style-type:none}ul.lst-kix_5lajacp8xtx-2{list-style-type:none}ol.lst-kix_x8wmrurtf44y-1{list-style-type:none}ul.lst-kix_5lajacp8xtx-1{list-style-type:none}.lst-kix_gtg4eczq4yk-0>li:before{content:"\0025cf  "}ol.lst-kix_x8wmrurtf44y-2{list-style-type:none}ul.lst-kix_5lajacp8xtx-4{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-8{list-style-type:none}ol.lst-kix_x8wmrurtf44y-7{list-style-type:none}.lst-kix_fk6b7sf0hlj1-4>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-4,lower-latin) ". "}.lst-kix_fk6b7sf0hlj1-8>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-8,lower-roman) ". "}ul.lst-kix_5lajacp8xtx-3{list-style-type:none}ol.lst-kix_x8wmrurtf44y-8{list-style-type:none}ul.lst-kix_5lajacp8xtx-6{list-style-type:none}ol.lst-kix_x8wmrurtf44y-5{list-style-type:none}.lst-kix_6y0i73whe6lv-8>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-8,lower-roman) ". "}ul.lst-kix_5lajacp8xtx-5{list-style-type:none}.lst-kix_fzq4hyp3z704-8>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-8,lower-roman) ". "}ol.lst-kix_x8wmrurtf44y-6{list-style-type:none}.lst-kix_bbe3apiqyqg-8>li:before{content:"\0025a0  "}ul.lst-kix_qkzlw47atwrv-7{list-style-type:none}.lst-kix_fzq4hyp3z704-3>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-3,decimal) ". "}ul.lst-kix_qkzlw47atwrv-8{list-style-type:none}.lst-kix_gtg4eczq4yk-2>li:before{content:"\0025a0  "}.lst-kix_gtg4eczq4yk-4>li:before{content:"\0025cb  "}ol.lst-kix_x8wmrurtf44y-0{list-style-type:none}.lst-kix_6y0i73whe6lv-6>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-6,decimal) ". "}.lst-kix_bbe3apiqyqg-4>li:before{content:"\0025cb  "}.lst-kix_gtg4eczq4yk-6>li:before{content:"\0025cf  "}.lst-kix_gtg4eczq4yk-8>li:before{content:"\0025a0  "}.lst-kix_fzq4hyp3z704-1>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-1,lower-latin) ". "}.lst-kix_bbe3apiqyqg-2>li:before{content:"\0025a0  "}.lst-kix_bbe3apiqyqg-6>li:before{content:"\0025cf  "}.lst-kix_fk6b7sf0hlj1-0>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-0,decimal) ". "}ul.lst-kix_p9jeeg26zh3l-8{list-style-type:none}.lst-kix_6y0i73whe6lv-0>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-0,decimal) ". "}.lst-kix_6y0i73whe6lv-4>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-4,lower-latin) ". "}ul.lst-kix_p9jeeg26zh3l-5{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-4{list-style-type:none}.lst-kix_fk6b7sf0hlj1-2>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-2,lower-roman) ". "}ul.lst-kix_p9jeeg26zh3l-4{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-5{list-style-type:none}ul.lst-kix_p9jeeg26zh3l-7{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-6{list-style-type:none}ul.lst-kix_p9jeeg26zh3l-6{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-7{list-style-type:none}ul.lst-kix_p9jeeg26zh3l-1{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-0{list-style-type:none}ul.lst-kix_p9jeeg26zh3l-0{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-1{list-style-type:none}ul.lst-kix_p9jeeg26zh3l-3{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-2{list-style-type:none}.lst-kix_6y0i73whe6lv-2>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-2,lower-roman) ". "}ul.lst-kix_p9jeeg26zh3l-2{list-style-type:none}ul.lst-kix_h6b3e0fu5msk-3{list-style-type:none}.lst-kix_5delk18t3op6-7>li:before{content:"\0025cb  "}.lst-kix_y5trfcno6bze-0>li:before{content:"\0025cf  "}.lst-kix_5delk18t3op6-5>li:before{content:"\0025a0  "}.lst-kix_76zx3u59ad6i-4>li:before{content:"\0025cb  "}.lst-kix_76zx3u59ad6i-8>li:before{content:"\0025a0  "}.lst-kix_5delk18t3op6-3>li:before{content:"\0025cf  "}.lst-kix_76zx3u59ad6i-2>li:before{content:"\0025a0  "}ul.lst-kix_qkzlw47atwrv-1{list-style-type:none}ul.lst-kix_qkzlw47atwrv-2{list-style-type:none}ul.lst-kix_qkzlw47atwrv-0{list-style-type:none}ul.lst-kix_qkzlw47atwrv-5{list-style-type:none}ul.lst-kix_qkzlw47atwrv-6{list-style-type:none}ul.lst-kix_qkzlw47atwrv-3{list-style-type:none}ul.lst-kix_qkzlw47atwrv-4{list-style-type:none}ol.lst-kix_6y0i73whe6lv-6.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-6 0}.lst-kix_6y0i73whe6lv-3>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-3}.lst-kix_58h2zo181w0b-2>li{counter-increment:lst-ctn-kix_58h2zo181w0b-2}.lst-kix_76zx3u59ad6i-6>li:before{content:"\0025cf  "}.lst-kix_axmeg88m4pyq-8>li:before{content:"\0025a0  "}.lst-kix_m9cxbjaluxza-3>li:before{content:"\0025cf  "}.lst-kix_m9cxbjaluxza-5>li:before{content:"\0025a0  "}.lst-kix_6an29lgub9tb-8>li:before{content:"\0025a0  "}.lst-kix_5delk18t3op6-1>li:before{content:"\0025cb  "}.lst-kix_m9cxbjaluxza-1>li:before{content:"\0025cb  "}ol.lst-kix_58h2zo181w0b-6.start{counter-reset:lst-ctn-kix_58h2zo181w0b-6 0}.lst-kix_58h2zo181w0b-1>li{counter-increment:lst-ctn-kix_58h2zo181w0b-1}.lst-kix_fzq4hyp3z704-4>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-4}.lst-kix_6an29lgub9tb-2>li:before{content:"\0025a0  "}.lst-kix_6an29lgub9tb-0>li:before{content:"\0025cf  "}ol.lst-kix_fk6b7sf0hlj1-3.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-3 0}.lst-kix_m9cxbjaluxza-7>li:before{content:"\0025cb  "}ol.lst-kix_fk6b7sf0hlj1-0{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-1{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-2{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-3{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-4{list-style-type:none}.lst-kix_6an29lgub9tb-6>li:before{content:"\0025cf  "}.lst-kix_6an29lgub9tb-4>li:before{content:"\0025cb  "}.lst-kix_3icvz93ra4bf-5>li:before{content:"\0025a0  "}.lst-kix_j73bfzta9g61-1>li:before{content:"\0025cb  "}.lst-kix_j73bfzta9g61-5>li:before{content:"\0025a0  "}.lst-kix_j73bfzta9g61-0>li:before{content:"\0025cf  "}.lst-kix_j73bfzta9g61-4>li:before{content:"\0025cb  "}ol.lst-kix_fzq4hyp3z704-0.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-0 0}.lst-kix_3icvz93ra4bf-1>li:before{content:"\0025cb  "}ul.lst-kix_ntxkhbg2445v-1{list-style-type:none}ul.lst-kix_ntxkhbg2445v-0{list-style-type:none}.lst-kix_3icvz93ra4bf-0>li:before{content:"\0025cf  "}.lst-kix_3icvz93ra4bf-8>li:before{content:"\0025a0  "}.lst-kix_3af0dumxif4f-6>li{counter-increment:lst-ctn-kix_3af0dumxif4f-6}ol.lst-kix_6y0i73whe6lv-7.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-7 0}.lst-kix_3icvz93ra4bf-4>li:before{content:"\0025cb  "}ul.lst-kix_t561m010kzjr-8{list-style-type:none}ul.lst-kix_t561m010kzjr-5{list-style-type:none}ul.lst-kix_t561m010kzjr-4{list-style-type:none}ul.lst-kix_t561m010kzjr-7{list-style-type:none}ul.lst-kix_t561m010kzjr-6{list-style-type:none}ul.lst-kix_t561m010kzjr-1{list-style-type:none}ul.lst-kix_t561m010kzjr-0{list-style-type:none}ul.lst-kix_t561m010kzjr-3{list-style-type:none}ul.lst-kix_t561m010kzjr-2{list-style-type:none}.lst-kix_fk6b7sf0hlj1-5>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-5}ul.lst-kix_ntxkhbg2445v-5{list-style-type:none}ul.lst-kix_ntxkhbg2445v-4{list-style-type:none}ul.lst-kix_ntxkhbg2445v-3{list-style-type:none}ul.lst-kix_ntxkhbg2445v-2{list-style-type:none}ul.lst-kix_ntxkhbg2445v-8{list-style-type:none}ol.lst-kix_fk6b7sf0hlj1-4.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-4 0}.lst-kix_j73bfzta9g61-8>li:before{content:"\0025a0  "}ul.lst-kix_ntxkhbg2445v-7{list-style-type:none}.lst-kix_cg5y8vd7hzo1-1>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-1,lower-latin) ". "}ul.lst-kix_ntxkhbg2445v-6{list-style-type:none}.lst-kix_cg5y8vd7hzo1-0>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-0,decimal) ". "}.lst-kix_axmeg88m4pyq-7>li:before{content:"\0025cb  "}.lst-kix_3af0dumxif4f-8>li{counter-increment:lst-ctn-kix_3af0dumxif4f-8}.lst-kix_465g4ir25w4-8>li:before{content:"\0025a0  "}.lst-kix_465g4ir25w4-5>li:before{content:"\0025a0  "}.lst-kix_axmeg88m4pyq-4>li:before{content:"\0025cb  "}.lst-kix_fzq4hyp3z704-2>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-2}.lst-kix_axmeg88m4pyq-3>li:before{content:"\0025cf  "}.lst-kix_465g4ir25w4-0>li:before{content:"\0025cf  "}.lst-kix_465g4ir25w4-1>li:before{content:"\0025cb  "}.lst-kix_axmeg88m4pyq-0>li:before{content:"\0025cf  "}.lst-kix_cg5y8vd7hzo1-4>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-4,lower-latin) ". "}.lst-kix_cyi7g9f17ovx-2>li:before{content:"\0025a0  "}.lst-kix_cg5y8vd7hzo1-5>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-5,lower-roman) ". "}.lst-kix_465g4ir25w4-4>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-8>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-8}.lst-kix_cyi7g9f17ovx-1>li:before{content:"\0025cb  "}.lst-kix_cg5y8vd7hzo1-8>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-8,lower-roman) ". "}.lst-kix_qbgeynhpr352-7>li:before{content:"\0025cb  "}.lst-kix_qbgeynhpr352-8>li:before{content:"\0025a0  "}.lst-kix_6y0i73whe6lv-2>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-2}ol.lst-kix_cg5y8vd7hzo1-0.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-0 0}.lst-kix_bbe3apiqyqg-0>li:before{content:"\0025cf  "}.lst-kix_y5trfcno6bze-4>li:before{content:"\0025cb  "}.lst-kix_cg5y8vd7hzo1-3>li{counter-increment:lst-ctn-kix_cg5y8vd7hzo1-3}.lst-kix_y5trfcno6bze-5>li:before{content:"\0025a0  "}.lst-kix_y5trfcno6bze-8>li:before{content:"\0025a0  "}.lst-kix_fzq4hyp3z704-7>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-7,lower-latin) ". "}.lst-kix_fk6b7sf0hlj1-3>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-3,decimal) ". "}.lst-kix_fk6b7sf0hlj1-7>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-7,lower-latin) ". "}.lst-kix_gtg4eczq4yk-1>li:before{content:"\0025cb  "}.lst-kix_6y0i73whe6lv-5>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-5,lower-roman) ". "}.lst-kix_bbe3apiqyqg-7>li:before{content:"\0025cb  "}.lst-kix_6y0i73whe6lv-1>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-1,lower-latin) ". "}.lst-kix_l03kqrm6e75t-3>li:before{content:"\0025cf  "}.lst-kix_bbe3apiqyqg-3>li:before{content:"\0025cf  "}.lst-kix_gtg4eczq4yk-5>li:before{content:"\0025a0  "}.lst-kix_913ncbera2sx-0>li:before{content:"\0025cf  "}.lst-kix_fzq4hyp3z704-0>li:before{content:"" counter(lst-ctn-kix_fzq4hyp3z704-0,decimal) ". "}.lst-kix_913ncbera2sx-4>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-2>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-2,lower-roman) ". "}.lst-kix_y5trfcno6bze-1>li:before{content:"\0025cb  "}.lst-kix_76zx3u59ad6i-5>li:before{content:"\0025a0  "}ol.lst-kix_cg5y8vd7hzo1-5.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-5 0}.lst-kix_x8wmrurtf44y-1>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-1}.lst-kix_qbgeynhpr352-4>li:before{content:"\0025cb  "}.lst-kix_913ncbera2sx-8>li:before{content:"\0025a0  "}ol.lst-kix_fk6b7sf0hlj1-8.start{counter-reset:lst-ctn-kix_fk6b7sf0hlj1-8 0}ol.lst-kix_x8wmrurtf44y-0.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-0 0}.lst-kix_76zx3u59ad6i-1>li:before{content:"\0025cb  "}.lst-kix_3af0dumxif4f-1>li{counter-increment:lst-ctn-kix_3af0dumxif4f-1}.lst-kix_5delk18t3op6-2>li:before{content:"\0025a0  "}ol.lst-kix_3af0dumxif4f-7.start{counter-reset:lst-ctn-kix_3af0dumxif4f-7 0}.lst-kix_cyi7g9f17ovx-5>li:before{content:"\0025a0  "}.lst-kix_qbgeynhpr352-0>li:before{content:"\0025cf  "}ol.lst-kix_fzq4hyp3z704-4.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-4 0}.lst-kix_5delk18t3op6-6>li:before{content:"\0025cf  "}ul.lst-kix_77g4tffjdcrq-0{list-style-type:none}ul.lst-kix_77g4tffjdcrq-1{list-style-type:none}ul.lst-kix_77g4tffjdcrq-2{list-style-type:none}ul.lst-kix_77g4tffjdcrq-3{list-style-type:none}ul.lst-kix_77g4tffjdcrq-4{list-style-type:none}.lst-kix_m9cxbjaluxza-2>li:before{content:"\0025a0  "}ul.lst-kix_77g4tffjdcrq-5{list-style-type:none}ul.lst-kix_77g4tffjdcrq-6{list-style-type:none}ul.lst-kix_77g4tffjdcrq-7{list-style-type:none}ul.lst-kix_77g4tffjdcrq-8{list-style-type:none}ol.lst-kix_fzq4hyp3z704-5.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-5 0}ol.lst-kix_3af0dumxif4f-6.start{counter-reset:lst-ctn-kix_3af0dumxif4f-6 0}ol.lst-kix_x8wmrurtf44y-2.start{counter-reset:lst-ctn-kix_x8wmrurtf44y-2 0}.lst-kix_qx3u4m1fazqq-8>li:before{content:"\0025a0  "}.lst-kix_l03kqrm6e75t-7>li:before{content:"\0025cb  "}.lst-kix_6an29lgub9tb-1>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-6>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-6,decimal) ". "}ol.lst-kix_cg5y8vd7hzo1-3.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-3 0}.lst-kix_6an29lgub9tb-5>li:before{content:"\0025a0  "}.lst-kix_m9cxbjaluxza-6>li:before{content:"\0025cf  "}ul.lst-kix_p5yirv1jpwo4-4{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-3{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-6{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-5{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-8{list-style-type:none}ul.lst-kix_p5yirv1jpwo4-7{list-style-type:none}.lst-kix_n7irori58ofp-6>li:before{content:"\0025cf  "}.lst-kix_ubjpd5qffklj-3>li:before{content:"\0025cf  "}.lst-kix_ubjpd5qffklj-6>li:before{content:"\0025cf  "}.lst-kix_n7irori58ofp-4>li:before{content:"\0025cb  "}.lst-kix_n7irori58ofp-7>li:before{content:"\0025cb  "}.lst-kix_rqzxisgvhpw-0>li:before{content:"\0025cf  "}.lst-kix_ubjpd5qffklj-0>li:before{content:"\0025cf  "}.lst-kix_ubjpd5qffklj-8>li:before{content:"\0025a0  "}.lst-kix_3af0dumxif4f-7>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-7,lower-latin) ". "}.lst-kix_ubjpd5qffklj-1>li:before{content:"\0025cb  "}.lst-kix_fzq4hyp3z704-5>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-5}.lst-kix_bk2lp42napbm-2>li:before{content:"\0025a0  "}.lst-kix_rqzxisgvhpw-2>li:before{content:"\0025a0  "}.lst-kix_ejij1tdx1ysp-7>li:before{content:"\0025cb  "}ul.lst-kix_92iveofhhirf-5{list-style-type:none}ul.lst-kix_92iveofhhirf-4{list-style-type:none}.lst-kix_3af0dumxif4f-2>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-2,lower-roman) ". "}ul.lst-kix_92iveofhhirf-3{list-style-type:none}ul.lst-kix_92iveofhhirf-2{list-style-type:none}.lst-kix_rqzxisgvhpw-7>li:before{content:"\0025cb  "}.lst-kix_ejij1tdx1ysp-2>li:before{content:"\0025a0  "}ul.lst-kix_92iveofhhirf-8{list-style-type:none}.lst-kix_3af0dumxif4f-5>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-5,lower-roman) ". "}ol.lst-kix_3af0dumxif4f-8.start{counter-reset:lst-ctn-kix_3af0dumxif4f-8 0}.lst-kix_lfztvpyzdcg4-7>li:before{content:"\0025cb  "}ul.lst-kix_92iveofhhirf-7{list-style-type:none}ul.lst-kix_92iveofhhirf-6{list-style-type:none}.lst-kix_bk2lp42napbm-4>li:before{content:"\0025cb  "}.lst-kix_rqzxisgvhpw-8>li:before{content:"\0025a0  "}.lst-kix_ejij1tdx1ysp-1>li:before{content:"\0025cb  "}ol.lst-kix_fzq4hyp3z704-3.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-3 0}.lst-kix_n7irori58ofp-1>li:before{content:"\0025cb  "}.lst-kix_bk2lp42napbm-5>li:before{content:"\0025a0  "}.lst-kix_bk2lp42napbm-7>li:before{content:"\0025cb  "}.lst-kix_rqzxisgvhpw-5>li:before{content:"\0025a0  "}.lst-kix_ejij1tdx1ysp-4>li:before{content:"\0025cb  "}ul.lst-kix_92iveofhhirf-1{list-style-type:none}ul.lst-kix_92iveofhhirf-0{list-style-type:none}.lst-kix_3af0dumxif4f-4>li:before{content:"" counter(lst-ctn-kix_3af0dumxif4f-4,lower-latin) ". "}.lst-kix_6y0i73whe6lv-8>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-8}ul.lst-kix_s98g8i4ywsfn-7{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-6{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-8{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-3{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-2{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-5{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-4{list-style-type:none}.lst-kix_lfztvpyzdcg4-4>li:before{content:"\0025cb  "}.lst-kix_lfztvpyzdcg4-2>li:before{content:"\0025a0  "}.lst-kix_w784fo642qqt-6>li:before{content:"\0025cf  "}.lst-kix_lfztvpyzdcg4-1>li:before{content:"\0025cb  "}ul.lst-kix_s98g8i4ywsfn-1{list-style-type:none}ul.lst-kix_s98g8i4ywsfn-0{list-style-type:none}.lst-kix_w784fo642qqt-3>li:before{content:"\0025cf  "}.lst-kix_w784fo642qqt-1>li:before{content:"\0025cb  "}.lst-kix_w784fo642qqt-4>li:before{content:"\0025cb  "}.lst-kix_58h2zo181w0b-0>li{counter-increment:lst-ctn-kix_58h2zo181w0b-0}.lst-kix_48wcz73c6zez-8>li:before{content:"\0025a0  "}ul.lst-kix_ubjpd5qffklj-0{list-style-type:none}ul.lst-kix_sdoc5wmcfyvd-2{list-style-type:none}ul.lst-kix_ubjpd5qffklj-4{list-style-type:none}ul.lst-kix_sdoc5wmcfyvd-1{list-style-type:none}ul.lst-kix_ubjpd5qffklj-3{list-style-type:none}ul.lst-kix_sdoc5wmcfyvd-0{list-style-type:none}ul.lst-kix_ubjpd5qffklj-2{list-style-type:none}ul.lst-kix_ubjpd5qffklj-1{list-style-type:none}ul.lst-kix_ubjpd5qffklj-8{list-style-type:none}ul.lst-kix_ubjpd5qffklj-7{list-style-type:none}ul.lst-kix_ubjpd5qffklj-6{list-style-type:none}ul.lst-kix_ubjpd5qffklj-5{list-style-type:none}.lst-kix_3a8kzc81evhk-3>li:before{content:"\0025cf  "}.lst-kix_98wfnne75xhj-8>li:before{content:"\0025a0  "}.lst-kix_3a8kzc81evhk-4>li:before{content:"\0025cb  "}.lst-kix_98wfnne75xhj-5>li:before{content:"\0025a0  "}.lst-kix_3a8kzc81evhk-1>li:before{content:"\0025cb  "}.lst-kix_98wfnne75xhj-3>li:before{content:"\0025cf  "}.lst-kix_98wfnne75xhj-0>li:before{content:"\0025cf  "}.lst-kix_3af0dumxif4f-5>li{counter-increment:lst-ctn-kix_3af0dumxif4f-5}.lst-kix_98wfnne75xhj-2>li:before{content:"\0025a0  "}.lst-kix_3a8kzc81evhk-6>li:before{content:"\0025cf  "}ol.lst-kix_58h2zo181w0b-5.start{counter-reset:lst-ctn-kix_58h2zo181w0b-5 0}ul.lst-kix_76zx3u59ad6i-1{list-style-type:none}ul.lst-kix_76zx3u59ad6i-0{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-0{list-style-type:none}ul.lst-kix_76zx3u59ad6i-3{list-style-type:none}ul.lst-kix_76zx3u59ad6i-2{list-style-type:none}ul.lst-kix_76zx3u59ad6i-5{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-3{list-style-type:none}.lst-kix_s98g8i4ywsfn-7>li:before{content:"\0025cb  "}ul.lst-kix_76zx3u59ad6i-4{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-4{list-style-type:none}ol.lst-kix_cg5y8vd7hzo1-8.start{counter-reset:lst-ctn-kix_cg5y8vd7hzo1-8 0}ul.lst-kix_76zx3u59ad6i-7{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-1{list-style-type:none}ul.lst-kix_76zx3u59ad6i-6{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-2{list-style-type:none}.lst-kix_l03kqrm6e75t-4>li:before{content:"\0025cb  "}ul.lst-kix_j57fv3wuyn3u-7{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-8{list-style-type:none}.lst-kix_6y0i73whe6lv-4>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-4}ul.lst-kix_j57fv3wuyn3u-5{list-style-type:none}ul.lst-kix_j57fv3wuyn3u-6{list-style-type:none}.lst-kix_92iveofhhirf-7>li:before{content:"\0025cb  "}ul.lst-kix_fx74svfagk4i-1{list-style-type:none}ul.lst-kix_fx74svfagk4i-2{list-style-type:none}ol.lst-kix_fzq4hyp3z704-1.start{counter-reset:lst-ctn-kix_fzq4hyp3z704-1 0}.lst-kix_qbgeynhpr352-5>li:before{content:"\0025a0  "}ul.lst-kix_fx74svfagk4i-0{list-style-type:none}.lst-kix_x8wmrurtf44y-1>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-1,lower-latin) ". "}ul.lst-kix_fx74svfagk4i-7{list-style-type:none}ul.lst-kix_fx74svfagk4i-8{list-style-type:none}.lst-kix_913ncbera2sx-5>li:before{content:"\0025a0  "}.lst-kix_913ncbera2sx-7>li:before{content:"\0025cb  "}ul.lst-kix_fx74svfagk4i-5{list-style-type:none}ul.lst-kix_fx74svfagk4i-6{list-style-type:none}ul.lst-kix_fx74svfagk4i-3{list-style-type:none}ul.lst-kix_fx74svfagk4i-4{list-style-type:none}.lst-kix_ntxkhbg2445v-4>li:before{content:"\0025cb  "}ul.lst-kix_76zx3u59ad6i-8{list-style-type:none}.lst-kix_48wcz73c6zez-5>li:before{content:"\0025a0  "}.lst-kix_92iveofhhirf-1>li:before{content:"\0025cb  "}.lst-kix_cyi7g9f17ovx-6>li:before{content:"\0025cf  "}.lst-kix_s98g8i4ywsfn-1>li:before{content:"\0025cb  "}.lst-kix_cyi7g9f17ovx-8>li:before{content:"\0025a0  "}ol.lst-kix_6y0i73whe6lv-3.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-3 0}.lst-kix_48wcz73c6zez-3>li:before{content:"\0025cf  "}.lst-kix_ntxkhbg2445v-6>li:before{content:"\0025cf  "}.lst-kix_fx74svfagk4i-1>li:before{content:"\0025cb  "}ol.lst-kix_58h2zo181w0b-7.start{counter-reset:lst-ctn-kix_58h2zo181w0b-7 0}ul.lst-kix_gtg4eczq4yk-0{list-style-type:none}ul.lst-kix_gtg4eczq4yk-1{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-8{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-7{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-6{list-style-type:none}.lst-kix_77g4tffjdcrq-7>li:before{content:"\0025cb  "}.lst-kix_58h2zo181w0b-7>li{counter-increment:lst-ctn-kix_58h2zo181w0b-7}ul.lst-kix_w784fo642qqt-2{list-style-type:none}ul.lst-kix_w784fo642qqt-3{list-style-type:none}ul.lst-kix_w784fo642qqt-0{list-style-type:none}ul.lst-kix_w784fo642qqt-1{list-style-type:none}ul.lst-kix_w784fo642qqt-6{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-1{list-style-type:none}ul.lst-kix_w784fo642qqt-7{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-0{list-style-type:none}.lst-kix_77g4tffjdcrq-5>li:before{content:"\0025a0  "}.lst-kix_x8wmrurtf44y-7>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-7,lower-latin) ". "}ul.lst-kix_w784fo642qqt-4{list-style-type:none}ul.lst-kix_w784fo642qqt-5{list-style-type:none}.lst-kix_l03kqrm6e75t-6>li:before{content:"\0025cf  "}ul.lst-kix_cyi7g9f17ovx-5{list-style-type:none}ol.lst-kix_6y0i73whe6lv-5.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-5 0}ul.lst-kix_cyi7g9f17ovx-4{list-style-type:none}ul.lst-kix_w784fo642qqt-8{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-3{list-style-type:none}ul.lst-kix_cyi7g9f17ovx-2{list-style-type:none}ul.lst-kix_gtg4eczq4yk-6{list-style-type:none}ul.lst-kix_gtg4eczq4yk-7{list-style-type:none}ul.lst-kix_gtg4eczq4yk-8{list-style-type:none}ul.lst-kix_gtg4eczq4yk-2{list-style-type:none}ul.lst-kix_gtg4eczq4yk-3{list-style-type:none}ul.lst-kix_gtg4eczq4yk-4{list-style-type:none}ul.lst-kix_gtg4eczq4yk-5{list-style-type:none}.lst-kix_fx74svfagk4i-7>li:before{content:"\0025cb  "}.lst-kix_sdoc5wmcfyvd-3>li:before{content:"\0025cf  "}ul.lst-kix_bk2lp42napbm-8{list-style-type:none}.lst-kix_bofdqd71d47w-0>li:before{content:"\0025cf  "}.lst-kix_3icvz93ra4bf-7>li:before{content:"\0025cb  "}ul.lst-kix_bk2lp42napbm-7{list-style-type:none}.lst-kix_t561m010kzjr-2>li:before{content:"\0025a0  "}ul.lst-kix_bk2lp42napbm-6{list-style-type:none}ul.lst-kix_bk2lp42napbm-5{list-style-type:none}.lst-kix_t561m010kzjr-5>li:before{content:"\0025a0  "}ul.lst-kix_bk2lp42napbm-4{list-style-type:none}.lst-kix_j57fv3wuyn3u-1>li:before{content:"\0025cb  "}.lst-kix_j73bfzta9g61-2>li:before{content:"\0025a0  "}.lst-kix_sdoc5wmcfyvd-6>li:before{content:"\0025cf  "}.lst-kix_bofdqd71d47w-8>li:before{content:"\0025a0  "}.lst-kix_3icvz93ra4bf-2>li:before{content:"\0025a0  "}ul.lst-kix_i2pzk9m7og7r-5{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-6{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-3{list-style-type:none}.lst-kix_p5yirv1jpwo4-0>li:before{content:"\0025cf  "}ul.lst-kix_i2pzk9m7og7r-4{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-7{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-8{list-style-type:none}.lst-kix_4b7n7ocx3ukf-1>li:before{content:"\0025cb  "}ul.lst-kix_i2pzk9m7og7r-1{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-2{list-style-type:none}ul.lst-kix_i2pzk9m7og7r-0{list-style-type:none}.lst-kix_4b7n7ocx3ukf-6>li:before{content:"\0025cf  "}.lst-kix_58h2zo181w0b-6>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-6,decimal) ". "}.lst-kix_cg5y8vd7hzo1-2>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-2,lower-roman) ". "}.lst-kix_p5yirv1jpwo4-5>li:before{content:"\0025a0  "}ul.lst-kix_bk2lp42napbm-3{list-style-type:none}ol.lst-kix_58h2zo181w0b-4.start{counter-reset:lst-ctn-kix_58h2zo181w0b-4 0}.lst-kix_j73bfzta9g61-7>li:before{content:"\0025cb  "}ul.lst-kix_bk2lp42napbm-2{list-style-type:none}ul.lst-kix_bk2lp42napbm-1{list-style-type:none}ul.lst-kix_bk2lp42napbm-0{list-style-type:none}.lst-kix_58h2zo181w0b-3>li:before{content:"" counter(lst-ctn-kix_58h2zo181w0b-3,decimal) ". "}.lst-kix_p5yirv1jpwo4-8>li:before{content:"\0025a0  "}.lst-kix_j57fv3wuyn3u-4>li:before{content:"\0025cb  "}.lst-kix_bofdqd71d47w-3>li:before{content:"\0025cf  "}.lst-kix_465g4ir25w4-7>li:before{content:"\0025cb  "}.lst-kix_axmeg88m4pyq-6>li:before{content:"\0025cf  "}.lst-kix_fzq4hyp3z704-8>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-8}.lst-kix_py2f4bwpfzpw-2>li:before{content:"\0025a0  "}ul.lst-kix_25plgfjdzvww-5{list-style-type:none}ul.lst-kix_25plgfjdzvww-6{list-style-type:none}ol.lst-kix_58h2zo181w0b-3.start{counter-reset:lst-ctn-kix_58h2zo181w0b-3 0}ul.lst-kix_25plgfjdzvww-7{list-style-type:none}ul.lst-kix_25plgfjdzvww-8{list-style-type:none}ol.lst-kix_6y0i73whe6lv-2.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-2 0}.lst-kix_cyi7g9f17ovx-3>li:before{content:"\0025cf  "}.lst-kix_axmeg88m4pyq-1>li:before{content:"\0025cb  "}.lst-kix_x8wmrurtf44y-2>li{counter-increment:lst-ctn-kix_x8wmrurtf44y-2}.lst-kix_cyi7g9f17ovx-0>li:before{content:"\0025cf  "}ul.lst-kix_25plgfjdzvww-0{list-style-type:none}.lst-kix_465g4ir25w4-2>li:before{content:"\0025a0  "}ul.lst-kix_25plgfjdzvww-1{list-style-type:none}ul.lst-kix_25plgfjdzvww-2{list-style-type:none}ul.lst-kix_25plgfjdzvww-3{list-style-type:none}.lst-kix_cg5y8vd7hzo1-7>li:before{content:"" counter(lst-ctn-kix_cg5y8vd7hzo1-7,lower-latin) ". "}ul.lst-kix_25plgfjdzvww-4{list-style-type:none}.lst-kix_y5trfcno6bze-2>li:before{content:"\0025a0  "}.lst-kix_88i1oz4b3gu-4>li:before{content:"\0025cb  "}.lst-kix_88i1oz4b3gu-1>li:before{content:"\0025cb  "}.lst-kix_bbe3apiqyqg-1>li:before{content:"\0025cb  "}ul.lst-kix_l03kqrm6e75t-6{list-style-type:none}ul.lst-kix_l03kqrm6e75t-7{list-style-type:none}ul.lst-kix_l03kqrm6e75t-8{list-style-type:none}ul.lst-kix_n7irori58ofp-7{list-style-type:none}ul.lst-kix_n7irori58ofp-8{list-style-type:none}ol.lst-kix_6y0i73whe6lv-1.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-1 0}ul.lst-kix_l03kqrm6e75t-2{list-style-type:none}ul.lst-kix_l03kqrm6e75t-3{list-style-type:none}ul.lst-kix_l03kqrm6e75t-4{list-style-type:none}ul.lst-kix_l03kqrm6e75t-5{list-style-type:none}.lst-kix_y5trfcno6bze-7>li:before{content:"\0025cb  "}ul.lst-kix_n7irori58ofp-1{list-style-type:none}.lst-kix_3af0dumxif4f-2>li{counter-increment:lst-ctn-kix_3af0dumxif4f-2}ul.lst-kix_n7irori58ofp-2{list-style-type:none}ul.lst-kix_l03kqrm6e75t-0{list-style-type:none}.lst-kix_py2f4bwpfzpw-7>li:before{content:"\0025cb  "}ul.lst-kix_l03kqrm6e75t-1{list-style-type:none}ul.lst-kix_n7irori58ofp-0{list-style-type:none}ul.lst-kix_n7irori58ofp-5{list-style-type:none}ul.lst-kix_n7irori58ofp-6{list-style-type:none}ul.lst-kix_n7irori58ofp-3{list-style-type:none}ul.lst-kix_n7irori58ofp-4{list-style-type:none}.lst-kix_s98g8i4ywsfn-4>li:before{content:"\0025cb  "}.lst-kix_56dz60690vq9-7>li:before{content:"\0025cb  "}.lst-kix_58h2zo181w0b-3>li{counter-increment:lst-ctn-kix_58h2zo181w0b-3}ol.lst-kix_58h2zo181w0b-2.start{counter-reset:lst-ctn-kix_58h2zo181w0b-2 0}.lst-kix_gtg4eczq4yk-7>li:before{content:"\0025cb  "}.lst-kix_913ncbera2sx-2>li:before{content:"\0025a0  "}.lst-kix_uzoy1gxgh4yr-4>li:before{content:"\0025cb  "}.lst-kix_fk6b7sf0hlj1-1>li:before{content:"" counter(lst-ctn-kix_fk6b7sf0hlj1-1,lower-latin) ". "}.lst-kix_l03kqrm6e75t-1>li:before{content:"\0025cb  "}.lst-kix_6y0i73whe6lv-3>li:before{content:"" counter(lst-ctn-kix_6y0i73whe6lv-3,decimal) ". "}ul.lst-kix_sdoc5wmcfyvd-6{list-style-type:none}.lst-kix_5lajacp8xtx-3>li:before{content:"\0025cf  "}ul.lst-kix_sdoc5wmcfyvd-5{list-style-type:none}ul.lst-kix_sdoc5wmcfyvd-4{list-style-type:none}ul.lst-kix_sdoc5wmcfyvd-3{list-style-type:none}.lst-kix_76zx3u59ad6i-7>li:before{content:"\0025cb  "}ul.lst-kix_sdoc5wmcfyvd-8{list-style-type:none}.lst-kix_5delk18t3op6-8>li:before{content:"\0025a0  "}.lst-kix_25plgfjdzvww-6>li:before{content:"\0025cf  "}ul.lst-kix_sdoc5wmcfyvd-7{list-style-type:none}.lst-kix_qbgeynhpr352-2>li:before{content:"\0025a0  "}ol.lst-kix_6y0i73whe6lv-0.start{counter-reset:lst-ctn-kix_6y0i73whe6lv-0 0}.lst-kix_48wcz73c6zez-0>li:before{content:"\0025cf  "}.lst-kix_92iveofhhirf-4>li:before{content:"\0025cb  "}.lst-kix_fk6b7sf0hlj1-2>li{counter-increment:lst-ctn-kix_fk6b7sf0hlj1-2}ol.lst-kix_3af0dumxif4f-2{list-style-type:none}ol.lst-kix_3af0dumxif4f-3{list-style-type:none}ol.lst-kix_3af0dumxif4f-0{list-style-type:none}ol.lst-kix_3af0dumxif4f-1{list-style-type:none}ol.lst-kix_3af0dumxif4f-6{list-style-type:none}ol.lst-kix_3af0dumxif4f-7{list-style-type:none}.lst-kix_m9cxbjaluxza-0>li:before{content:"\0025cf  "}ol.lst-kix_3af0dumxif4f-4{list-style-type:none}ol.lst-kix_3af0dumxif4f-5{list-style-type:none}ol.lst-kix_3af0dumxif4f-8{list-style-type:none}.lst-kix_fx74svfagk4i-4>li:before{content:"\0025cb  "}.lst-kix_ntxkhbg2445v-1>li:before{content:"\0025cb  "}.lst-kix_5delk18t3op6-0>li:before{content:"\0025cf  "}ul.lst-kix_48wcz73c6zez-0{list-style-type:none}.lst-kix_6y0i73whe6lv-1>li{counter-increment:lst-ctn-kix_6y0i73whe6lv-1}ul.lst-kix_48wcz73c6zez-1{list-style-type:none}ul.lst-kix_48wcz73c6zez-2{list-style-type:none}ul.lst-kix_48wcz73c6zez-3{list-style-type:none}ul.lst-kix_48wcz73c6zez-4{list-style-type:none}ul.lst-kix_48wcz73c6zez-5{list-style-type:none}ul.lst-kix_48wcz73c6zez-6{list-style-type:none}.lst-kix_fzq4hyp3z704-1>li{counter-increment:lst-ctn-kix_fzq4hyp3z704-1}ul.lst-kix_48wcz73c6zez-7{list-style-type:none}ul.lst-kix_48wcz73c6zez-8{list-style-type:none}ol.lst-kix_58h2zo181w0b-0.start{counter-reset:lst-ctn-kix_58h2zo181w0b-0 0}.lst-kix_x8wmrurtf44y-4>li:before{content:"" counter(lst-ctn-kix_x8wmrurtf44y-4,lower-latin) ". "}.lst-kix_77g4tffjdcrq-2>li:before{content:"\0025a0  "}.lst-kix_1ufwrhq5s9bo-2>li:before{content:"\0025a0  "}.lst-kix_m9cxbjaluxza-8>li:before{content:"\0025a0  "}.lst-kix_6an29lgub9tb-7>li:before{content:"\0025cb  "}.lst-kix_i2pzk9m7og7r-4>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c9{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:225.7pt;border-top-color:#000000;border-bottom-style:solid}.c30{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:150.5pt;border-top-color:#000000;border-bottom-style:solid}.c11{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c36{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c24{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Consolas";font-style:normal}.c34{padding-top:0pt;padding-bottom:16pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c13{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c22{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c18{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c20{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c5{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c31{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Consolas";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c23{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c41{margin-left:18pt;padding-top:3pt;padding-bottom:4pt;line-height:1.0;text-align:left}.c7{color:#666666;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c25{color:#000000;text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c27{color:#000000;text-decoration:none;vertical-align:baseline;font-size:26pt;font-style:normal}.c44{padding-top:4pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c16{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c40{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt}.c37{text-decoration:none;vertical-align:baseline;font-size:15pt;font-style:normal}.c38{border-spacing:0;border-collapse:collapse;margin-right:auto}.c19{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c43{font-weight:400;font-family:"Calibri";font-style:normal}.c42{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c29{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;text-decoration:underline}.c8{padding:0;margin:0}.c3{margin-left:36pt;padding-left:0pt}.c39{orphans:2;widows:2}.c17{margin-left:72pt;padding-left:0pt}.c10{color:inherit;text-decoration:inherit}.c6{font-weight:400;font-family:"Consolas"}.c26{font-weight:400;font-family:"Arial"}.c15{font-weight:700;font-family:"Arial"}.c21{color:#666666}.c32{background-color:#ffff00}.c14{height:0pt}.c12{font-style:italic}.c28{margin-left:36pt}.c35{font-family:"Consolas"}.c33{font-weight:700}.c4{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body><div class="c42"><p class="c36 title" id="h.kwdym9zu0fv"><span class="c26 c27">PyBloom</span></p><p class="c34 subtitle" id="h.4llq5ombj5f3"><span class="c26 c21 c37">Indicate the outside temperature on Philips Hue lights.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c39 c44"><span class="c7 c15"><a class="c10" href="#h.wt7xu2n7k6hq">Objectives</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.wt7xu2n7k6hq">2</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.lajfm89wmsiu">Technical Stories</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.lajfm89wmsiu">3</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.wrnq4ohwpywm">Spikes</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.wrnq4ohwpywm">5</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.1jp0qm8jbj8u">Development Environment: Mac Mini</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.1jp0qm8jbj8u">6</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.adm7w49eq87l">Atom IDE</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.adm7w49eq87l">6</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.c8y2jut2mae1">Virtual environments and file structure</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.c8y2jut2mae1">6</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.j4ov2pplbr08">Installing the packages</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.j4ov2pplbr08">8</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.syfaqa3u1f8b">Production Environment: Raspberry Pi</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.syfaqa3u1f8b">9</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.2x7em6wvkn7c">Installing the OS</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.2x7em6wvkn7c">9</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.hrwjdutw8mzg">Connecting the Mac to the RPi</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.hrwjdutw8mzg">9</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.3ctzynpg2iue">Installing the packages</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.3ctzynpg2iue">9</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.6a8i4hyvm0r2">Virtual environments on the RPi</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.6a8i4hyvm0r2">10</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.gsxv61w1clmf">Organising the code</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.gsxv61w1clmf">10</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.q4dmijot8kxt">Mapping stories to modules</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.q4dmijot8kxt">10</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.58w1wc4nuhab">Prerequisites</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.58w1wc4nuhab">11</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.206ymytjykdp">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.206ymytjykdp">11</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.y27mt659b216">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.y27mt659b216">13</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.wbvjnjpk6six">Weather observation object</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.wbvjnjpk6six">13</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.a7s205x40u0d">The technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.a7s205x40u0d">13</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.xeyy5e8h47c6">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.xeyy5e8h47c6">14</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.wtg6oy6k47uy">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.wtg6oy6k47uy">17</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.jtnp2g2bwakz">Hue lamp object</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.jtnp2g2bwakz">18</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.j2268l4d1218">The technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.j2268l4d1218">18</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.9bvzzm972n5q">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.9bvzzm972n5q">18</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.ecgmusp5jol0">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.ecgmusp5jol0">23</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.k8vd1gwbfc0s">Generate graphs function</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.k8vd1gwbfc0s">25</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.32216wpklsvi">The technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.32216wpklsvi">25</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.ibgrkv399uv8">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.ibgrkv399uv8">25</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.n69zrwk472xe">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.n69zrwk472xe">29</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.ezmhs0mguqnk">Orchestrating the code</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.ezmhs0mguqnk">30</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.xy2smpxqc9qv">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.xy2smpxqc9qv">31</a></span></p><p class="c18"><span class="c21"><a class="c10" href="#h.9a3icrqz6li2">Keeping secrets</a></span><span class="c21">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21"><a class="c10" href="#h.9a3icrqz6li2">31</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.yy9z4mfce1a2">Database utilities</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.yy9z4mfce1a2">32</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.h8u3mwby4qzz">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.h8u3mwby4qzz">35</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.llb34rmqp0cd">The web server</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.llb34rmqp0cd">37</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.3rjecaocoywu">The technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.3rjecaocoywu">38</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.o101mbuif3zj">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.o101mbuif3zj">38</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.2r1uunukvwb3">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.2r1uunukvwb3">41</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.qatuwk9gg56c">The web pages</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.qatuwk9gg56c">42</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.i0jzs054uczh">Technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.i0jzs054uczh">43</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.qaskr4rah7xh">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.qaskr4rah7xh">43</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.b2qhmp33qhjx">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.b2qhmp33qhjx">48</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.g9ivfrwbvxd9">Colour picker utility</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.g9ivfrwbvxd9">50</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.2jfw7pe75rrh">The technologies</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.2jfw7pe75rrh">50</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.2jfw7pe75rrh">The code</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.2jfw7pe75rrh">50</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.bwuar4qfi90j">Putting it together</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.bwuar4qfi90j">52</a></span></p><p class="c23"><span class="c21 c33"><a class="c10" href="#h.l5n7ar3owa8i">Conclusions</a></span><span class="c21 c33">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21 c33"><a class="c10" href="#h.l5n7ar3owa8i">53</a></span></p><p class="c18"><span class="c5"><a class="c10" href="#h.lywmsmnoc6a8">Even better if&hellip;</a></span><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5"><a class="c10" href="#h.lywmsmnoc6a8">53</a></span></p><p class="c23"><span class="c7 c15"><a class="c10" href="#h.5thd2yiwvzjn">Integrating with Git and GitHub for version control</a></span><span class="c7 c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7 c15"><a class="c10" href="#h.5thd2yiwvzjn">54</a></span></p><p class="c18"><span class="c21"><a class="c10" href="#h.qd9pr78srqnk">Spikes</a></span><span class="c21">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21"><a class="c10" href="#h.qd9pr78srqnk">54</a></span></p><p class="c18"><span class="c21"><a class="c10" href="#h.fzfhbgw930w3">Setting up Git, GitHub and Atom</a></span><span class="c21">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21"><a class="c10" href="#h.fzfhbgw930w3">54</a></span></p><p class="c18"><span class="c21"><a class="c10" href="#h.10ghuwz0zyvf">Documentation</a></span><span class="c21">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21"><a class="c10" href="#h.10ghuwz0zyvf">55</a></span></p><p class="c39 c41"><span class="c21"><a class="c10" href="#h.8vv1nmyjo62o">Putting it together</a></span><span class="c21">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c21"><a class="c10" href="#h.8vv1nmyjo62o">55</a></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Note on typefaces:</span></p><ul class="c8 lst-kix_s98g8i4ywsfn-0 start"><li class="c0 c3"><span class="c6">Code</span><span>&nbsp;</span><span class="c6">snippets</span><span>&nbsp;and </span><span class="c6">variable names</span><span class="c2">&nbsp;that are in my program</span></li><li class="c0 c3"><span class="c12">Learning points</span><span class="c2">&nbsp;to look up in your favourite search engine</span></li><li class="c0 c3"><span class="c19">URLs</span><span class="c2">&nbsp;to take you to source material </span></li><li class="c0 c3"><span class="c2">&lt;&gt; enclose information that will be different for your setup</span></li></ul><h1 class="c24" id="h.wt7xu2n7k6hq"><span class="c20">Objectives</span></h1><p class="c0"><span class="c2">As is the case with many complicated things in life, this project started with a simple objective statement:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c28"><span class="c40 c43">&ldquo;Replace the temperature to lights feature currently implemented in IFTTT paid-for, into a free method.&rdquo;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">It turns out that there&rsquo;s a bit to unpack from this statement in order to develop the requirements to build against. Let&rsquo;s get into the detail:</span></p><ul class="c8 lst-kix_j57fv3wuyn3u-0 start"><li class="c0 c3"><span>&ldquo;Currently implemented in IFTTT paid-for&rdquo;: </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://staceyoniot.com/everything-you-need-to-know-about-ifttt-pro/&amp;sa=D&amp;ust=1603647715680000&amp;usg=AOvVaw3ulR3e_t4pEPQZ-hF4sHlx">IFTT is going pro</a></span><span class="c2">&nbsp;= no longer free. It&rsquo;s not worth a monthly fee to me, for the value it delivers to my IoT home.</span></li><li class="c0 c3"><span class="c2">&ldquo;Into a free method&rdquo;: There are plenty of web-hosted services that are free, or have a free tier. Moreover, the Philips Hue service is actually hosted in my own home, so will never have a fee. My challenge is therefore to build something that is free.</span></li></ul><ul class="c8 lst-kix_j57fv3wuyn3u-1 start"><li class="c0 c17"><span class="c2">Use services within their free tier</span></li><li class="c0 c17"><span class="c2">Use devices that I have lying around the house</span></li></ul><ul class="c8 lst-kix_j57fv3wuyn3u-0"><li class="c0 c3"><span class="c2">&ldquo;Temperature to lights feature&rdquo;: Put simply, the feature that I built in IFTTT changes the colour of a Hue Bloom in my lounge in response to a temperature change. If the temperature goes above or below a certain threshold, the bloom light changes. I can then tell the temperature just by looking at the colour of the light.</span></li></ul><ul class="c8 lst-kix_j57fv3wuyn3u-1 start"><li class="c0 c17"><span class="c2">Map outside temperature forecast to a colour</span></li><li class="c0 c17"><span class="c2">Show this colour in the Bloom</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Because this isn&rsquo;t hard enough, my wife suggested a couple of stretch targets:</span></p><ul class="c8 lst-kix_ejij1tdx1ysp-0 start"><li class="c0 c3"><span class="c2">Graphically represent the temperature information</span></li></ul><ul class="c8 lst-kix_ejij1tdx1ysp-1 start"><li class="c0 c17"><span class="c2">Maintain graphs of historical temperature information</span></li><li class="c0 c17"><span class="c2">Present in a way that is easy to access</span></li><li class="c0 c17"><span class="c2">Match the colours in the graphs to the colours in the Bloom</span></li></ul><h2 class="c11" id="h.lajfm89wmsiu"><span class="c22">Technical Stories</span></h2><p class="c0"><span>Let&rsquo;s refactor these objectives into</span><span class="c12">&nbsp;technical stories</span><span class="c2">&nbsp;that I can build against.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Non-functional requirements</span></p><ul class="c8 lst-kix_77g4tffjdcrq-0 start"><li class="c0 c3"><span class="c2">Be free. </span></li><li class="c0 c3"><span class="c2">I settled on using the following technologies:</span></li></ul><ul class="c8 lst-kix_77g4tffjdcrq-1 start"><li class="c0 c17"><span>Open Weather Map</span><span class="c2">&nbsp;API free tier</span></li><li class="c0 c17"><span class="c2">My Mac Mini as a development environment</span></li><li class="c0 c17"><span class="c2">An old first generation Raspberry Pi to be my always-on production environment</span></li><li class="c0 c17"><span class="c2">Main development language of Python (v3.7 in prod, v3.8 in dev)</span></li><li class="c0 c17"><span class="c2">Atom as my IDE</span></li><li class="c0 c17"><span class="c2">Flask as the web page building framework</span></li><li class="c0 c17"><span class="c2">Bootstrap as the CSS framework</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Check current weather </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_lfztvpyzdcg4-0 start"><li class="c0 c3"><span>Create a</span><span class="c6">&nbsp;weather observation</span><span class="c2">&nbsp;class object: </span></li></ul><ul class="c8 lst-kix_lfztvpyzdcg4-1 start"><li class="c0 c17"><span class="c2">Initialisation function to call weather API to get current weather </span></li><li class="c0 c17"><span class="c2">Representation string to give last called time </span></li><li class="c0 c17"><span class="c2">Accessor for current temperature </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c33">Story: Assign colour depending on temperature</span><span class="c2">&nbsp;</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_p5yirv1jpwo4-0 start"><li class="c0 c3"><span class="c2">Dictionary of temperature boundaries and colour if greater than &nbsp;</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Change colour of Philips Hue Bloom to display temperature </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_axmeg88m4pyq-0 start"><li class="c0 c3"><span>Create a</span><span class="c6">&nbsp;lounge bloom</span><span class="c2">&nbsp;class object: </span></li></ul><ul class="c8 lst-kix_axmeg88m4pyq-1 start"><li class="c0 c17"><span class="c2">Representation string to give current colour </span></li><li class="c0 c17"><span class="c2">Accessor to set current colour </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Log the weather reading</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_88i1oz4b3gu-0 start"><li class="c0 c3"><span class="c2">Append new observation into SQL database &nbsp;</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Make Hue colours available from external SQL database </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_rqzxisgvhpw-0 start"><li class="c0 c3"><span class="c2">Build SQL database in setup script </span></li><li class="c0 c3"><span class="c2">Create lookup function to query db </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Calculate data points from observation </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_1ufwrhq5s9bo-0 start"><li class="c0 c3"><span class="c2">Export data from SQL to perform calculations </span></li></ul><ul class="c8 lst-kix_1ufwrhq5s9bo-1 start"><li class="c0 c17"><span class="c2">Current temperature compared to this time yesterday </span></li><li class="c0 c17"><span class="c2">Last 24h temperature distribution (= today) compared to previous 24h </span></li><li class="c0 c17"><span class="c2">This weeks&#39; temperature distribution compared to last week, last month, last year </span></li></ul><ul class="c8 lst-kix_1ufwrhq5s9bo-0"><li class="c0 c3"><span class="c2">Render using PyGal </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Run every hour </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">It became apparent to me that triggering the colour change when the temperature changed was beyond me. I couldn&rsquo;t figure out a way to get an external service to trigger a message into my to-be-written code, whilst remaining within the free tier. For example, the Open Weather Map API has a limit of 1,000,000 calls per month. If the API proves to be chatty, and triggers a message every 0.1C, then I could use up even that generous allowance over the course of the month. So instead of having data pushed to me, I decided on scheduling regular polling of data.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_l03kqrm6e75t-0 start"><li class="c0 c3"><span class="c2">Make observation at a time interval</span></li><li class="c0 c3"><span class="c2">Calculate data points immediately after observation </span></li><li class="c0 c3"><span class="c2">Create graphs </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Visualisation </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_n7irori58ofp-0 start"><li class="c0 c3"><span class="c2">Create static web page in Flask </span></li><li class="c0 c3"><span class="c2">Read colours into table in web page (directly into HTML or Flask) </span></li><li class="c0 c3"><span class="c2">Export bloom colours into SQLite database </span></li><li class="c0 c3"><span class="c2">Create CSS</span></li></ul><ul class="c8 lst-kix_n7irori58ofp-1 start"><li class="c0 c17"><span class="c2">CSS to make for nav bar </span></li><li class="c0 c17"><span class="c2">CSS var() to take row hex from HTML and pass to CSS </span></li><li class="c0 c17"><span class="c2">CSS for table </span></li><li class="c0 c17"><span class="c2">Optimised for desktop, tablet, mobile </span></li></ul><ul class="c8 lst-kix_n7irori58ofp-0"><li class="c0 c3"><span class="c2">Use task scheduler to take periodic observations </span></li><li class="c0 c3"><span class="c2">Build rudimentary CMS </span></li></ul><ul class="c8 lst-kix_n7irori58ofp-1 start"><li class="c0 c17"><span class="c2">Automatically update web page via CMS </span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Story: Serve page in local network </span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_fx74svfagk4i-0 start"><li class="c0 c3"><span>Host on the Raspberry Pi</span></li></ul><h2 class="c11" id="h.wrnq4ohwpywm"><span class="c22">Spikes</span></h2><p class="c0"><span class="c2">Much of this was new to me, so I needed to spend some time researching the topics, undertaking tutorials and practice code, before I could write the application. These were my research spikes, expressed as questions. I recommend you work through the linked tutorials to get your head around the concepts.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_ntxkhbg2445v-0 start"><li class="c0 c3"><span>How can I access my Raspberry Pi without attaching a keyboard and monitor (</span><span>as a </span><span class="c12">headless</span><span>&nbsp;server</span><span class="c2">)?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://learn.adafruit.com/adafruit-raspberry-pi-lesson-7-remote-control-with-vnc/mac-screen-and-file-sharing&amp;sa=D&amp;ust=1603647715694000&amp;usg=AOvVaw2Fx1ZEP_FB65mbiiiOopWZ">VNC tutorial</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.raspberrypi.org/documentation/remote-access/ssh/unix.md&amp;sa=D&amp;ust=1603647715694000&amp;usg=AOvVaw20DxTWKODOBe8cZUVAbBiN">SSH tutorial</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://superuser.com/questions/1380591/ssh-how-to-add-host-to-ssh-known-host-file&amp;sa=D&amp;ust=1603647715694000&amp;usg=AOvVaw0yFxIqWXym6W9_BtPxKtNu">What to do if SSH complains about changed host</a></span><span>&nbsp; </span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">Which tools should I install and use on my Mac for my development environment?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.raspberrypi.org/forums/viewtopic.php?t%3D220413&amp;sa=D&amp;ust=1603647715695000&amp;usg=AOvVaw1c0GZabVdm4Ij6xM7oGexL">IDE For Python - Best One</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.codecademy.com/articles/f1-text-editors&amp;sa=D&amp;ust=1603647715695000&amp;usg=AOvVaw2wLFuEQBKHlSJTwIBHDnWP">Getting Started with Atom</a></span><span>&nbsp;</span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">How do I work with the Philips Hue API?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://developers.meethue.com/develop/get-started-2/&amp;sa=D&amp;ust=1603647715696000&amp;usg=AOvVaw3e2CfdEX3b8Hcmkj6uV4tz">Get started with Hue</a></span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">How do I work with the Open Weather Map API?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://openweathermap.org/api&amp;sa=D&amp;ust=1603647715696000&amp;usg=AOvVaw35GWhpxxiqFywC4vskWzVS">Weather API</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://medium.com/nexttech/how-to-use-the-openweathermap-api-with-python-c84cc7075cfc&amp;sa=D&amp;ust=1603647715696000&amp;usg=AOvVaw2hKo9wTFTYeF7GaNwX1iUu">How to use the OpenWeatherMap API with Python</a></span><span>&nbsp;</span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">I don&rsquo;t like MatPlotLib for data visualisation in Python. Which alternative should I use?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://opensource.com/article/20/6/pygal-python&amp;sa=D&amp;ust=1603647715697000&amp;usg=AOvVaw2j18u2KzDZjzxaT1N_duN5">Style your data plots in Python with Pygal</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.pluralsight.com/guides/creating-interactive-charts-with-python-pygal&amp;sa=D&amp;ust=1603647715697000&amp;usg=AOvVaw0kPCwbWG9R9wjMi30OB0Ww">Creating Interactive Charts with Python Pygal | Pluralsight</a></span><span>&nbsp;</span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">Having decided to use Flask to generate my website HTML from Python code, how do I use it?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world&amp;sa=D&amp;ust=1603647715698000&amp;usg=AOvVaw0SV4TVjZ4QTvb5Qyfa698H">The Flask Mega-Tutorial Part I: Hello, World!</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.tutorialspoint.com/flask/index.htm&amp;sa=D&amp;ust=1603647715698000&amp;usg=AOvVaw2FBNi8j7HH_zLajzPtTql-">Flask Tutorial</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://realpython.com/primer-on-jinja-templating/&amp;sa=D&amp;ust=1603647715699000&amp;usg=AOvVaw17Lre3BFSRiVKBWMFhIhnf">Primer on Jinja Templating</a></span><span>&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">Having decided to use Bootstrap to generate by CSS to format my website, how do I use it?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://mdbootstrap.com/docs/jquery/navigation/navbar/&amp;sa=D&amp;ust=1603647715699000&amp;usg=AOvVaw3mQ1DKg-qU6bbNzUHgdiAV">Bootstrap Navbar Guideline - examples &amp; tutorial</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://uxplanet.org/how-to-customize-bootstrap-b8078a011203&amp;sa=D&amp;ust=1603647715699000&amp;usg=AOvVaw14VLh_U0GkyIJbwyKmDPwx">How to Customize Bootstrap</a></span><span>&nbsp;</span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">Having decided to use SQLite for my persistent data stores, how do I use it with Python and Flask?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.sqlitetutorial.net/sqlite-python/&amp;sa=D&amp;ust=1603647715700000&amp;usg=AOvVaw2xXbFVJEsg598doODdAX-o">SQLite Python</a></span></li><li class="c0 c17"><span>&nbsp;</span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.sqlite.org/lang_datefunc.html&amp;sa=D&amp;ust=1603647715700000&amp;usg=AOvVaw3ClRVVDLw4bHNFWb7T3Tyn">Date And Time Functions</a></span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">I want to show the same colours for the same temperature on my Bloom, on the graphs, and on the website. How do I export from the SQLite database into Python, into CSS?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://jsfiddle.net/&amp;sa=D&amp;ust=1603647715701000&amp;usg=AOvVaw00XGnM_2upgrOZ0mbWvY_v">JSFiddle - Code Playground</a></span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">How do I run two programs (the web server and gathering weather observations) simultaneously?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://medium.com/better-programming/introduction-to-apscheduler-86337f3bb4a6&amp;sa=D&amp;ust=1603647715701000&amp;usg=AOvVaw25go-h9V0HfqZAG-pPZQfY">Introduction to APScheduler</a></span><span class="c2">&nbsp;</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-0"><li class="c0 c3"><span class="c2">How do I run my program periodically, automatically?</span></li></ul><ul class="c8 lst-kix_ntxkhbg2445v-1 start"><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control&amp;sa=D&amp;ust=1603647715702000&amp;usg=AOvVaw0DareDDboi-NYds7oEBhFR">Cache-Control - HTTP</a></span></li><li class="c0 c17"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://pythonise.com/series/learning-flask/python-before-after-request&amp;sa=D&amp;ust=1603647715702000&amp;usg=AOvVaw08h5dmHuT4NQZ5qQbJPo8T">Flask before and after request functions</a></span></li></ul><h1 class="c24" id="h.1jp0qm8jbj8u"><span class="c20">Development Environment: Mac Mini</span></h1><p class="c0"><span class="c2">For a development environment, I decided I needed a pretty user interface, and something that would help me keep track of all my indents and nested brackets. This isn&rsquo;t particularly taxing for any modern computer, but none of my computing options are particularly modern, so I needed something lightweight. So I chose my Mac Mini to be my dev machine.</span></p><h2 class="c11" id="h.adm7w49eq87l"><span class="c22">Atom IDE</span></h2><p class="c0"><span class="c2">My machine is 10 years old, and a few macOS versions behind, so using heavyweight IDEs like Xcode is out of the question. Nor can I live without the pretty colours and error prompts without a nice IDE. I found Atom, built by the people who developed Git, and I like it lots. It&rsquo;s hugely extensible with community-developed plugins, so I could create the combination for my needs. The ones I use the most turned out to be:</span></p><ul class="c8 lst-kix_56dz60690vq9-0 start"><li class="c0 c3"><span class="c2">Atom-beautify</span></li><li class="c0 c3"><span class="c2">Atom-file-icons</span></li><li class="c0 c3"><span class="c2">Atom-python-virtualenv</span></li><li class="c0 c3"><span class="c2">Busy-signal</span></li><li class="c0 c3"><span class="c2">Intentions</span></li><li class="c0 c3"><span class="c2">Linter</span></li><li class="c0 c3"><span class="c2">Linter-flake8</span></li><li class="c0 c3"><span class="c2">Linter-ui-default</span></li><li class="c0 c3"><span class="c2">Minimap</span></li><li class="c0 c3"><span class="c2">Python-autopep8</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">I recommend you look them up, if you&rsquo;re interested in building your own Atom configuration, that will run on even old and creaky machines.</span></p><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.c8y2jut2mae1"><span class="c22">Virtual environments and file structure</span></h2><p class="c0"><span class="c1">apt install virtualenvwrapper</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>There are plenty of reasons to work in a virtual environment, especially if your development machine is also your machine for everything else. I use a combination of </span><span class="c6">virtualenv</span><span>&nbsp;and </span><span class="c6">virtualenvwrapper</span><span>. Install using </span><span class="c6">apt</span><span class="c2">&nbsp;for all accounts, as it&rsquo;s super userful. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The wrapper is actually a collection of </span><span class="c12">shell scripts</span><span>, which simplifies the creation and management of virtual environments and whole coding projects. Once installed, it makes sense that you need to let your shell app (Terminal for most people using a Mac) where these scripts are. Insert the following configuration statements into your </span><span class="c6">.bash_profile </span><span class="c2">file.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">export WORKON_HOME=$HOME/.virtualenvs</span></p><p class="c0"><span class="c1">export PROJECT_HOME=$HOME/Projects</span></p><p class="c0"><span class="c1">export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span></p><p class="c0"><span class="c1">source /usr/local/bin/virtualenvwrapper.sh</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Let&rsquo;s go through each in order:</span></p><ol class="c8 lst-kix_x8wmrurtf44y-0 start" start="1"><li class="c0 c3"><span class="c2">This is the location of the virtual environment files, relative to the home directory. This is the top level folder, into which the project folder is created. These files include the specific instance of Python being used, instances of any installed libraries, and any config files. The . prefix indicates that the folder is hidden in the Finder app (unless an option is checked).</span></li><li class="c0 c3"><span class="c2">This is the location of the project files. Project files are in a separate top level folder, distinct from the environment files. Examples of project files are the Python script, web page source files, config tokens. The project is kept separate from the environment so that you can roll back one without rolling back the other.</span></li><li class="c0 c3"><span class="c2">There are commonly a few different versions of Python installed. This makes explicit that we&rsquo;re only interested in v3.</span></li><li class="c0 c3"><span>As we installed </span><span class="c6">virtualenvwrapper</span><span>&nbsp;for everyone, the shell script is located in the generic </span><span class="c6">usr</span><span>&nbsp;folder.</span></li></ol><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">mkproject pybloom</span></p><p class="c0"><span class="c6">workon pybloom</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Once set up, it&rsquo;s super easy to create and work in a virtual environment using the statements above. The first statement does three things: create a virtual environment in </span><span class="c6">.virtualenvs </span><span>called </span><span class="c6">pybloom</span><span>, and create a project folder in </span><span class="c6">Projects</span><span>&nbsp;also called </span><span class="c6">pybloom</span><span>, and links the two. The second statement activates the virtual environment, and changes the</span><span class="c12">&nbsp;working directory</span><span>&nbsp;to the </span><span class="c6">pybloom</span><span class="c2">&nbsp;project folder.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>It&rsquo;s worth taking a small detour into folder structures, as this gets quite complicated quite quickly. Unhelpfully, </span><span class="c6">virtualenvwrapper</span><span>&nbsp;and the </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://flask.palletsprojects.com/en/1.1.x/tutorial/layout/&amp;sa=D&amp;ust=1603647715709000&amp;usg=AOvVaw1ynue1YgbyVOd2jDfa6EzI">Flask documentation</a></span><span>&nbsp;suggest two slightly different folder structures, so what we end up with is a hybrid. We&rsquo;ll need to be clear about this structure, as Flask is sensitive about where certain files are located. This is my recommendation - we&rsquo;ll go through the content of each file as we progress through this project. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">./Project/pybloom</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; README.md</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; pybloom.py</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; utils.py</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; db.sql</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; docs/</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; app.py</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; app/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; __init__.py</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; routes.py</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; content.py</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; templates/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &#9500;&#9472;&#9472; base.html</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &#9500;&#9472;&#9472; feature1/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &#9474; &nbsp; &#9500;&#9472;&#9472; feature1_page1.html</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &#9474; &nbsp; &#9492;&#9472;&#9472; feature1_page2.html</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &#9492;&#9472;&#9472; feature2/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; feature2_page1.html</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9474; &nbsp; &nbsp; &nbsp; &#9492;&#9472;&#9472; feature2_page2.html</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9492;&#9472;&#9472; static/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; image.svg</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &nbsp; &nbsp; &#9492;&#9472;&#9472; custom.css</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; tests/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; test_data.sql</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9492;&#9472;&#9472; test.py</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; requirements.txt</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; git/</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; .gitignore</span></p><p class="c0"><span class="c1">&#9492;&#9472;&#9472; MANIFEST.in</span></p><p class="c0"><span class="c1">./.virtualenvs/pybloom</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; bin/</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; lib/</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; pyvenv.cfg</span></p><p class="c0"><span class="c6">&#9492;&#9472;&#9472; credentials.py</span></p><h2 class="c11" id="h.j4ov2pplbr08"><span class="c22">Installing the packages</span></h2><p class="c0"><span class="c2">I won&rsquo;t spend too much time on describing the packages here, as it&rsquo;ll make more sense to introduce them in context. If you&#39;re following along, go ahead and install all of them.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_i2pzk9m7og7r-0 start"><li class="c0 c3"><span class="c2">APScheduler</span></li><li class="c0 c3"><span class="c2">Flask</span></li><li class="c0 c3"><span class="c2">PyGal</span></li><li class="c0 c3"><span class="c2">PyOWM </span></li><li class="c0 c3"><span class="c2">Qhue </span></li><li class="c0 c3"><span class="c2">rgbxy</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>(Aside: Unlike </span><span class="c6">virtualenvwrapper</span><span>&nbsp;previously, we can&rsquo;t install these using </span><span class="c6">apt </span><span>(which downloads from the Ubuntu repository)</span><span>; these need to be installed using </span><span class="c6">pip</span><span>&nbsp;</span><span>(from the Python Software Foundation repository). This is a shame as </span><span class="c6">apt</span><span>&nbsp;has a useful </span><span class="c6">apt update &amp;&amp; apt upgrade</span><span>&nbsp;method which enables all packages that it knows about to be upgraded at the same time. </span><span class="c6">Pip</span><span class="c2">&nbsp;doesn&rsquo;t have this, so each package needs to be updated individually.)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">pip freeze -&gt; requirements.txt</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Once we&rsquo;ve installed all that we need, this command records the versions that we&rsquo;ve installed in a config file. And that&rsquo;s it for setting up the Mac Mini.</span></p><h1 class="c24" id="h.syfaqa3u1f8b"><span class="c20">Production Environment: Raspberry Pi</span></h1><p class="c0"><span class="c2">Mine is a venerable RPi, a model B rev 2 from 2015. It was purposefully undepowered in order to be cheap, but nowadays it feels really slow. But my program isn&rsquo;t very compute-intensive, so it&rsquo;s a perfect match. It makes a great always-on machine that doesn&rsquo;t drink a lot of power.</span></p><h2 class="c11" id="h.2x7em6wvkn7c"><span class="c22">Installing the OS</span></h2><p class="c0"><span>I recommend starting every Pi project with a fresh install of the OS. It&rsquo;s a chance to wipe away the acreted libraries that aren&rsquo;t needed, and take advantage of the latest patches for everything. Simply download the </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.raspberrypi.org/downloads/raspberry-pi-os/&amp;sa=D&amp;ust=1603647715714000&amp;usg=AOvVaw0CSAXIXbpVio40OBcEKExB">laterst version</a></span><span>, and put onto an SD card of at least 16GB (use something like </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.balena.io/etcher/&amp;sa=D&amp;ust=1603647715715000&amp;usg=AOvVaw3KfBopksFiT_K5T7lWfJNz">Etcher</a></span><span class="c2">), then boot up the Pi.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Once booted, remember to update the software, check the options to enable SSH and VNC on startup, and you&rsquo;re done. Oh, make a note of its IP address; you&rsquo;ll need it later.</span></p><h2 class="c11" id="h.hrwjdutw8mzg"><span class="c22">Connecting the Mac to the RPi</span></h2><p class="c0"><span class="c2">I make use of three different ways of connecting the Mac to the RPi, each for different use cases:</span></p><ul class="c8 lst-kix_98wfnne75xhj-0 start"><li class="c0 c3"><span class="c2">SSH is built into both RPi OS and macOS and is the quickest way of communicating between the two. It&rsquo;s the best way of installing and upgrading libraries, as described in the next section. The biggest limitation is that if you start a thread on the RPi, then close the Terminal window on your Mac, then the RPi thread shuts down as well.</span></li><li class="c0 c3"><span class="c2">VNC is built into the RPi OS, but needs an app downloaded to the Mac. It enables access to the GUI, which is the easiest way of navigating the Pi. It&rsquo;s also the only way of starting processes in the RPi, which do not terminate if the VNC window is closed. </span></li><li class="c0 c3"><span>AFP is supported by the Mac, and requires the </span><span class="c6">netatalk</span><span class="c2">&nbsp;library to be installed on the RPi. Obviously, you&rsquo;ll need to install it by plugging in a keyboard, mouse and monitor otherwise you won&rsquo;t be able to see what you&rsquo;re doing! Once installed, the RPi can appear in the Finder app as just another server. This makes promoting code from dev to prod as simple as copying and pasting. </span></li></ul><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.3ctzynpg2iue"><span class="c22">Installing the packages</span></h2><p class="c0"><span class="c2">To recap, these are the packages to be installed on the RPi.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_i2pzk9m7og7r-0"><li class="c0 c3"><span class="c2">APScheduler</span></li><li class="c0 c3"><span class="c2">Flask</span></li><li class="c0 c3"><span class="c2">PyGal</span></li><li class="c0 c3"><span class="c2">PyOWM </span></li><li class="c0 c3"><span class="c2">Qhue </span></li><li class="c0 c3"><span class="c2">Rgbxy</span></li><li class="c0 c3"><span class="c2">Netatalk </span></li></ul><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.6a8i4hyvm0r2"><span class="c22">Virtual environments on the RPi</span></h2><p class="c0"><span class="c2">Let&rsquo;s connect to the RPi using SSH. At the command line, enter the following:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">sudo pip install virtualenvwrapper</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>As the Pi is a single purpose computer, there&rsquo;s less of a need to create a virtual environment. If the worst comes to the worst on the RPi, I can just re-cut another SD card and start again. So why bother? Well, it&rsquo;s mainly to ensure we use the right version of Python. The code will only work on v3.x but the Pi also has v2.7 installed as well. In fact, if we run the command </span><span class="c6">Python PyBloom.py</span><span class="c2">&nbsp;will try to run the code on v2.7 - and fail. So let&rsquo;s go ahead and set up the virtual environment on the RPi.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">export WORKON_HOME=$HOME/.virtualenvs</span></p><p class="c0"><span class="c1">export PROJECT_HOME=$HOME/Projects</span></p><p class="c0"><span class="c1">export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span></p><p class="c0"><span class="c1">source /usr/local/bin/virtualenvwrapper.sh</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>As with the Mac, these statements complete the configuration altering the Bash script. This needs to be done in two locations on the RPi: </span><span class="c6">.bashrc</span><span>&nbsp;and </span><span class="c6">.profile </span><span>files. The former is loaded when you load bash after logging on (as in, from a terminal from RPi GUI) and the latter when you load Bash with logon (as in via SSH). Note that the location of the Python file is different on the RPi than the Mac, so setting the </span><span class="c6">VIRTUALENVWRAPPER_PYTHON</span><span>&nbsp;global variable is different. (Note you can use </span><span class="c6">source ~/.profile</span><span class="c2">&nbsp;to reload the Bash profile without re-logging in.)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">mkproject pybloom</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>As we saw before, this command sets up a project directory called </span><span class="c6">pybloom</span><span>&nbsp;in </span><span class="c6">Projects</span><span>, a virtual environment called </span><span class="c6">pybloom</span><span>&nbsp;in</span><span class="c6">&nbsp;.virtualenvs</span><span class="c2">, and links the two.</span></p><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.gsxv61w1clmf"><span class="c20">Organising the code</span></h1><p class="c0"><span class="c2">The code should follow the technical stories described previously, but the mapping of module to story isn&rsquo;t straightforward.</span></p><h2 class="c11" id="h.q4dmijot8kxt"><span class="c22">Mapping stories to modules</span></h2><a id="t.483423e3e95d62c00f2deff9eb0e9e8aeaa9cbd6"></a><a id="t.0"></a><table class="c38"><tbody><tr class="c14"><td class="c30 c32" colspan="1" rowspan="1"><p class="c16"><span class="c25 c15">Technical Story</span></p></td><td class="c30 c32" colspan="1" rowspan="1"><p class="c16"><span class="c25 c15">Code Module</span></p></td><td class="c30 c32" colspan="1" rowspan="1"><p class="c16"><span class="c25 c15">Preparatory Spike</span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Check the current weather</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Weather observation object in main script</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">How do I work with the Open Weather Map API?</span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Change the colour of the lounge bloom to display the temperature</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Hue lamp object in main script</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">How do I work with the Philips Hue API?</span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Log the weather reading</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Weather observation object in main script</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16 c4"><span class="c25 c26"></span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Make the Hue colours available on an external database</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Database utility</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Having decided to use SQLite for my persistent data stores, how do I use it with Python and Flask?</span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Calculate the data points from the observation</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Generate graphs function in main script</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c4 c16"><span class="c25 c26"></span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Data visualisation</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Generate graphs function in main script</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">I don&rsquo;t like MatPlotLib for data visualisation in Python. Which alternative should I use?</span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Serve page in local network</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Web app</span></p><p class="c16"><span class="c25 c26">HTML</span></p><p class="c16"><span class="c25 c26">CSS</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Having decided to use Flask to generate my website HTML from Python code, how do I use it?</span></p><p class="c0"><span class="c25 c26">Having decided to use Bootstrap to generate by CSS to format my website, how do I use it?</span></p><p class="c0"><span class="c25 c26">I want to show the same colours for the same temperature on my Bloom, on the graphs, and on the website. </span></p></td></tr><tr class="c14"><td class="c30" colspan="1" rowspan="1"><p class="c0"><span class="c25 c26">Run every hour</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Running the script periodically</span></p></td><td class="c30" colspan="1" rowspan="1"><p class="c16 c39"><span class="c25 c26">How do I run my program periodically, automatically?</span></p><p class="c16 c39"><span class="c25 c26">How do I run two programs (the web server and gathering weather observations) simultaneously?</span></p></td></tr></tbody></table><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Let&rsquo;s get onto the actual writing.</span></p><h1 class="c24" id="h.58w1wc4nuhab"><span class="c20">Prerequisites</span></h1><p class="c0"><span class="c2">Like all Python programs, my code builds upon libraries written by other people.</span></p><h2 class="c11" id="h.206ymytjykdp"><span class="c22">The code</span></h2><p class="c0"><span>Each weather reading is called an </span><span class="c12">observation</span><span>. The </span><span class="c6">weather_observation</span><span class="c2">&nbsp;class is responsible for fetching the current weather observation, for and for logging. Let&rsquo;s get into it, starting with the third party libraries that I use.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from datetime import datetime, timedelta</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Dates and times are funny to manage. Thankfully, both Python and SQLite have </span><span class="c6">datetime</span><span class="c2">&nbsp;modules that handle the complexity, simplifying the representation of the maths.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">import qhue</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Qhue provides a python wrapper for the Philips API, making it much more straightforward to access the lights as Python resources. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from rgbxy import Converter</span></p><p class="c0"><span class="c1">from rgbxy import GamutA</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Philips Hue light colours are </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://developers.meethue.com/develop/get-started-2/core-concepts/%23colors-get-more-complicated&amp;sa=D&amp;ust=1603647715733000&amp;usg=AOvVaw2kOci2UjyhtyWlgMLvsh3m">complicated</a></span><span>. They use </span><span class="c12">(x,y) coordinates </span><span>that describe a point in a </span><span class="c12">colour space</span><span>. </span><span>&nbsp;CSS, the technology that describes the presentation of web sites, uses the </span><span class="c12">RGB representation</span><span>&nbsp;of colour. Thankfully, this library converts between the two, and even makes sure that the bulbs are able to show the colours (are within the bulb&rsquo;s </span><span class="c12">gamut</span><span class="c2">).</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">import pyowm</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Another wrapper, pyOWM provides a python wrapper for the OpenWeatherMap API. It provides a weather manager object that handles all the API complexity, and presents as a Python resource. The free version of the API has a limit of the number of calls allowed per month. To make sure I&rsquo;m under this limit, the code writes each observation into a persistent database which can then be queried as many times as I like.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">import sqlite3</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">To make the measurement data (and other data) persistent, it&rsquo;s written into a database that can be accessed by other code objects such as the web page. Whilst there are many database technologies, I went with SQLite as it&rsquo;s built into Python, so no need to download any more libraries.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">import pygal</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>I&rsquo;ve used powerful visualisation libraries like </span><span class="c6">MatPlotLib</span><span>&nbsp;and </span><span class="c6">Seaborn</span><span class="c2">, and they&rsquo;re complicated because they&rsquo;re powerful. By contrast, I found Pygal to be super easy.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from db_setup import db_connect, get_rows</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">I wrote my own helper utilities to make connecting to, fetching data from, then shutting the connection to my SQLite database a little easier. Whilst there are other approaches like decorator functions to do this, a utility made more sense to me. More on this when we look at the code.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Here now are the global constants:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">DATETIME_STRING = &#39;%Y-%m-%d %H:%M:%S&#39;</span></p><p class="c0"><span class="c6">FILEPATH = &#39;./app/static/&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We&rsquo;re going to need these two constants later on in the code, but because they&rsquo;re trivial to understand, let&rsquo;s introduce them now. The first governs how the </span><span class="c6">datetime</span><span class="c2">&nbsp;function mentioned earlier works in both Python and SQLite. More on the reason for the syntax in the section on logging. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The second constant is the file path for the web site assets. More on the reason for this file path in the section on presenting in a web page.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">OWM_KEY = credentials.credentials[&#39;owm_key&#39;]</span></p><p class="c0"><span class="c1">HUE_USERNAME = credentials.credentials[&#39;hue_username&#39;]</span></p><p class="c0"><span class="c1">HUE_IP = credentials.credentials[&#39;hue_ip&#39;]</span></p><p class="c0"><span class="c1">HOME_LOCATION = credentials.credentials[&#39;home_location&#39;]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>These global constants are the secrets used by the APIs to secure the calls. You&rsquo;ll need to note your own in a </span><span class="c6">credentials.py</span><span class="c2">&nbsp;file, as we&rsquo;ll see in a future section.</span></p><h2 class="c11" id="h.y27mt659b216"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">from datetime import datetime, timedelta</span></p><p class="c0"><span class="c1">import qhue</span></p><p class="c0"><span class="c1">import pyowm</span></p><p class="c0"><span class="c1">from rgbxy import Converter</span></p><p class="c0"><span class="c1">from rgbxy import GamutA</span></p><p class="c0"><span class="c1">import sqlite3</span></p><p class="c0"><span class="c1">import pygal</span></p><p class="c0"><span class="c1">from db_setup import db_connect, get_rows</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">DATETIME_STRING = &#39;%Y-%m-%d %H:%M:%S&#39;</span></p><p class="c0"><span class="c1">FILEPATH = &#39;./app/static/&#39;</span></p><p class="c0"><span class="c1">OWM_KEY = credentials.credentials[&#39;owm_key&#39;]</span></p><p class="c0"><span class="c1">HUE_USERNAME = credentials.credentials[&#39;hue_username&#39;]</span></p><p class="c0"><span class="c1">HUE_IP = credentials.credentials[&#39;hue_ip&#39;]</span></p><p class="c0"><span class="c1">HOME_LOCATION = credentials.credentials[&#39;home_location&#39;]</span></p><p class="c0 c4"><span class="c1"></span></p><h1 class="c24" id="h.wbvjnjpk6six"><span class="c20">Weather observation object</span></h1><p class="c0"><span class="c2">In this module, I use the Open Weather Map service to fetch the current weather at my location.</span></p><h2 class="c11" id="h.a7s205x40u0d"><span class="c22">The technologies </span></h2><ul class="c8 lst-kix_3icvz93ra4bf-0 start"><li class="c0 c3"><span>Open Weather Map API </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://openweathermap.org/api&amp;sa=D&amp;ust=1603647715738000&amp;usg=AOvVaw0mVW2rEtwcg7JlBAqG5CH4">https://openweathermap.org/api</a></span><span class="c2">&nbsp;</span></li></ul><h2 class="c11" id="h.xeyy5e8h47c6"><span class="c22">The code</span></h2><p class="c0"><span class="c1">class weather_observation:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Each weather reading is called an </span><span class="c12">observation</span><span>. The </span><span class="c6">weather_observation</span><span class="c2">&nbsp;class is responsible for fetching the current weather observation, for and for logging. Let&rsquo;s get into it.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Initialisation</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def __init__(self, timestamp=None, temperature=None, detailed_status=None):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.timestamp = timestamp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.temperature = temperature,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.detailed_status = detailed_status</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The observation has three components:</span></p><ul class="c8 lst-kix_913ncbera2sx-0 start"><li class="c0 c3"><span class="c6">Timestamp</span><span class="c2">: time that the observation was taken</span></li><li class="c0 c3"><span class="c6">Temperature</span><span class="c2">: temperature at the location, at the time of the observation</span></li><li class="c0 c3"><span class="c6">Detailed_status</span><span class="c2">: verbose description of weather at the location, at the time of the observation</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This observation object is initialised with </span><span class="c6">None</span><span class="c2">&nbsp;values, to show if there&rsquo;s never been an observation taken.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Representation string</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def __str__(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return f&#39;&#39;&#39;Current weather: {self.detailed_status}, {self.temperature} celsius (made at {self.timestamp})&#39;&#39;&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>It&rsquo;s always good practice to include a representation string for debugging purposes. This is accessed by simply </span><span class="c6">print</span><span class="c2">&nbsp;ing the observation object, and the last observation content is displayed.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The mechanism for constructing this string uses Python 3&rsquo;s </span><span class="c12">f-strings</span><span class="c2">&nbsp;- if you still use stock Python 2.7 then this won&rsquo;t work for you.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Fetch new observation</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def new(self, location): &nbsp;# expect e.g. &#39;London, GB&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The </span><span class="c6">.new</span><span class="c2">&nbsp;method fetches an observation. The API needs a location, so this is the only parameter that needs to be passed into the method. Note that the API needs a specific string format.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">owm = pyowm.OWM(OWM_KEY)</span></p><p class="c0"><span class="c1">mgr = owm.weather_manager()</span></p><p class="c0"><span class="c1">weather = mgr.weather_at_place(location).weather</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>These three commands together are how pyOWM accesses the API and then presents the observation. The </span><span class="c6">weather</span><span>&nbsp;object has a number of fields, but I&rsquo;m only interested in the </span><span class="c6">temperature</span><span>&nbsp;and </span><span class="c6">detailed_status</span><span class="c2">. The next three commands update the observation object.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">self.timestamp = datetime.now().strftime(DATETIME_STRING)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The current timestamp is obtained not from the OWM API, but from the built-in </span><span class="c6">datetime</span><span>&nbsp;library. There are two chained methods used. The first </span><span class="c6">.now()</span><span class="c2">&nbsp;method is self-evident, but the second merits some examination.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Python&rsquo;s </span><span class="c6">datetime</span><span>&nbsp;object is complicated because it&rsquo;s built to simplify mathematical operations across time zones and local time. It&rsquo;s also different to the </span><span class="c6">datetime</span><span>&nbsp;object used in other languages like SQLite. So to make sure both my Python and SQLite scripts have the same understanding of </span><span class="c6">datetime</span><span class="c2">, I use the built-in operators to transform to a string.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c40 c26 c12">Datetime (Python) &lt;-&gt; string (common syntax) &lt;-&gt; Datetime (SQLite)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The </span><span class="c6">.strftime()</span><span>&nbsp;method handles the conversion into a string. But it can&rsquo;t be any old string, it must be the same syntax that is accepted by both languages. The </span><span class="c6">DATETIME_STRING</span><span class="c2">&nbsp;global constant from earlier defines this syntax:</span></p><ul class="c8 lst-kix_92iveofhhirf-0 start"><li class="c0 c3"><span class="c6">%Y</span><span class="c2">: year in four digits, e.g. 2020</span></li><li class="c0 c3"><span class="c6">%m</span><span class="c2">: month in two digits, e.g. October = 10</span></li><li class="c0 c3"><span class="c6">%d</span><span class="c2">: day in two digits, e..g first = 01</span></li><li class="c0 c3"><span class="c6">%h</span><span class="c2">: hour in two digits</span></li><li class="c0 c3"><span class="c6">%m</span><span class="c2">: minute in two digits</span></li><li class="c0 c3"><span class="c6">%s</span><span class="c2">: second in two digits</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">self.temperature = weather.temperature(&#39;celsius&#39;)[&#39;temp&#39;]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The pyOWM </span><span class="c6">.temperature</span><span class="c2">&nbsp;object is quite extensive, so requires some parameters to access just the current temperature. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">self.detailed_status = weather.detailed_status</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Verbose status is easier to access (although it isn&rsquo;t really that verbose).</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">return &#39;Fetched new observation&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Whilst this function doesn&rsquo;t need to return anything, as all it does is to fetch a new observation, it&rsquo;s good practice to aid debugging to return a string. This way, the command </span><span class="c6">print(observation.new())</span><span class="c2">&nbsp;returns an acknowledgement if successful.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Log an observation</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def log(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # also write to external database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; con = db_connect()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; cur = con.cursor()</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>I&rsquo;ll describe the </span><span class="c6">db_connect()</span><span>&nbsp;utility in a later section, but the takeaway for now is that I&rsquo;m using it to aid clarity. These two statements create a </span><span class="c12">cursor</span><span>&nbsp;object by connecting to the database. This object comes with a </span><span class="c6">.execute</span><span>&nbsp;method which passes a SQL statement, with a bit of SQLite cleverness, as a Python string. Here&rsquo;s the SQL statement:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">sql = &#39;&#39;&#39;INSERT INTO observations (timestamp, temperature, detailed_status)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUES (?, ?, ?)&#39;&#39;&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">It&rsquo;s pretty basic SQL, but let&rsquo;s break it down:</span></p><ul class="c8 lst-kix_bbe3apiqyqg-0 start"><li class="c0 c3"><span class="c6">INSERT INTO observations</span><span class="c2">: SQL commands are in caps, variables in lower. Here, the variable is the table name within the database that we&rsquo;re interested in.</span></li><li class="c0 c3"><span class="c6">(timestamp, temperature, detailed_status)</span><span class="c2">: these are the columns into which we&rsquo;re going to put the values.</span></li><li class="c0 c3"><span class="c6">VALUES (?, ?, ?)</span><span class="c2">: this is where the SQLite cleverness comes in; it allows us to pass in variables from the Python script into the SQL script.</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">cur.execute(sql, (self.timestamp, self.temperature, self.detailed_status))</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This </span><span class="c6">.execute</span><span class="c2">&nbsp;method combines the SQL and the variables to create the full SQL query that is applied to the database.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">con.commit()</span></p><p class="c0"><span class="c1">con.close()</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Once we&rsquo;ve written the information to the table, we need to remember to commit the changes, then close the connection.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">return &#39;Observation logged&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">As before, an acknowledgement string is returned if successful.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Manually setting an observation (for debugging)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def set(self, timestamp, temperature, detailed_status): &nbsp;# for debug</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.timestamp = timestamp</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.temperature = temperature</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.detailed_status = detailed_status</span></p><p class="c0"><span class="c6">&nbsp; &nbsp; return &#39;Observation set&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This final method is for debugging purposes, and allows me to set an observation manually.</span></p><h2 class="c11" id="h.wtg6oy6k47uy"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">class weather_observation:</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def __init__(self, timestamp=None, temperature=None, detailed_status=None):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.timestamp = timestamp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.temperature = temperature,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.detailed_status = detailed_status</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def __str__(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return f&#39;&#39;&#39;Current weather: {self.detailed_status},</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{self.temperature} celsius</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (made at {self.timestamp})&#39;&#39;&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def new(self, location): &nbsp;# expect e.g. &#39;London, GB&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; owm = pyowm.OWM(&#39;a15c8eee1a77e17d0aa2860990d7c9f8&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; mgr = owm.weather_manager()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; weather = mgr.weather_at_place(location).weather</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.timestamp = datetime.now().strftime(DATETIME_STRING)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.temperature = weather.temperature(&#39;celsius&#39;)[&#39;temp&#39;]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.detailed_status = weather.detailed_status</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Fetched new observation&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def log(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # write to external database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; con = db_connect()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cur = con.cursor()</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; sql = &#39;&#39;&#39;INSERT INTO observations (timestamp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;temperature,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;detailed_status)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUES (?, ?, ?)&#39;&#39;&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cur.execute(sql, (self.timestamp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.temperature,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.detailed_status))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; con.commit()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; con.close()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Observation logged&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def set(self, timestamp, temperature, detailed_status): &nbsp;# for debug</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.timestamp = timestamp</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.temperature = temperature</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.detailed_status = detailed_status</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Observation set&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.jtnp2g2bwakz"><span class="c20">Hue lamp object</span></h1><p class="c0"><span class="c2">This is the module that accesses the colour light bulbs, Philips Hue Bloom, and changes the colour according to the temperature observation. The observations are accessed from the persistent SQLite database. The module then makes use of a Python library that wraps the Hue API, and a couple of utilities that do the maths to convert colours expressed as CSS hex values into xy values that the Hue lamps understand.</span></p><h2 class="c11" id="h.j2268l4d1218"><span class="c22">The technologies </span></h2><ul class="c8 lst-kix_3icvz93ra4bf-0"><li class="c0 c3"><span class="c2">Philips Hue API</span></li><li class="c0 c3"><span class="c2">Qhue library</span></li><li class="c0 c3"><span class="c2">Rgbxy library</span></li><li class="c0 c3"><span class="c2">SQLite database</span></li></ul><h2 class="c11" id="h.9bvzzm972n5q"><span class="c22">The code</span></h2><p class="c0"><span class="c13">Initialisation</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">class hue_lamp:</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def __init__(self, lamp_id):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # not accessible</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; ip = HUE_IP</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; username = HUE_USERNAME</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Instantiating a </span><span class="c6">hue_lamp</span><span class="c2">&nbsp;object creates the accessors (getters and setters) for the lamp colours. These first two variables within the object are only needed during initialisation, in order to set up the connection to the Hue Bridge, so aren&rsquo;t made available in an object method.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Time for a detour to get to know the Hue API. Philips encourages the hacker community and has comprehensive developer documentation on its </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://developers.meethue.com/develop/get-started-2/&amp;sa=D&amp;ust=1603647715756000&amp;usg=AOvVaw1BaLUXZNLvTxRaxBdAmS4t">website</a></span><span>, which walks through setup.</span><span class="c2">&nbsp;Whilst the API is a RESTful interface, you don&rsquo;t actually send messages to the cloud. Instead, you communicate with the Hue Bridge, which is somewhere in your internal network, so there are none of the security issues of the big bad internet. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">self.bridge = qhue.Bridge(ip, username)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The Bridge is identified uniquely by its IP address. It recognises your username as trustworthy, and allows access to its methods. How it decides you are trustworthy is simple and elegant - when you set up the username on the Bridge, you have to press a button on the Bridge at the same time, therefore proving that you are in possession of it and that it&rsquo;s in the same internal network.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">self.getter = self.bridge.lights[lamp_id]()</span></p><p class="c0"><span class="c1">self.setter = self.bridge.lights[lamp_id]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The actual data object was a little difficult to get my head around, and it took a bit of trial and error to get the syntax for the </span><span class="c12">getter</span><span>&nbsp;and </span><span class="c12">setter</span><span>&nbsp;methods right. The </span><span class="c6">getter</span><span>&nbsp;is a function that returns a Python </span><span class="c12">dictionary</span><span>&nbsp;of all the resources associated with the bulb.</span><span class="c2">&nbsp;This dictionary is created by Qhue from the JSON returned in the API. Here&rsquo;s an example JSON response:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;state&quot;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;hue&quot;: 50000,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;on&quot;: true,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;effect&quot;: &quot;none&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;alert&quot;: &quot;none&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;bri&quot;: 200,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sat&quot;: 200,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;ct&quot;: 500,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;xy&quot;: [0.5, 0.5],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;reachable&quot;: true,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;colormode&quot;: &quot;hs&quot;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;type&quot;: &quot;Living Colors&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;name&quot;: &quot;LC 1&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;modelid&quot;: &quot;LC0015&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;swversion&quot;: &quot;1.0.3&quot;</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The setter is different as it reflects the difference in the API. The API allows sending a PUT message to the URL of the root of the bulb; you don&rsquo;t have to access the URL of the actual setting.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">self.is_on = self.getter[&#39;state&#39;][&#39;on&#39;]</span></p><p class="c0"><span class="c1">self.colour = self.getter[&#39;state&#39;][&#39;xy&#39;]</span></p><p class="c0"><span class="c6">self.name = self.getter[&#39;name&#39;]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The final step in initialisation is to make a few of the statuses easier to access. Whether the light is on or not is a </span><span class="c12">boolean</span><span>&nbsp;within the </span><span class="c6">state</span><span>&nbsp;dictionary, which is itself within the returned dictionary. The colour (in </span><span class="c12">xy</span><span>&nbsp;values) is a </span><span class="c12">list</span><span>&nbsp;within the same dictionary. To access a dictionary within a dictionary you can simply chain the </span><span class="c12">key</span><span class="c2">&nbsp;names. By contrast, the name is a string in the returned dictionary, so no chaining is needed.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Representation string</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def __str__(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; if self.is_on:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; status = &#39;on and is set to xy:&#39; + str(self.colour)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">As usual, I&rsquo;ve written a representation string to aid in debugging. If the light is on, we have access to information on the state and colour.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">else:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; status = &#39;off&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">If the light is off, we don&rsquo;t know its colour, so the status information is different.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">return f&#39;{self.name} is {status}&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The return string uses my favourite </span><span class="c12">f-string</span><span class="c2">&nbsp;Python function to construct the message.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Setter methods</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def turn_on(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.setter.state(on=True)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &#39;Lamp turned on&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def turn_off(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.setter.state(on=False)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &#39;Lamp turned off&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">These first two methods simplify the (already quite simple) way to to turn lights on and off, to make it more readable.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def set_colour(self, colour): &nbsp;# colour is a tuple of xy values</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.setter.state(on=True)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; self.setter.state(xy=colour)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &#39;Lamp changed colour&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This final setter method first turns on the lamp if it isn&rsquo;t already on, then sets its colour. Perhaps obviously, if the lamp is off, changing its colour alone will not make the bulb show the colour; the state has to be set to on as well.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">The colours lookup table</span></p><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span class="c2">At its core, there is a lookup table that converts temperature to colour. Since this colour is to be shown both on the Hue lamps and on the accompanying website, I decided to store this table externally. I had experience of using csv files for this purpose, but I decided to use SQLite. Both are supported natively by Python, but SQLite has some built-in methods which will be useful later on. This first utility function pulls this lookup table from the external database.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def lookup_colour(temp):</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This helper function takes in a temperature value, and will return a corresponding rgb hex value.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">sql = &#39;WHERE temperature = (?)&#39;</span></p><p class="c0"><span class="c1">what = (temp, ) &nbsp;# tuple with single item</span></p><p class="c0"><span class="c1">results = get_rows(&#39;colours&#39;, &#39;hex_value&#39;, rows_sql=sql, args=what)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We now use the second utility function that accesses our database. It&rsquo;s quite a flexible function that handles opening and closing the connection to the SQLite database, and creating the SQLite query from filter criteria. Later on, we&rsquo;ll get into the detail of how this utility is created, but for now, let&rsquo;s see why this particular query was constructed.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The SQLite query we&rsquo;re trying to construct is:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">SELECT &#39;hex_value&#39;</span></p><p class="c0"><span class="c1">FROM &#39;colours&#39;</span></p><p class="c0"><span class="c1">WHERE temperature = temp</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_cyi7g9f17ovx-0 start"><li class="c0 c3"><span class="c6">hex_value</span><span class="c2">&nbsp;is the column which contains the data we&rsquo;re interested in</span></li><li class="c0 c3"><span class="c6">colors</span><span class="c2">&nbsp;is the table that contains all the data</span></li><li class="c0 c3"><span class="c6">temperature</span><span class="c2">&nbsp;is the row which we want to filter</span></li><li class="c0 c3"><span class="c6">= temp </span><span class="c2">is the condition we want to apply to the row</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Under the hood, the utility function makes use of the SQLite </span><span class="c6">.execute(sql, args_opt)</span><span>&nbsp;method. If the SQLite query contains one or more </span><span class="c6">(?)</span><span>, SQLite3 replaces the </span><span class="c6">?</span><span class="c2">&nbsp;with the arguments from the second half of the method. This is a neat way of passing parameters from Python to SQLite. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>There are a fair few syntax wrinkles to keep track of. The SQLite must be a string, the </span><span class="c6">?</span><span class="c2">&nbsp;within that string must be enclosed by brackets, and the arguments must be presented as a tuple. In this case, we&rsquo;re passing a single parameter, the temperature. Because it&rsquo;s a tuple of a single value, we need the trailing comma to make it work - it&rsquo;s one of those Python things that tripped me up the first time I came across it.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">return results[0][0] &nbsp;# to return the hex value string only</span></p><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span>The function returns a table as a list of tuples, where each tuple is a row. In this case, we&rsquo;re getting a table of a single value </span><span class="c6">[(hex_string, )]</span><span>. Both lists and tuples are </span><span class="c12">iterable</span><span class="c2">, so we can chain index values to access the string directly. It looks awkward, though.</span></p><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span class="c13">Calculating the temperature to look up</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def find_temp_threshold(temp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rows = get_rows(&#39;colours&#39;, &#39;temperature&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; all_thresholds = [row[&#39;temperature&#39;] for row in rows]</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>First, let&rsquo;s get all the temperature thresholds from our external table using our utility database access function. As we saw in the previous section, the result is a table comprising of a </span><span>list</span><span>&nbsp;of </span><span class="c12">dictionaries</span><span>. Each value can be accessed using an index or by its column label. In the last function, I used the index to access the value for brevity but in this function I use the label as it&rsquo;s more readable. From the database setup (described later), we know that this is an </span><span class="c12">integer</span><span>&nbsp;which means we can use normal list methods.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">max_threshold = max(all_thresholds)</span></p><p class="c0"><span class="c1">min_threshold = min(all_thresholds)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Finding the maximum and minimum threshold temperatures are now easy to find.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c13">Calculating the colour</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">As mentioned earlier, we can&rsquo;t just pass the CSS hex value of the colour we want to the Hue lamp and expect it to understand. To get the web site to talk to the bulb, we need to convert rgb hex values to xy coordinates. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">temp_threshold = int(temp/5) * 5</span></p><p class="c0"><span class="c1">if temp_threshold &gt; max_threshold:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = max_threshold</span></p><p class="c0"><span class="c1">if temp_threshold &lt; min_threshold:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = min_threshold</span></p><p class="c0"><span class="c1">return temp_threshold</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">The algorithm does the following:</span></p><ol class="c8 lst-kix_3af0dumxif4f-0 start" start="1"><li class="c0 c3"><span class="c2">Round the temperature down to the nearest multiple of 5</span></li><li class="c0 c3"><span class="c2">If the temperature is higher than 40, return the higher bound temperature which is 40</span></li><li class="c0 c3"><span>If the temperature is lower than -10, return the lower bound temperature which is -10</span></li></ol><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The resulting temperature table looks like this:</span></p><p class="c0 c4"><span class="c2"></span></p><a id="t.136d06c47404847f17f07c5dc4146df931d94bbb"></a><a id="t.1"></a><table class="c38"><tbody><tr class="c14"><td class="c9 c32" colspan="1" rowspan="1"><p class="c16"><span class="c25 c15">Temperature range (celsius)</span></p></td><td class="c9 c32" colspan="1" rowspan="1"><p class="c16"><span class="c15 c25">Corresponding colour (hex value)</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">40 or greater</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">ff0000</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 35 and 40</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">ff4000</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 30 and 35</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">ff8000</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 25 and 30</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">ffbf00</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 20 and 25</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">ffff00</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 15 and 20</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">bfff00</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 10 and 15</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">00ff80</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 5 and 10</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">00ffbf</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between 0 and 5</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">00ffff</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between -5 and 0</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">00bfff</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Between -5 and -10</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">0080ff</span></p></td></tr><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c26">Lower than -10</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c16"><span class="c25 c6">0040ff</span></p></td></tr></tbody></table><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def convert_temp_to_colour(temp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = find_temp_threshold(temp)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Having used our little helper function to calculate the temperature threshold for our lookup table, we now use a couple of modules from the rgbxy library to do the maths of the conversion from rgb hex to xy coordinate. I&rsquo;ve previously touched on why this maths is complicated, but let&rsquo;s recap. The hex value is used in CSS. Each pair of hex digits is the value for each of red, green and blue. So the first entry in the table for temperatures of 40C or greater shows maximum red (</span><span class="c6">ff</span><span>) and no green or blue (</span><span class="c6">00</span><span class="c2">&nbsp;each). Note that rgb values do not have any concept of saturation (brightness), so maximum saturation is assumed. So the colour for 40C is bright maximum red.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">converter = Converter(GamutA)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Each Hue bulb has its own colour </span><span class="c12">gamut</span><span>, the range of colours that it can reproduce (i.e. </span><span class="c12">colour space</span><span class="c2">&nbsp;constrained by its physical limitations). This first statement sets the applicable colour gamut to the one supported by my Hue Blooms, in this case gamut A.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">colour = converter.hex_to_xy(lookup_colour(temp_threshold))</span></p><p class="c0"><span class="c6">return colour</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">There&rsquo;s a few nested things going on here, so let&rsquo;s unpack them.</span></p><ul class="c8 lst-kix_y5trfcno6bze-0 start"><li class="c0 c3"><span>We found the </span><span class="c6">temp_threshold</span><span class="c2">&nbsp;using the algorithm described above</span></li><li class="c0 c3"><span>The </span><span class="c6">lookup_colour</span><span class="c2">&nbsp;function fetches the corresponding hex value from the lookup table in the external database table</span></li><li class="c0 c3"><span>We use the </span><span class="c6">.hex_to_xy</span><span class="c2">&nbsp;method from the converter library to do the maths</span></li><li class="c0 c3"><span class="c2">And because we set the gamut already, the method ensures that resulting colour is within the colour space of the Bloom lamp</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Identifying the lamps</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>When we set colours and status of the Hue lamps, we need to be sure we&rsquo;re doing so to the correct lamps. The Hue Bridge maintains a representation of all of the items (bulbs, lamps, switches, sensors etc) attached to it, and each item is assigned an ID. These are created when the item is </span><span class="c12">provisioned</span><span class="c2">. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">hue_lamp_ids = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;den bloom&#39;: 10,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;lounge bloom&#39;: 11</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This dictionary is another lookup table that maps IDs to human-readable names, to make the code easier to follow. I got the numbers by taking a look at the JSON from the Bridge, using the web tool provided by Philips. You can find it on the development page.</span></p><h2 class="c11" id="h.ecgmusp5jol0"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">class hue_lamp:</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def __init__(self, lamp_id):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # not accessible</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; ip = &#39;&lt;IP address of Hue bridge&gt;&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; username = &#39;&lt;from Hue developer account&gt;&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # accessible</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.bridge = qhue.Bridge(ip, username)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.getter = self.bridge.lights[lamp_id]()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.setter = self.bridge.lights[lamp_id]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.is_on = self.getter[&#39;state&#39;][&#39;on&#39;]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.colour = self.getter[&#39;state&#39;][&#39;xy&#39;]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.name = self.getter[&#39;name&#39;]</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def __str__(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; if self.is_on:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = &#39;on and is set to xy:&#39; + str(self.colour)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; else:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = &#39;off&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return f&#39;{self.name} is {status}&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def turn_on(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.setter.state(on=True)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Lamp turned on&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def turn_off(self):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.setter.state(on=False)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Lamp turned off&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; def set_colour(self, colour): &nbsp;# colour is a tuple of xy values</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.setter.state(on=True)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; self.setter.state(xy=colour)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; return &#39;Lamp changed colour&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def lookup_colour(temperature):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # lookup table of temperatures to colours in database.sqlite3</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; sql = &#39;WHERE temperature = (?)&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; what = (temperature, ) &nbsp;# tuple with single item</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; results = get_rows(&#39;colours&#39;, &#39;hex_value&#39;, rows_sql=sql, args=what)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return results[0][0] &nbsp;# to return the hex value string only</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def find_temp_threshold(temp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # find max and min thresholds from external database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rows = get_rows(&#39;colours&#39;, &#39;temperature&#39;)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; all_thresholds = [row[&#39;temperature&#39;] for row in rows]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; max_threshold = max(all_thresholds)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; min_threshold = min(all_thresholds)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = int(temp/5) * 5</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; if temp_threshold &gt; max_threshold:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; temp_threshold = max_threshold</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; if temp_threshold &lt; min_threshold:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; temp_threshold = min_threshold</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return temp_threshold</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def convert_temp_to_colour(temp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = find_temp_threshold(temp)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; converter = Converter(GamutA)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; colour = converter.hex_to_xy(lookup_colour(temp_threshold))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return colour</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">hue_lamp_ids = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;den bloom&#39;: 10,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;lounge bloom&#39;: 11</span></p><p class="c0"><span class="c1">}</span></p><h1 class="c24" id="h.k8vd1gwbfc0s"><span>Generate graphs function</span></h1><p class="c0"><span class="c2">Whilst the point of this program is to look at the current temperature outside just by glancing at my Hue lamps, I also want to be able to look at the history of temperature measurements. I could&rsquo;ve logged the temperature measurements into a csv file and examine them as a spreadsheet, but I wanted to present them in a more accessible way = data visualisation.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Python has many powerful visualisation libraries, and I&rsquo;ve spent some time with MatPlotLib (with its Seaborn) wrapper, and find it difficult because it&rsquo;s comprehensive. Looking at PyGal, it seems much simpler to work with, so I decided to use it for my program.</span></p><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.32216wpklsvi"><span class="c22">The technologies</span></h2><ul class="c8 lst-kix_p9jeeg26zh3l-0 start"><li class="c0 c3"><span class="c2">PyGal</span></li><li class="c0 c3"><span class="c2">Custom CSS</span></li></ul><h2 class="c11" id="h.ibgrkv399uv8"><span class="c22">The code</span></h2><p class="c0"><span class="c13">Observation sets</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def generate_graphs(timestamp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # observation sets</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>First things first, let&rsquo;s set the points that mark the bounds of the observation data. I&rsquo;m interested in data over the last day, over the last week and over the last month.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">now = datetime.strptime(timestamp, DATETIME_STRING)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>If you remember from earlier, maths with dates and times is surprisingly difficult, but using the </span><span class="c6">datetime</span><span>&nbsp;module makes it all easier. However, both Python and SQLite have their own implementation of datetime, so we need to make sure both use the same </span><span class="c12">data dictionary</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_48wcz73c6zez-0 start"><li class="c0 c3"><span class="c6">DATETIME_STRING</span><span class="c2">&nbsp;defines the format (data dictionary)</span></li><li class="c0 c3"><span>The </span><span class="c6">.strptime</span><span>&nbsp;method </span><span class="c12">parses</span><span class="c2">&nbsp;a string into a datetime object according to the format</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This statement creates a datetime object </span><span class="c6">now</span><span>&nbsp;from a timestamp string. This might seem puzzling as there&rsquo;s a perfectly good </span><span class="c6">datetime.now()</span><span>&nbsp;function, but this is a different </span><span class="c6">now</span><span>&nbsp;object. It&rsquo;s not the up-to-the-microsecond </span><span class="c6">now()</span><span>&nbsp;from the operating system, but the </span><span class="c6">now</span><span class="c2">&nbsp;of the most recent weather observation.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">last_day = now - timedelta(days=1)</span></p><p class="c0"><span class="c1">last_week = now - timedelta(weeks=1)</span></p><p class="c0"><span class="c1">last_month = now - timedelta(weeks=4)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The </span><span class="c6">timedelta</span><span class="c2">&nbsp;module fulfils the promise of simpler maths, with simple-to-understand syntax.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">observation_sets = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;last_day&#39;: last_day,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;last_week&#39;: last_week,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;last_month&#39;: last_month</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Having calculated the observation points, I put them in an easy-to-access Python dictionary.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Fetching the data</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">rows = get_rows(&#39;colours&#39;)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>There are two sets of data that we&rsquo;re interested in: the colour values (which will map onto the temperatures) and the temperatures themselves. This first </span><span class="c6">get_rows</span><span>&nbsp;fetches all the columns from the </span><span class="c6">colours</span><span>&nbsp;table. It&rsquo;s important to note that the results are returned as a list of </span><span class="c12">tuples</span><span>. This is going to be hard to manipulate later as we want a list of hex values - but hex values that PyGal understands (i.e. prefixed by </span><span class="c6">#</span><span>), which isn&rsquo;t the same as Python </span><span class="c12">type</span><span>&nbsp;hex (i.e. prefixed by </span><span class="c6">0x</span><span>). We therefore need to </span><span class="c12">parse</span><span class="c2">&nbsp;the results.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">hex_list = [f&#39;#{hex}&#39; for hex in [row[&#39;hex_value&#39;] for row in rows]]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We use a combination of nested </span><span class="c12">list comprehension</span><span>&nbsp;and </span><span class="c12">f-strings</span><span class="c2">&nbsp;to do this conversion:</span></p><ul class="c8 lst-kix_qx3u4m1fazqq-0 start"><li class="c0 c3"><span class="c6">[row[&#39;hex_value&#39;] for row in rows] </span><span class="c2">: this list comprehension cycles through the rows, and creates a list of the hex values</span></li><li class="c0 c3"><span class="c6">for hex in [row[&#39;hex_value&#39;] &hellip; </span><span class="c2">: an outer list comprehension cycles through the newly-created list </span></li><li class="c0 c3"><span class="c6">[f&#39;#{hex}&#39; for hex &hellip; </span><span class="c2">: each item of this outer list is inserted into the output string (in effect inserting the hash sign prefix for each element), to create the final list</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">temps_count = {row[&#39;temperature&#39;]: 0 for row in rows}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This second command is to set up histogram </span><span class="c12">bins</span><span>&nbsp;for each of the temperature thresholds, using a bit of</span><span class="c12">&nbsp;dictionary comprehension</span><span class="c2">. Now we have the temperature data in more accessible formats, let&rsquo;s move onto the observation data.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">for string, then in observation_sets.items():</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Since we want a similar graph for each of three different time periods, we can save a bit of effort by iterating through the observation points (</span><span class="c6">then</span><span class="c2">). Thanks to the dictionary, we can access both the data and the string representation, which we&rsquo;ll need in a moment.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">sql = &#39;WHERE timestamp BETWEEN datetime((?)) AND datetime((?))&#39;</span></p><p class="c0"><span class="c1">when = (then, now)</span></p><p class="c0"><span class="c1">results = get_rows(&#39;observations&#39;, rows_sql=sql, args=when)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Again, our little </span><span class="c6">get_rows</span><span>&nbsp;utility makes accessing the database a little easier. The double brackets look a bit odd. The variable replaced by the underlying SQLite </span><span class="c6">.execute</span><span>&nbsp;method is represented by </span><span class="c6">(?)</span><span>. However, they are themselves parameters into SQLite&rsquo;s own </span><span class="c6">datetime</span><span class="c2">&nbsp;method, which is why they need to be enclosed in another set of brackets. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The underlying SQLite query uses its own </span><span class="c6">datetime</span><span>&nbsp;method to convert Python </span><span class="c6">datetime</span><span>&nbsp;objects into SQL </span><span class="c6">datetime</span><span>&nbsp;strings. SQL doesn&rsquo;t ask for the data dictionary explicitly; it&rsquo;s assumed that the string corresponds to one of the accepted </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.sqlite.org/lang_datefunc.html&amp;sa=D&amp;ust=1603647715795000&amp;usg=AOvVaw3h04gmXby9fFuCPB5OFNFH">formats</a></span><span>.</span><span class="c2">&nbsp;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Once we have the bounds correctly interpreted into the query, we can select only the data that we&rsquo;re interested in. This is the reason I chose SQLite over csv. If we&rsquo;d used a csv file to store all the data, I&rsquo;d have to read all the data into a </span><span class="c12">dataframe</span><span class="c2">&nbsp;into memory, then search it for the data using a library such as Pandas. Not a big overhead, but given SQLite is built into Python, it&#39;s an opportunity to import one less library.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Generating the bar graphs</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">times = [row[&#39;timestamp&#39;] for row in rows]</span></p><p class="c0"><span class="c1">temps = [row[&#39;temperature&#39;] for row in rows]</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The database gives us a list of dictionaries; each dictionary contains a timestamp and a measurement. We need to convert these multiple lists into two lists, one containing all the timestamps, and another containing all the measurements. This is akin to transposing rows and columns of a table. This is simply done using some</span><span class="c12">&nbsp;list comprehension</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">bar_chart = pygal.Bar(x_label_rotation=20,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x_labels_major_count=6,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; show_minor_x_labels=False,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; show_legend=False)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>Now we get into using PyGal to generate the graph. This first statement instantiates the chart object. It&rsquo;s at this point that we declare it&rsquo;s a bar graph, and also tell it to rotate the x labels (so that they&rsquo;ll fit), limit x-axis labels to 6 in total (otherwise they&rsquo;ll look cluttered), and remove the legend (because there&rsquo;s only one series being shown).</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">bar_chart.add(&#39;Temperature&#39;, [</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {&#39;value&#39;: temp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;color&#39;: &#39;#&#39; + lookup_colour(find_temp_threshold(temp))}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; for temp in temps]</span></p><p class="c0"><span class="c1">)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Now we add the data series, and its title. To make the colours meaningful, the colour of the bar matches the Bloom colour. This means adding each value to be plotted individually, as a dictionary which describes the value and the colour. The colour is calculated using our previously defined functions, remembering to prefix with a hash symbol. We loop all the temperature measurements using list comprehension.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">bar_chart.x_labels = times</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The final piece of formatting is to add labels for the x axis, using a nice simple syntax.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">filename = string + &#39;_bar.svg&#39;</span></p><p class="c0"><span class="c1">bar_chart.render_to_file(FILEPATH + filename)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We want the filename to reflect the data set, so this little snippet takes the string representation of the data from the dictionary key, creates a full file path prepending the </span><span class="c6">FILEPATH = &#39;./app/static/&#39;</span><span class="c2">&nbsp;global constant, and saves the generated graph there.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Generating the pie charts</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We want to generate one pie chart for every bar chart (just in case we need them). The first thing we need to do is to count the number of occurrences of temperature in the bins that were previously generated.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">for temp in temps:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temp_threshold = find_temp_threshold(temp)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temps_count[temp_threshold] += 1</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">The algorithm is simplified as we&rsquo;re done most of the prep work beforehand. For each temperature reading in this observation set, we first find its corresponding temperature threshold, then increment the count in its bin.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">custom_style = Style(colors=(tuple(hex_list)))</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>We can reuse the hex values from the colours table to create a custom colour key for the pie chart. These values are in the form of a list of strings, each prefixed with a hash, which we did earlier. To be properly formatted for PyGal, we now need to convert this list into a tuple, then pass it to the </span><span class="c6">Style</span><span>&nbsp;function as one of the optional </span><span class="c12">keyword arguments</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">pie_chart = pygal.Pie(inner_radius=0.6,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; style=custom_style)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Instantiating the pie chart is straightforward; the only configuration parameters are the size of its donut hole and the colours of the sections.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">for temp, count in temps_count.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; pie_chart.add(str(temp), count)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Each pie segment needs to be added individually, so we have a little loop.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">filename = string + &#39;_pie.svg&#39;</span></p><p class="c0"><span class="c1">pie_chart.render_to_file(FILEPATH + filename)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Finally, let&rsquo;s save the chart to be used by the web app later.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Wrapping up</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Now we&rsquo;ve done it once, we can repeat it for each of the remaining observation sets.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">return &#39;Created graphs&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The database utility has taken care of closing the connection to the database, so all that&rsquo;s left is to return an acknowledgement string for debugging purposes. The graphs themselves are already stored (or overwritten) in the predefined folder within the loop.</span></p><h2 class="c11" id="h.n69zrwk472xe"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">def generate_graphs(timestamp):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # observation sets</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; now = datetime.strptime(timestamp, DATETIME_STRING)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; last_day = now - timedelta(days=1)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; last_week = now - timedelta(weeks=1)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; last_month = now - timedelta(weeks=4)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; observation_sets = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;last_day&#39;: last_day,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;last_week&#39;: last_week,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;last_month&#39;: last_month</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # get datapoints from database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rows = get_rows(&#39;colours&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; hex_list = [f&#39;#{hex}&#39; for hex in [row[&#39;hex_value&#39;] for row in rows]]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temps_count = {row[&#39;temperature&#39;]: 0 for row in rows}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # 3x graphs for every reading in last day, week, month</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; for string, then in observation_sets.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # fetch data</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; sql = &#39;WHERE timestamp BETWEEN datetime((?)) AND datetime((?))&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; when = (then, now)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; results = get_rows(&#39;observations&#39;, rows_sql=sql, args=when)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # generate bar graph</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; times = [row[&#39;timestamp&#39;] for row in rows]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; temps = [row[&#39;temperature&#39;] for row in rows]</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; bar_chart = pygal.Bar(x_label_rotation=20,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x_labels_major_count=6,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; show_minor_x_labels=False,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; show_legend=False)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; bar_chart.add(&#39;Temperature&#39;, [</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&#39;value&#39;: temp,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;color&#39;: &#39;#&#39; + lookup_colour(find_temp_threshold(temp))}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for temp in temps]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; )</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; bar_chart.x_labels = times</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; filename = string + &#39;_bar.svg&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; bar_chart.render_to_file(FILEPATH + filename)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; # generate pie chart</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; for temp in temps:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temp_threshold = find_temp_threshold(temp)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temps_count[temp_threshold] += 1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; custom_style = Style(colors=(tuple(hex_list)))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; pie_chart = pygal.Pie(inner_radius=0.6,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; style=custom_style)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; for temp, count in temps_count.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pie_chart.add(str(temp), count)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; filename = string + &#39;_pie.svg&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; pie_chart.render_to_file(FILEPATH + filename)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &#39;Created graphs&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><h1 class="c24" id="h.ezmhs0mguqnk"><span class="c20">Orchestrating the code</span></h1><p class="c0"><span class="c2">Right at the top, I defined the structure of the code that I wanted to write, as:</span></p><ol class="c8 lst-kix_cg5y8vd7hzo1-0 start" start="1"><li class="c0 c3"><span class="c2">Check the current weather</span></li><li class="c0 c3"><span class="c2">Set the blooms to the current temperature</span></li><li class="c0 c3"><span class="c2">Log the weather reading</span></li><li class="c0 c3"><span class="c2">Generate new graphs</span></li></ol><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Now that we&rsquo;ve gone through the detail of the classes and functions, following the execution code becomes quite straightforward. I&rsquo;ll leave it to you, dear reader, to put it together. See you in the next section, when we present this on a web page!</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>I&rsquo;ve wrapped the orchestration in another function, called </span><span class="c6">weather</span><span>. This gives me the flexibility to call it as a module from my Flask app later, and also to run it directly from the Terminal as </span><span class="c6">python pybloom.py</span><span class="c2">.</span></p><h2 class="c11" id="h.xy2smpxqc9qv"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">def weather():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # Check current weather</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; observation = weather_observation()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; observation.new(HOME_LOCATION)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # observation.set(datetime.now().strftime(DATETIME_STRING), 23, &#39;dummy observation&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; print(observation)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # Set lounge bloom to current temperature</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; lounge_bloom = hue_lamp(hue_lamp_ids[&#39;lounge bloom&#39;])</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;lounge_bloom.set_colour(convert_temp_to_colour(observation.temperature))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # Set den bloom to current temperature</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; den_bloom = hue_lamp(hue_lamp_ids[&#39;den bloom&#39;])</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; den_bloom.set_colour(convert_temp_to_colour(observation.temperature))</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # Log weather observation</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; observation.log()</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # generate new graphs</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; generate_graphs(observation.timestamp)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &#39;Fetched weather&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">weather()</span></p><p class="c0 c4"><span class="c1"></span></p><h2 class="c11" id="h.9a3icrqz6li2"><span class="c22">Keeping secrets</span></h2><p class="c0"><span>Way back when I showed you how I organised the code, I mentioned that I kept sensitive secrets out of the main code. I had global constants for these secrets, which were imported from a separate </span><span class="c6">credentials.py</span><span>&nbsp;file, as structured below. I decided on a simple dictionary with self-evident but unique variable names. Note that both key and values are </span><span class="c12">strings</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c35 c33">credentials.py</span></p><p class="c0"><span class="c1">credentials = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;hue_ip&#39;: &lt;IP address of your Hue Bridge&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;hue_username&#39;: &lt;given by the Hue Bridge on first sync&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;owm_key&#39;: &lt;generated by service on signing up&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &#39;home_location&#39;: &lt;where you live, in the format city, country code&gt;</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.yy9z4mfce1a2"><span>Database utilities</span></h1><p class="c0"><span class="c2">The database is set up automatically on first connection, but the tables within need to be instantiated.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Global libraries and constants</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">import sqlite3</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">DEFAULT_DB = &#39;database.sqlite3&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">All will become clear later!</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">con = db_connect() &nbsp;# connect to the database</span></p><p class="c0"><span class="c1">cur = con.cursor() &nbsp;# instantiate a cursor obj</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Let&rsquo;s connect to the database and start creating our two tables.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Table of Bloom colours</span></p><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span class="c1">colours_sql = &quot;&quot;&quot;</span></p><p class="c0"><span class="c1">CREATE TABLE IF NOT EXISTS colours</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We create here the colours table, using the modifier </span><span class="c6">IF NOT EXISTS</span><span class="c2">&nbsp;to make sure we don&rsquo;t delete a load of data if we accidentally run this script after the system is live.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">id integer PRIMARY KEY,</span></p><p class="c0"><span class="c1">temperature integer UNIQUE,</span></p><p class="c0"><span class="c1">hex_value text NOT NULL</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The three columns created are:</span></p><ul class="c8 lst-kix_t561m010kzjr-0 start"><li class="c0 c3"><span>The primary key, </span><span class="c6">id</span><span>, constrained to be an </span><span class="c1">integer</span></li><li class="c0 c3"><span>The </span><span class="c6">temperature</span><span>, constrained to be </span><span class="c6">unique</span><span class="c2">&nbsp;(as we should never have one temperature associated with more than one hex value)</span></li><li class="c0 c3"><span>The corresponding </span><span class="c6">hex_value</span><span>, which is constrained to be </span><span class="c6">text</span><span class="c2">&nbsp;since SQLite doesn&rsquo;t have a hex data type, and can&rsquo;t not exist if the temperature exists</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The constraints will prevent the code from breaking as I&rsquo;ve not written much error case handling.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">cur.execute(colours_sql)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We need to pre-populate this colours table.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">temp_colours = { &nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 40: &#39;ff0000&#39;, &nbsp;# colour value if temperature is &gt;= than key</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 35: &#39;ff4000&#39;, &nbsp;# note: value is string, not hex</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 30: &#39;ff8000&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 25: &#39;ffbf00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 20: &#39;ffff00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 15: &#39;bfff00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 10: &#39;00ff80&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;5: &#39;00ffbf&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;0: &#39;00ffff&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; -5: &#39;00bfff&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;-10: &#39;0080ff&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;-15: &#39;0040ff&#39;</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>These values are taken from </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.w3schools.com/colors/colors_picker.asp&amp;sa=D&amp;ust=1603647715815000&amp;usg=AOvVaw1vM8s0u0HghBmzr5Z2-yQZ">https://www.w3schools.com/colors/colors_picker.asp</a></span><span>. The hex values are actually strings, even though Python can very happily handle hex natively. This is because the value is intended to be used by the Python RGBxy library, the Python PyGal library, the database and the web page CSS; and neither RGBxy nor SQL can understand hex. String is therefore the common format across all of them.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">colours_sql = &#39;&#39;&#39;INSERT OR IGNORE INTO colours (temperature, hex_value)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUES (?, ?)&#39;&#39;&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>By using the </span><span class="c6">OR IGNORE</span><span>&nbsp;modifier, we can be sure that we&rsquo;re not overwriting any value if the table already exists and the script has been run in error. (I haven&rsquo;t written all </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.codecademy.com/articles/what-is-crud&amp;sa=D&amp;ust=1603647715816000&amp;usg=AOvVaw3JoZrf65QyDbP_qYZcM32k">CRUD</a></span><span>&nbsp;operations as this script is for </span><span class="c12">create</span><span>&nbsp;only; I&rsquo;ll be writing the </span><span class="c12">update</span><span>&nbsp;and </span><span class="c12">delete</span><span class="c2">&nbsp;operations in the main code.) </span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">for temperature, hex_value in temp_colours.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; cur.execute(colours_sql, (temperature, hex_value))</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">The SQLite query above has spaces for two parameters, which we&rsquo;ll pass as we iterate through the temp_colours dictionary. Every key, value pair gets written as a new row.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Table of observations</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">observations_sql = &quot;&quot;&quot;</span></p><p class="c0"><span class="c1">CREATE TABLE IF NOT EXISTS observations (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; id integer PRIMARY KEY,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; timestamp text UNIQUE,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temperature real NOT NULL,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; detailed_status text NOT NULL)&quot;&quot;&quot;</span></p><p class="c0"><span class="c1">cur.execute(observations_sql)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The rows for the table of observations are:</span></p><ul class="c8 lst-kix_t561m010kzjr-0"><li class="c0 c3"><span>The primary key, </span><span class="c6">id</span><span>, constrained to be an </span><span class="c1">integer</span></li><li class="c0 c3"><span>The </span><span class="c6">timestamp</span><span>, constrained to be </span><span class="c6">unique</span><span class="c2">&nbsp;(as we should never be able to make more than one observation simultaneously)</span></li><li class="c0 c3"><span>The corresponding observation values: </span><span class="c6">temperature</span><span>&nbsp;(constrained to be </span><span class="c6">real</span><span>&nbsp;since we want to keep the decimals) and </span><span class="c6">detailed_status</span><span>&nbsp;(constrained to be </span><span class="c6">text</span><span>) </span></li></ul><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span class="c1">con.commit()</span></p><p class="c0"><span class="c1">con.close() &nbsp;# close connection</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Finally, we commit the changes and close the connection.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Utility function to connect to the database</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def db_connect(db_file=DEFAULT_DB):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # create connection to SQLite database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; connection = sqlite3.connect(db_file)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return connection</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Because we only have one place where we declare the database filename, it means all the code remains coherent.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Utility function to get rows from a table</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">def get_rows(table, columns=&#39;*&#39;, **kwargs):</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">To make this utility flexible, it&rsquo;s meant to simplify 3 use cases: </span></p><ol class="c8 lst-kix_6y0i73whe6lv-0 start" start="1"><li class="c0 c3"><span class="c2">Getting all the rows from the table, in which case you don&rsquo;t have to call this function with any further parameters beyond the table name</span></li><li class="c0 c3"><span>Getting only the rows that fulfil a condition described in an optional </span><span class="c12">dictionary</span><span>&nbsp;of keyword arguments (</span><span class="c6">**kwargs</span><span class="c2">) (defaults to no filters)</span></li><li class="c0 c3"><span class="c2">Getting only the named columns (defaults to all columns)</span></li></ol><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">if (table == &#39;colours&#39;) or (table == &#39;observations&#39;):</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Some rudimentary logic to prevent calling for a table that doesn&rsquo;t actually exist, as the code doesn&rsquo;t handle SQLite errors.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">con = db_connect() &nbsp;# connect to the database</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Here we reuse the first utility function to connect to the database. We don&rsquo;t have to remember which database file and where because we&rsquo;re using the utility. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">con.row_factory = sqlite3.Row</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The next statement refactors the output from the queries into a list of dictionaries, which makes it a little easier to access the content. In this list, each item is a row, and each item consists of a dictionary of column name and value pairs. Each row is accessed directly by its index, but each column can be accessed by index or label. So to access the </span><span class="c6">hex_value</span><span>&nbsp;for the first row we use </span><span class="c6">result[0][2]</span><span>&nbsp;or </span><span class="c6">result[0][&#39;hex_value&#39;]</span><span>.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">cur = con.cursor() &nbsp;# instantiate a cursor obj</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Next we instantiate a </span><span class="c12">cursor</span><span class="c2">&nbsp;object, which is SQLite&rsquo;s accessor object. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">rows_sql = &#39;&#39;</span></p><p class="c0"><span class="c1">args = ()</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">If there aren&rsquo;t any keywords passed, then we just want all the rows from the named table, and we don&rsquo;t have to modify the SQLite query further.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">for key, value in kwargs.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; if key == &#39;rows_sql&#39;:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; rows_sql = &#39; &#39; + value</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; elif key == &#39;args&#39;:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; args = value</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>If we do have a rows filter, then we need to insert it into the SQLite query. We expect a simple dictionary of </span><span class="c6">{row_sql: sql, args: (arg1_value, &hellip;)}</span><span class="c2">. This little loop unpacks them. Note: I&rsquo;m relying on the SQL string to be well-formed; the only parsing I&rsquo;m doing is to add a space so that the final SQL query will be well-formed too.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">if rows_sql.count(&#39;?&#39;) != len(args):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; results = &#39;Unexpected number of arguments in row modifier&#39;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Then a simple check to see if we have the same number of arguments as places to put them.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">cur.execute(&#39;SELECT &#39; + columns + &#39; FROM &#39; + table + rows_sql, args)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Now we have everything we need to build our </span><span class="c6">.execute</span><span>&nbsp;command. The first argument is a simple string concatenation to build the full SQL query. The second argument is the tuple of values to be inserted in place of any </span><span class="c6">(?)</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">results = cur.fetchall()</span></p><p class="c0"><span class="c1">con.close() &nbsp;# close connection</span></p><p class="c0"><span class="c1">return results</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>Once we get the results (as a list of dictionaries), we close the connection to the database and return the results.</span></p><p class="c0 c4"><span class="c13"></span></p><h2 class="c11" id="h.h8u3mwby4qzz"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">import sqlite3</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">DEFAULT_DB = &#39;database.sqlite3&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def db_connect(db_file=DEFAULT_DB):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # create connection to SQLite database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; connection = sqlite3.connect(db_file)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return connection</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1"># utility function, handles opening and closing the database connection</span></p><p class="c0"><span class="c1">def get_rows(table, columns=&#39;*&#39;, **kwargs):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; # columns_names should be a string enclosing a tuple of selected columns</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; if (table == &#39;colours&#39;) or (table == &#39;observations&#39;):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; con = db_connect() &nbsp;# connect to the database</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cur = con.cursor() &nbsp;# instantiate a cursor obj</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; con.row_factory = sqlite3.Row</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; rows_sql = &#39;&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; args = ()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; for key, value in kwargs.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if key == &#39;rows_sql&#39;:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rows_sql = &#39; &#39; + value</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif key == &#39;args&#39;:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; args = value</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; if rows_sql.count(&#39;?&#39;) != len(args):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; results = &#39;Unexpected number of arguments in row modifier&#39;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cur.execute(&#39;SELECT &#39; + columns + &#39; FROM &#39; + table + rows_sql, args)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; results = cur.fetchall()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; else:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; results = &#39;invalid table name&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; con.close() &nbsp;# close connection</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return results</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">con = db_connect() &nbsp;# connect to the database</span></p><p class="c0"><span class="c1">cur = con.cursor() &nbsp;# instantiate a cursor obj</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1"># create table of Hue Bloom colours if one doesn&#39;t already exist</span></p><p class="c0"><span class="c1">colours_sql = &quot;&quot;&quot;</span></p><p class="c0"><span class="c1">CREATE TABLE IF NOT EXISTS colours (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; id integer PRIMARY KEY,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temperature integer UNIQUE,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; hex_value text NOT NULL)&quot;&quot;&quot;</span></p><p class="c0"><span class="c1">cur.execute(colours_sql)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1"># create table of weather observations if one doesn&#39;t already exist</span></p><p class="c0"><span class="c1">observations_sql = &quot;&quot;&quot;</span></p><p class="c0"><span class="c1">CREATE TABLE IF NOT EXISTS observations (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; id integer PRIMARY KEY,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; timestamp text UNIQUE,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; temperature real NOT NULL,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; detailed_status text NOT NULL)&quot;&quot;&quot;</span></p><p class="c0"><span class="c1">cur.execute(observations_sql)</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1"># populate Hue colours db with default values if doesn&#39;t already exist</span></p><p class="c0"><span class="c1">temp_colours = { &nbsp;# from https://www.w3schools.com/colors/colors_picker.asp</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 40: &#39;ff0000&#39;, &nbsp;# colour value if temperature is &gt;= than key</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 35: &#39;ff4000&#39;, &nbsp;# note: value is string, not hex</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 30: &#39;ff8000&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 25: &#39;ffbf00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 20: &#39;ffff00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 15: &#39;bfff00&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; 10: &#39;00ff40&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;5: &#39;00ffbf&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;0: &#39;00ffff&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; -5: &#39;00bfff&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;-10: &#39;0080ff&#39;</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">sql = &#39;&#39;&#39;INSERT OR IGNORE INTO colours (temperature, hex_value) </span></p><p class="c0 c28"><span class="c1">&nbsp; &nbsp;VALUES (?, ?)&#39;&#39;&#39;</span></p><p class="c0"><span class="c1">for temperature, hex_value in temp_colours.items():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; cur.execute(sql, (temperature, hex_value))</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">con.commit()</span></p><p class="c0"><span class="c1">con.close() &nbsp;# close connection</span></p><p class="c0 c4"><span class="c1"></span></p><h1 class="c24" id="h.llb34rmqp0cd"><span>T</span><span class="c20">he web server</span></h1><p class="c0"><span class="c2">Part of the rationale for this project is to leverage my burgeoning Python knowledge in as many places as possible. So it seemed sensible to me to try out one of the Python web frameworks for my website. I&rsquo;ve tried Django before, and it seemed quite complicated for my needs, so I went with the simpler Flask to see if it could do what I wanted. And indeed it could.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Setting up the web server with Flask consists of creating some simple initiator scripts. The file structure from earlier lists all the files we need to make. We&rsquo;ll focus on the scripts here, and get to the templates and static resources in the next section.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">./Project/pybloom</span></p><p class="c0"><span class="c1">&#9474;</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; app.py</span></p><p class="c0"><span class="c1">&#9500;&#9472;&#9472; app/</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; __init__.py</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; content.py</span></p><p class="c0"><span class="c1">&#9474; &nbsp; &#9500;&#9472;&#9472; routes.py</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &#9500;&#9472;&#9472; templates/</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &#9474; &nbsp; &#9500;&#9472;&#9472; base.html</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &#9474; &nbsp; &#9500;&#9472;&#9472; index.html</span></p><p class="c0"><span class="c6 c7">&#9474; &nbsp; &#9474; &nbsp; &#9492;&#9472;&#9472; colours.html</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &#9492;&#9472;&#9472; static/</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; favicon.ico</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; brand.svg</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; logo.svg</span></p><p class="c0"><span class="c7 c6">&#9474; &nbsp; &nbsp; &nbsp; &#9500;&#9472;&#9472; bar_graph.svg</span></p><p class="c0"><span class="c6 c21">&#9474; &nbsp; &nbsp; &nbsp; &#9492;&#9472;&#9472; pie_chart.svg</span></p><h2 class="c11" id="h.3rjecaocoywu"><span class="c22">The technologies</span></h2><ul class="c8 lst-kix_bofdqd71d47w-0 start"><li class="c0 c3"><span class="c2">Flask</span></li><li class="c0 c3"><span class="c2">Advanced Python Scheduler</span></li><li class="c0 c3"><span class="c2">HTTP</span></li></ul><h2 class="c11" id="h.o101mbuif3zj"><span class="c22">The code</span></h2><p class="c0"><span class="c13">The app entity</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Flask looks for an </span><span class="c6">app.py</span><span>&nbsp;script in the root of the project directory to tell it where to get the rest of the files. (You can use a different filename, but then you need to declare that in a different </span><span class="c6">.flaskenv</span><span class="c2">&nbsp;variable - why bother.) </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from app import app</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>That&rsquo;s all you need, at least in our simple project.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">A rudimentary CMS</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We&rsquo;ve generated our weather observation data and visualisations in the Python script, but we need a way of declaring them to the web pages. Rather than sprinkling references to filenames and file paths throughout the HTML, I decided to collect them in a content management script.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from db_utils import get_rows</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">We&rsquo;re going to need our helpful database utility, so let&rsquo;s import it first.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def graphs():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; all_graphs = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastday&#39;: &#39;last_day_bar.svg&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastweek&#39;: &#39;last_week_pie.svg&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastmonth&#39;: &#39;last_month_bar.svg&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return all_graphs</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">This function collects all the graphs in one dictionary.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def colours_table():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rows = get_rows(&#39;colours&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return rows</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">This second function fetches our temperature-colour lookup table.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We&rsquo;re using functions to define the content instead of variables because I like to keep variables associated with a single </span><span class="c12">namespace</span><span>&nbsp;- to me it&rsquo;s just cleaner and less prone to error.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c13">Setting up the page routes in python</span></p><p class="c0"><span class="c2">&nbsp;</span></p><p class="c0"><span>Flask takes care of responding to all the HTTP requests with the correct web pages (web serving) and calls them </span><span class="c12">routes</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from flask import render_template</span></p><p class="c0"><span class="c1">from app import app</span></p><p class="c0"><span class="c1">from app import content</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">First let&rsquo;s import all the modules that we&rsquo;re going to need in this routing script.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">CONTENT = content.graphs()</span></p><p class="c0"><span class="c6">COLOURS_TABLE = content.colours_table()</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Second, we have a couple of global variables that tell our pages where to get their data, defined in our CMS.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">@app.route(&#39;/&#39;)</span></p><p class="c0"><span class="c1">@app.route(&#39;/index&#39;)</span></p><p class="c0"><span class="c1">def index():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return render_template(&#39;index.html&#39;, title=&#39;Home&#39;, content=CONTENT)</span></p><p class="c0 c4"><span class="c13"></span></p><p class="c0"><span>Flask uses</span><span class="c12">&nbsp;function decorators</span><span>&nbsp;to associate HTTP requests with HTML files. These statements are saying that if the web server receives a request for </span><span class="c6">&lt;IP address of server:5000&gt;/</span><span>&nbsp;or </span><span class="c6">&lt;IP address of server:5000&gt;/index</span><span>&nbsp;it should render the </span><span class="c6">index.html</span><span class="c2">&nbsp;file. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Additionally, the</span><span class="c6">&nbsp;render_template()</span><span class="c2">&nbsp;method passes a couple of parameters into the file in order to complete its rendering, the title of the page and the graph content.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">@app.route(&#39;/colours&#39;)</span></p><p class="c0"><span class="c1">def colours():</span></p><p class="c0"><span class="c6">&nbsp; &nbsp; return render_template(&#39;colours.html&#39;, title=&#39;Colours&#39;, rows=COLOURS_TABLE)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">&lt;IP address of server:5000&gt;/colours</span><span>&nbsp;takes us to the </span><span class="c6">colours.html</span><span>&nbsp;page. &nbsp;Again &nbsp;the</span><span class="c6">&nbsp;render_template()</span><span class="c2">&nbsp;method passes a couple of parameters as defined in the CMS. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">@app.after_request</span></p><p class="c0"><span class="c1">def after_request_func(response):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; response.headers[&#39;Cache-Control&#39;] = &#39;no-store&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return response</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">While testing, I noticed that the graphs were old, and that refreshing the page just re-showed the old graphs. I figured that the browser was serving a cached page, but as the data refreshes every 10 minutes, the page was old. Furthermore, clicking on the refresh button in modern browsers just re-fetches the same page from the browser cache. In order to force the browser to re-send its HTTP request, I need to make sure the HTTP response indicates that the browser should not store the page.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Let&rsquo;s unpick this final decorator:</span></p><ul class="c8 lst-kix_gtg4eczq4yk-0 start"><li class="c0 c3"><span class="c6">@app.after_request</span><span class="c2">&nbsp;: tells Flask that this function is to be called after every web page request is responded to</span></li><li class="c0 c3"><span class="c6">after_request_func(response)</span><span>&nbsp;: works on Flask&rsquo;s internal </span><span class="c6">response</span><span class="c2">&nbsp;object, which normally you wouldn&rsquo;t interact with directly</span></li><li class="c0 c3"><span class="c6">response.headers[&#39;Cache-Control&#39;] = &#39;no-store&#39;</span><span class="c2">&nbsp;: this adds a new header to the HTTP response which tells the browser not to cache the page</span></li></ul><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c13">Initialising and running the code </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We now have two processes that need to run simultaneously: the web server, and fetching the observations. There&rsquo;s a library that makes the scheduling straightforward:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">from apscheduler.schedulers.background import BackgroundScheduler</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The Advanced Python Scheduler has a background scheduling function that is perfect for my needs.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">schedule = BackgroundScheduler(daemon=True)</span></p><p class="c0"><span class="c1">schedule.add_job(lambda: weather(), &#39;interval&#39;, minutes=10)</span></p><p class="c0"><span class="c1">schedule.start()</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We instantiate a schedule object as a </span><span class="c12">daemon</span><span>, which means it closes once it finishes (contrast with a </span><span class="c12">thread</span><span>&nbsp;that just keeps going). The job itself is a</span><span class="c12">&nbsp;lambda function</span><span>&nbsp;that calls the </span><span class="c6">weather</span><span>&nbsp;function every 10 minutes. (We should remember to import this function with </span><span class="c6">from pybloom import weather </span><span class="c2">at the top of the file.)</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">from flask import Flask</span></p><p class="c0"><span class="c1">app = Flask(__name__)</span></p><p class="c0"><span class="c1">from app import routes</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The remaining initialisation command tells Flask what the app is, and where it can find the routing.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>In dev, I&rsquo;m using the same machine to run the server as to browse it, so the correct command is </span><span class="c6">flask run</span><span class="c2">. By default, this runs a server in the localhost, so isn&rsquo;t accessible outside of the dev machine. However, in prod, I want the RPi to serve the site to other browsers to view it, so the correct command is:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">flask run --host=0.0.0.0</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>To access the site, point the browser to </span><span class="c6">http://&lt;IP address of RPi&gt;:5000/ </span><span class="c2">(specify the port, otherwise the RPi will reject the connection to the browser).</span></p><h2 class="c11" id="h.2r1uunukvwb3"><span class="c22">Putting it together</span></h2><p class="c0 c4"><span class="c31"></span></p><p class="c0"><span class="c31">app.py</span></p><p class="c0"><span class="c1">from app import app</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c31"></span></p><p class="c0"><span class="c31">_init_py</span></p><p class="c0"><span class="c1">from flask import Flask</span></p><p class="c0"><span class="c1">app = Flask(__name__)</span></p><p class="c0"><span class="c1">from app import routes</span></p><p class="c0"><span class="c1">from apscheduler.schedulers.background import BackgroundScheduler</span></p><p class="c0"><span class="c1">from pybloom import weather</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">schedule = BackgroundScheduler(daemon=True)</span></p><p class="c0"><span class="c1">schedule.add_job(lambda: weather(), &#39;interval&#39;, minutes=10)</span></p><p class="c0"><span class="c1">schedule.start()</span></p><p class="c0 c4"><span class="c31"></span></p><p class="c0 c4"><span class="c31"></span></p><p class="c0"><span class="c31">routes.py</span></p><p class="c0"><span class="c1">from flask import render_template</span></p><p class="c0"><span class="c1">from app import app</span></p><p class="c0"><span class="c1">from app import content</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">CONTENT = content.graphs()</span></p><p class="c0"><span class="c1">COLOURS_TABLE = content.colours_table()</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">@app.route(&#39;/&#39;)</span></p><p class="c0"><span class="c1">@app.route(&#39;/index&#39;)</span></p><p class="c0"><span class="c1">def index():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return render_template(&#39;index.html&#39;, title=&#39;Home&#39;, content=CONTENT)</span></p><p class="c0"><span class="c1">@app.route(&#39;/colours&#39;)</span></p><p class="c0"><span class="c1">def colours():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return render_template(&#39;colours.html&#39;, title=&#39;Colours&#39;, rows=COLOURS_TABLE)</span></p><p class="c0"><span class="c1">@app.after_request</span></p><p class="c0"><span class="c1">def after_request_func(response):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; response.headers[&#39;Cache-Control&#39;] = &#39;no-store&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return response</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c33 c35">content.py</span></p><p class="c0"><span class="c1">from db_utils import get_rows</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def graphs():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; all_graphs = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastday&#39;: &#39;last_day_bar.svg&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastweek&#39;: &#39;last_week_pie.svg&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;lastmonth&#39;: &#39;last_month_bar.svg&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return all_graphs</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">def colours_table():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rows = get_rows(&#39;colours&#39;)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return rows</span></p><p class="c0 c4"><span class="c1"></span></p><h1 class="c24" id="h.qatuwk9gg56c"><span>T</span><span class="c20">he web pages</span></h1><p class="c0"><span class="c2">In the previous section, we&rsquo;ve seen how to build the structure of the web app in Flask. After creating the app package, we then need to work on the HTML of the page. Finally, we&rsquo;ll need to add the CSS that styles the page. To do this, the web page is written in HTML5 and CSS3, but with two scripting languages to simplify: Jinja2 for the HTML rendered by Flask, and Bootstrap CSS. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>I haven&rsquo;t discussed CSS yet, so let&rsquo;s take a detour there. I&rsquo;m a big fan of frameworks and not bothering to recreate (learn again) from first principles. The most comprehensive framework that I&rsquo;ve come across for CSS is </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://getbootstrap.com/docs/4.5/getting-started/introduction/&amp;sa=D&amp;ust=1603647715852000&amp;usg=AOvVaw28T2Gp3XbYOaWaR4A0JCBR">Bootstrap</a></span><span class="c2">&nbsp;from Twitter. It takes care of making the page responsive, mobile-friendly with predefined styles, without the need to create the CSS from scratch. It&rsquo;s a scripting language, so there is a need to learn its vocabulary which is invoked in the HTML attributes.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The structure of the HTML makes use of inheritance. There&rsquo;s a </span><span class="c6">base.html </span><span>that declares all the common elements, such as declaring how the Bootstrap components are downloaded from the CDN, and also the navigation elements that are common for all pages. Each subsequent page extends this </span><span class="c6">base.html</span><span class="c2">&nbsp;page, to add the actual content and other custom CSS.</span></p><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.i0jzs054uczh"><span class="c22">Technologies</span></h2><ul class="c8 lst-kix_uzoy1gxgh4yr-0 start"><li class="c0 c3"><span class="c2">HTML5, CSS3</span></li><li class="c0 c3"><span class="c2">Jinja2</span></li><li class="c0 c3"><span class="c2">Bootstrap CSS</span></li></ul><h2 class="c11" id="h.qaskr4rah7xh"><span class="c22">The code</span></h2><p class="c0"><span class="c31">base.html - head </span></p><p class="c0 c4"><span class="c31"></span></p><p class="c0"><span class="c1">&lt;!DOCTYPE html&gt;</span></p><p class="c0"><span class="c1">&lt;html lang=&quot;en&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;head&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta charset=&quot;UTF-8&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">So far so familiar. All HTML starts with these tags.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This is the first tag required by Bootstrap.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c28"><span class="c40 c43">&ldquo;Bootstrap is developed mobile first, a strategy in which we optimize code for mobile devices first and then scale up components as necessary using CSS media queries. To ensure proper rendering and touch zooming for all devices, add the responsive viewport meta tag to your &lt;head&gt;.&rdquo;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% if title %}</span></p><p class="c0"><span class="c1">&lt;title&gt;{{ title }} - PyBloom&lt;/title&gt;</span></p><p class="c0"><span class="c1">{% else %}</span></p><p class="c0"><span class="c1">&lt;title&gt;Welcome to PyBloom&lt;/title&gt;</span></p><p class="c0"><span class="c1">{% endif %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Next we have a bit of Jinja2 logic to define the title. All this is saying is: if the variable </span><span class="c6">title</span><span>&nbsp;is passed into the HTML according to the </span><span class="c6">routes.py</span><span class="c2">&nbsp;then the title is put into the metadata. If not, a default title is used. To be honest, I probably won&rsquo;t invoke this logic, but it&rsquo;s there if needed in the future.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;!-- Bootstrap v5 CSS CDN --&gt;</span></p><p class="c0"><span class="c1">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css&quot; integrity=&quot;sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK&quot; crossorigin=&quot;anonymous&quot;&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&lt;!-- Bootstrap JavaScript Bundle with Popper.js --&gt;</span></p><p class="c0"><span class="c1">&lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-BOsAfwzjNJHrJ8cZidOg56tcQWfp6y72vEJ8xQ9w6Quywb24iOsW913URv1IS4GD&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>These tags are needed in order to download Bootstrap from the CDN, avoiding the need to download potentially out of date components. These first </span><span class="c6">&lt;link&gt;</span><span>&nbsp;and </span><span class="c6">&lt;script&gt;</span><span class="c2">&nbsp;tags specify the version of Bootstrap CSS and Bootstrap JavaScript to be downloaded from the CDN. I&rsquo;m using Bootstrap v5 which is in alpha at time of writing. I&rsquo;ll clearly need to update this to the release version at some point (and hope that nothing breaks in the meantime).</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">I thought of defining these URLs in my rudimentary CMS, but decided against it because 1) sometimes Bootstrap classes only work with certain versions (e.g. the naming is not backwards compatible across major versions) so it&rsquo;s better to reference a fixed snapshot; and 2) the complete statement is quite complex, so I can eliminate transposing errors by copying directly from the Bootstrap documentation. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% block app_css %}{% endblock %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This little bit of Jinja2 specifies a block where the custom CSS needed later will go.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&lt;link rel=&quot;shortcut icon&quot; href=&quot;{{ url_for(&#39;static&#39;, filename=&#39;favicon.ico&#39;) }}&quot;&gt;</span></p><p class="c0"><span class="c1">&lt;/head&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Every website also displays a little icon in the top left of the browser tab. This last link is a combination of HTML and the very useful Jinja2 function </span><span class="c6">url_for()</span><span>&nbsp;to tell the browser where to locate this icon file. This function concatenates the absolute file path for the static folder with the filename, and inserts into the tag </span><span class="c6">href</span><span class="c2">&nbsp;attribute. We&rsquo;ll use it a lot in the HTML, as it avoids hard coding file paths very nicely.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>And that&rsquo;s it for the head, so we close with the </span><span class="c6">&lt;/head&gt;</span><span class="c2">&nbsp;tag.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c31">base.html - body</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The body HTML is where the Bootstrap scripting goes. The common element across the top of all of my pages will be the navigation bar. Let&rsquo;s get into it!</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;body&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;div class=&quot;container-fluid&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The </span><span class="c12">container</span><span>&nbsp;model is how Bootstrap (and all CSS) describes the elements within a web page. Think of a container as a </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://www.w3schools.com/css/css_boxmodel.asp&amp;sa=D&amp;ust=1603647715858000&amp;usg=AOvVaw0fH-6WC1hxGwlewWbqyp7_">box</a></span><span>&nbsp;that has a margin, border, padding, and finally the content in the centre. By declaring each container as </span><span class="c6">fluid</span><span>, we let the browser resize them to fill up the full screen (the </span><span class="c12">viewport</span><span class="c2">). Resizing, re-flowing and maybe re-factoring functionality in response to the size of the device is the essence of responsive design.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;nav class=&quot;navbar navbar-expand-md navbar-light bg-light&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The container for the navigation bar is the </span><span class="c12">navbar</span><span class="c2">. In the class attribute we give it a few parameters, and Bootstrap magically does the rest of the formatting.</span></p><ul class="c8 lst-kix_py2f4bwpfzpw-0 start"><li class="c0 c3"><span class="c6">navbar-expand-md</span><span>: the navbar will expand when the device is mid-sized; this is the </span><span class="c26 c12 c40">breakpoint</span></li><li class="c0 c3"><span class="c6">N</span><span class="c6">avbar-light</span><span class="c2">: light colour scheme for the navbar elements</span></li><li class="c0 c3"><span class="c6">Bg-light</span><span class="c2">: light colour scheme for the navbar background</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;span class=&quot;navbar-brand&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Bootstrap provides a built-in element type of brand, with a default format that distinguishes it from other navbar elements. By making the brand element in a </span><span class="c6">&lt;span&gt;</span><span>&nbsp;tag, it just sits there and looks pretty. On many websites, you can click on the brand icon and go to an &ldquo;about&rdquo; page. To do this, just put the brand element in an </span><span class="c12">anchor</span><span>&nbsp;</span><span class="c6">&lt;a&gt;</span><span>&nbsp;tag with associated </span><span class="c6">href</span><span class="c2">&nbsp;attribute. I&rsquo;ll use this for the other navbar elements.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=&#39;brand.svg&#39;) }}&quot; height=&quot;30&quot; class=&quot;d-inline-block align-top&quot; alt=&quot;PyBloom&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; PyBloom</span></p><p class="c0"><span class="c1">&lt;/span&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We use the Jinja2 </span><span class="c6">url_for()</span><span>&nbsp;function in order to generate the absolute file path for the brand icon. The Bootstrap attributes of </span><span class="c6">d-inline-block align-top</span><span class="c2">&nbsp;puts the block at the top left. I like this statement as an example of how using these two scripting languages makes generating the HTML and CSS so much more readable.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">&lt;button type=&quot;button&quot; class=&quot;navbar-toggler&quot; data-toggle=&quot;collapse&quot; data-target=&quot;navbarNavItems&quot; aria-expanded=&quot;false&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This toggle button is the key element that enables my responsive design. In smaller screens, smaller than the mid-size breakpoint defined in the parent class above, the screen will not display any of the navbar elements except for the brand and this button. To display the navbar links, you just have to press this button, and the navbar elements are revealed in a column on the left. All the complexity of this design and the interactivity is summarised in these few attributes.</span></p><ul class="c8 lst-kix_ubjpd5qffklj-0 start"><li class="c0 c3"><span class="c6">class=&quot;navbar-toggler&quot;</span><span class="c2">: declares to Bootstrap that this button is the one that toggles the navbar in smaller screens</span></li><li class="c0 c3"><span class="c6">data-toggle=&quot;collapse&quot;</span><span class="c2">: clicking the button collapses the content</span></li><li class="c0 c3"><span class="c6">data-target=&quot;navbarNavItems&quot;</span><span>: links to the items in the navbar that will be collapsed/ expanded; the toggled menu bar will look for an element that has ID=</span><span class="c6">navbarNavItems</span><span class="c2">&nbsp;</span></li><li class="c0 c3"><span class="c6">Aria-expanded=&quot;false&quot;</span><span class="c2">: sets the current behaviour (i.e. when page is loaded)</span></li></ul><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span></p><p class="c0"><span class="c1">&lt;/button&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">Because we need pretty icons everywhere, here&rsquo;s an icon for the toggle button.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarNavItems&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This class contains all the remaining navbar elements, and is the subject of the toggle button. When clicking on these elements, you&rsquo;ll be taken to the web page. Bootstrap handles this subset of elements as a navbar in its own right, inheriting properties from the parent navbar.</span></p><ul class="c8 lst-kix_25plgfjdzvww-0 start"><li class="c0 c3"><span class="c6">collapse</span><span class="c2">: sets the behaviour to collapse this navbar on selection</span></li><li class="c0 c3"><span class="c6">navbar-collapse</span><span class="c2">: sets this navbar as the parent breakpoint for the collapse/ expand behaviour</span></li><li class="c0 c3"><span class="c6">id=&quot;navbarNavItems&quot;</span><span class="c2">: connects this sub-navbar to the toggle button</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;div class=&quot;navbar-nav mr-auto&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This division groups all the sub-navbar elements together. </span></p><ul class="c8 lst-kix_6an29lgub9tb-0 start"><li class="c0 c3"><span class="c6">navbar-nav</span><span>: these elements are of the type </span><span class="c12">nav</span><span class="c2">, and will be styled as such</span></li><li class="c0 c3"><span class="c6">mr-auto</span><span>: the nav items </span><span class="c29">after</span><span class="c2">&nbsp;this group of elements will be pushed to the right side of the viewport, with the padding automatically calculated</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;a class=&quot;nav-link&quot; href=&quot;{{ url_for(&#39;index&#39;) }}&quot;&gt;Weather Station&lt;/a&gt;</span></p><p class="c0"><span class="c1">&lt;/li&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Here is our first nav item, the actual element that takes us to the subsequent pages. The container for the element, and the content of element (the link) are styled differently, which is why we have two nested items. The container is simply declared to Bootstrap as a </span><span class="c6">nav-item</span><span class="c2">. The link itself is styled in a combination of Jinja2 and Bootstrap.</span></p><ul class="c8 lst-kix_5lajacp8xtx-0 start"><li class="c0 c3"><span>Bootstrap parameters </span><span class="c6">nav-link</span><span class="c2">: declares to Bootstrap as a link object, which won&rsquo;t look active until the mouse hovers over it</span></li><li class="c0 c3"><span>Jinja2 script </span><span class="c6">{{ url_for(&#39;index&#39;) }}</span><span>: builds the absolute file path to the target page, in this case the </span><span class="c6">index.html</span><span class="c2">&nbsp;page</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;a class=&quot;nav-link&quot; href=&quot;{{ url_for(&#39;colours&#39;) }}&quot;&gt;Colour Key&lt;/a&gt;</span></p><p class="c0"><span class="c1">&lt;/li&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The second nav item is similar to the first, except we have Jinja2 reference the </span><span class="c6">colours.html</span><span class="c2">&nbsp;file.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;div class=&quot;navbar-nav navbar-right&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;a class=&quot;nav-link&quot; href=&quot;https://blog.mindrocketnow.com&quot;&gt;Home&lt;/a&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;/li&gt;</span></p><p class="c0"><span class="c1">&lt;/div&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Finally, we have a home link on the right side of the navbar. The construction is very similar to the previous nav items, except it&rsquo;s a shameless plug for my blog.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;!-- This is where the page content will go --&gt;</span></p><p class="c0"><span class="c1">{% block app_content %}{% endblock %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&lt;!-- Space for custom JS --&gt;</span></p><p class="c0"><span class="c1">{% block app_js %}{% endblock %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We end the base.html by provisioning a couple of slots to be extended by page-specific HTML and CSS content.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c31">index.html</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The hard work of styling each page is done in the </span><span class="c6">base.html</span><span class="c2">&nbsp;document. For each of the subsequent pages, we simply have to extend it with a small amount of additional HTML.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% extends &quot;base.html&quot; %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This Jinja2 sippet does exactly that, without needing to know the file path.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% block app_content %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This header tells Jinja2 where to insert the subsequent code to make up the full page code.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;h1&gt;Latest data&lt;/h1&gt;</span></p><p class="c0"><span class="c1">&lt;div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;h2&gt;Last 24 hours&lt;/h2&gt;</span></p><p class="c0"><span class="c6">&nbsp; &lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=content[&#39;lastday&#39;]) }}&quot; class=&quot;img-fluid&quot; alt=&quot;Temperature over last day&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;h2&gt;Last week&lt;/h2&gt;</span></p><p class="c0"><span class="c1">&lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=content[&#39;lastweek&#39;]) }}&quot; class=&quot;img-fluid&quot; alt=&quot;Temperature over last week&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>As before, we use a combination of Jinja2 and Bootstrap to define and style the image elements. The Jinja2 snippet references the file that was declared in the rudimentary CMS (</span><span class="c6">content.py</span><span class="c2">) so that the image source points to the right graph. Bootstrap styles this as a fluid image.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">{% endblock %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">After closing the division, we also need to close the block.</span></p><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.b2qhmp33qhjx"><span class="c22">Putting it together</span></h2><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c31">base.html</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&lt;!DOCTYPE html&gt;</span></p><p class="c0"><span class="c1">&lt;html lang=&quot;en&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;head&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta charset=&quot;UTF-8&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- A little Jinja2 logic to choose page title --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% if title %}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;title&gt;{{ title }} - PyBloom&lt;/title&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% else %}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;title&gt;Welcome to PyBloom&lt;/title&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% endif %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Bootstrap v5 CSS CDN --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css&quot; integrity=&quot;sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK&quot; crossorigin=&quot;anonymous&quot;&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Space for Custom CSS --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% block app_css %}{% endblock %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Location of favicon --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;link rel=&quot;shortcut icon&quot; href=&quot;{{ url_for(&#39;static&#39;, filename=&#39;favicon.ico&#39;) }}&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;/head&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &lt;body&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Navbar Container --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;div class=&quot;container-fluid&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;!-- Navbar Header [contains both toggle button and navbar brand] --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;nav class=&quot;navbar navbar-expand-md navbar-light bg-light&quot;&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Navbar Brand [image + title, no link] --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;navbar-brand&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=&#39;brand.svg&#39;) }}&quot; height=&quot;30&quot; class=&quot;d-inline-block align-top&quot; alt=&quot;PyBloom&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PyBloom</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/span&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Toggle Button [handles opening navbar components on mobile screens] --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;navbar-toggler&quot; data-toggle=&quot;collapse&quot; data-target=&quot;navbarNavItems&quot; aria-expanded&quot;false&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Navbar Collapse [contains all other navbar components] --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarNavItems&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Navbar Menu --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;navbar-nav mr-auto&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a class=&quot;nav-link&quot; href=&quot;{{ url_for(&#39;index&#39;) }}&quot;&gt;Weather Station&lt;/a&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/li&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a class=&quot;nav-link&quot; href=&quot;{{ url_for(&#39;colours&#39;) }}&quot;&gt;Colour Key&lt;/a&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/li&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- a plug for my blog! --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;navbar-nav navbar-right&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;nav-item&quot;&gt;</span></p><p class="c0"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a class=&quot;nav-link&quot; &nbsp;href=&quot;</span><span class="c19 c6"><a class="c10" href="https://www.google.com/url?q=https://blog.mindrocketnow.com&amp;sa=D&amp;ust=1603647715874000&amp;usg=AOvVaw0oaX_hCjIH5JSdwapnI45R">https://blog.mindrocketnow.com</a></span><span class="c1">&quot;&gt;Home&lt;/a&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/li&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;/nav&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- This is where the page content will go --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% block app_content %}{% endblock %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Bootstrap JavaScript Bundle with Popper.js --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-BOsAfwzjNJHrJ8cZidOg56tcQWfp6y72vEJ8xQ9w6Quywb24iOsW913URv1IS4GD&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Space for custom JS --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% block app_js %}{% endblock %}</span></p><p class="c0"><span class="c1">&nbsp; &lt;/body&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c31">index.html</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">{% extends &quot;base.html&quot; %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">{% block app_content %}</span></p><p class="c0"><span class="c1">&nbsp; &lt;h1&gt;Latest data&lt;/h1&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;h2&gt;Last 24 hours&lt;/h2&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=content[&#39;lastday&#39;]) }}&quot; class=&quot;img-fluid&quot; alt=&quot;Responsive image&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;h2&gt;Last week&lt;/h2&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=content[&#39;lastweek&#39;]) }}&quot; class=&quot;img-fluid&quot; alt=&quot;Responsive image&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">{% endblock %}</span></p><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.g9ivfrwbvxd9"><span class="c20">Colour picker utility</span></h1><p class="c0"><span class="c2">My stretch target was to display a table of all the colours of the Bloom lamp on a page in the website. As we&#39;ve seen, the colours are in a persistent SQLite table, so all I have to do is to extract from the table, and somehow get the CSS to read the colour information. Except CSS is not an interactive language, so I needed another technology. Step forward JavaScript.</span></p><h2 class="c11" id="h.2jfw7pe75rrh"><span class="c22">The technologies</span></h2><ul class="c8 lst-kix_76zx3u59ad6i-0 start"><li class="c0 c3"><span class="c2">HTML</span></li><li class="c0 c3"><span class="c2">JavaScript</span></li><li class="c0 c3"><span class="c2">Jinja2</span></li></ul><h2 class="c11" id="h.2jfw7pe75rrh-1"><span class="c22">The code</span></h2><p class="c0"><span class="c1">{% extends &quot;base.html&quot; %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We put all the main styling into the base page, which means as before, we simply need to extend it here.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% block app_content %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This HTML section will be inserted into the </span><span class="c6">base.html</span><span>&nbsp;template at the position marked </span><span class="c6">app_content</span><span class="c2">.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">&lt;table class=&quot;table&quot;&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We&rsquo;re making use of the Bootstrap formatting for tables to make things pretty. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;th scope=&quot;col&quot;&gt;Temperature&lt;/th&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;th scope=&quot;col&quot;&gt;Colour&lt;/th&gt;</span></p><p class="c0"><span class="c1">&lt;/tr&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The table consists of two columns: one for Temperature and one for the corresponding Bloom colour.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% for row in rows %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">This is our familiar Jinja2 loop, which we want to repeat for every row in the temperature conversion lookup table.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;td&gt;{{row[1]}}&lt;/td&gt;</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c2">The first cell in the row is simply the value of temperature from the lookup table.</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &lt;td id=&quot;{{row[2]}}&quot;&gt;{{row[2]}}&lt;/td&gt;</span></p><p class="c0"><span class="c1">&lt;/tr&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The second cell is the value of the colour, a hex string. This same string is also used to identify the cell. Each cell will have its own background colour, so needs to be uniquely identified. We&rsquo;ll implement this logic with a small bit of JavaScript, so let&rsquo;s jump straight into it.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% block app_js %}</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">As with the inserted HTML, this identifies where the custom JavaScript goes. Order is important in placing JavaScript; as this overrides the Bootstrap JavaScript, the block is after the statement that pulls Bootstrap from the CDN.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">&lt;script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &quot;use strict&quot;;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This is the normal preamble for JavaScript. Unlike CSS, as of HTML5 there&rsquo;s no need to define </span><span class="c6">type=&quot;text/javascript&quot;</span><span>&nbsp;as no other types are allowed. The second </span><span class="c6">&quot;use strict&quot;</span><span class="c2">&nbsp;command instructs the browser to use the modern (ECMAScript5 from 2009) interpreter. This is important as some commands will not work in an older interpreter, and some commands will work differently. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">{% for row in rows %}</span></p><p class="c0"><span class="c1">&nbsp; document.getElementById(&quot;{{row[2]}}&quot;).style.background = &quot;#&quot;+&quot;{{row[2]}}&quot;;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">We can use the same Jinja2 loop structure to set the background for each hex value cell in our table. But because each iteration of the loop creates another persistent row in the JavaScript, we need to be careful not to use variables as these would simply overwrite the previous. That&rsquo;s why we have this complicated command that chains a lot of functions. Let&rsquo;s pick it apart.</span></p><ul class="c8 lst-kix_m9cxbjaluxza-0 start"><li class="c0 c3"><span class="c6">document.getElementById()</span><span class="c2">: We assigned a unique ID for each table cell containing a hex value</span></li><li class="c0 c3"><span class="c6">&quot;{{row[2]}}&quot;</span><span class="c2">: This unique ID is the hex value string</span></li><li class="c0 c3"><span class="c6">style.background</span><span>: JavaScript accesses the cell colour using this method (which is slightly different to the CSS attribute of </span><span class="c6">background-color</span><span class="c2">)</span></li><li class="c0 c3"><span class="c6">= &quot;#&quot;+&quot;{{row[2]}}&quot;</span><span class="c2">: The colour is the hex value from the lookup table, which is a string (as accepted by the SQLite database), but has to be prefixed with a hash to identify it as a hex string</span></li><li class="c0 c3"><span class="c6">; </span><span class="c2">Don&rsquo;t forget to finish every JavaScript statement with a semicolon - which isn&rsquo;t required in Python or CSS or SQLite</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The table now pulls the Hue bloom colour data from the external SQLite table and displays on a web page.</span></p><h2 class="c11" id="h.bwuar4qfi90j"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c1">{% extends &quot;base.html&quot; %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">{% block app_content %}</span></p><p class="c0"><span class="c1">&nbsp; &lt;h1&gt;Colour key&lt;/h1&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;table class=&quot;table&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;th scope=&quot;col&quot;&gt;Temperature&lt;/th&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;th scope=&quot;col&quot;&gt;Colour&lt;/th&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;/tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; {% for row in rows %}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;{{row[1]}}&lt;/td&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;td id=&quot;{{row[2]}}&quot;&gt;{{row[2]}}&lt;/td&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;/tr&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; {% endfor %}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;/table&gt;</span></p><p class="c0"><span class="c1">&nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">{% endblock %}</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span class="c1">{% block app_js %}</span></p><p class="c0"><span class="c1">&nbsp; &lt;script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;use strict&quot;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% for row in rows %}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; document.getElementById(&quot;{{row[2]}}&quot;).style.background = &quot;#&quot;+&quot;{{row[2]}}&quot;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; {% endfor %}</span></p><p class="c0"><span class="c1">&nbsp; &lt;/script&gt;</span></p><p class="c0"><span class="c6">{% endblock %}</span></p><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.l5n7ar3owa8i"><span class="c20">Conclusions</span></h1><p class="c0"><span class="c2">This project has been quite a learning experience. I&rsquo;ve had to get to grips with a lot of technologies, a lot of frameworks, and quite a learning curve. Here are some top tips:</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_h6b3e0fu5msk-0 start"><li class="c0 c3"><span class="c2">No matter how clear the tutorials, the code never works first time. Learn by testing.</span></li><li class="c0 c3"><span class="c2">Google and YouTube are great resources for finding how to do things, but relies on being able to ask the right question. Be clear on precisely what the problem is.</span></li><li class="c0 c3"><span class="c2">Having to describe everything here has really helped reinforce the learnings. </span></li><li class="c0 c3"><span class="c2">There&rsquo;s always another feature to think up and implement. But it&rsquo;s important to be clear when done=done, and the program is good enough to be used.</span></li><li class="c0 c3"><span class="c2">Good enough to be used by you isn&rsquo;t the same as good enough for someone else. If you want to roll out the program, have it tested by someone that doesn&rsquo;t know it.</span></li></ul><h2 class="c11" id="h.lywmsmnoc6a8"><span class="c22">Even better if&hellip;</span></h2><p class="c0"><span>Over the course of this document, I&rsquo;ve described how I&rsquo;ve implemented the features of my program. It&rsquo;s doing what I intended it to do, the lights are showing how the evenings are getting colder. It&rsquo;s fine for personal consumption, but it wouldn&rsquo;t be fine for others to use. Before going into new features, I should look at </span><span class="c12">operationalising</span><span class="c2">&nbsp;the code, which will be a whole different set of challenges:</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_w784fo642qqt-0 start"><li class="c0 c3"><span>The program should be </span><span class="c12">available</span><span class="c2">&nbsp;(to an acceptable service level), which means it should be deployed onto a hosted site. </span></li><li class="c0 c3"><span>I&rsquo;ve done precious little formal </span><span class="c12">testing</span><span>. At least, operationalised code should have a testing approach consisting of: test data, test cases, expected results. At best, these tests should be completed automatically, as the code is promoted from dev to prod. This is the basis of </span><span class="c12">continuous deployment</span><span class="c2">.</span></li><li class="c0 c3"><span class="c2">Operational tools: manual CRUD access to the databases - because I built in a way of manually adding data, but didn&rsquo;t build a way to remove it.</span></li><li class="c0 c3"><span>We should keep track of </span><span class="c12">versions</span><span class="c2">, not just to roll back in case of emergency, but to keep track of features in dev that haven&rsquo;t quite made it to prod, which means integrating with Git and GitHub. Let&rsquo;s look at this last point in a bit of detail.</span></li></ul><p class="c0 c4"><span class="c2"></span></p><h1 class="c24" id="h.5thd2yiwvzjn"><span class="c20">Integrating with Git and GitHub for version control</span></h1><p class="c0"><span class="c2">Once you start, you can&rsquo;t stop tinkering. At some point, something is going to break. So as I intend to keep this code going for a while, I implemented version control with Git. This is a feature-rich version control system, and takes care of the steps in promoting the code you&rsquo;re tinkering with to code that&rsquo;s ready to publish. Finally, it also integrates nicely with the GitHub service on the web where you can share your code, and pushing to remote repositories such as on my Raspberry Pi. No more cutting and pasting and associated typos.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Once completed, the setup will look like this:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c40 c26 c12">Atom [UI for] -&gt; Git [local version control] &lt;-&gt; GitHub [remote version control]</span></p><h2 class="c11" id="h.qd9pr78srqnk"><span class="c22">Spikes</span></h2><p class="c0"><span class="c2">Figuring this out took a lot of searching, as I didn&rsquo;t find the documentation particularly enlightening. Here&rsquo;s recommended reading.</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_j73bfzta9g61-0 start"><li class="c0 c3"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://doane-ccla.gitbook.io/docs/git-version-control/git-workflow-github&amp;sa=D&amp;ust=1603647715887000&amp;usg=AOvVaw1IylsM-koW18SD7IlxtGvf">Git and Atom and GitHub</a></span></li><li class="c0 c3"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://docs.github.com/en/free-pro-team@latest/github/using-git/about-remote-repositories&amp;sa=D&amp;ust=1603647715887000&amp;usg=AOvVaw1IJpmlu1sxPEsiaXWDXGq6">About remote repositories</a></span><span>&nbsp;</span></li><li class="c0 c3"><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://projects.raspberrypi.org/en/projects/getting-started-with-git&amp;sa=D&amp;ust=1603647715888000&amp;usg=AOvVaw08YrzZZdCHUIUYQs04qU7Z">Getting started with Git and Raspberry Pi</a></span><span class="c2">&nbsp;</span></li></ul><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.fzfhbgw930w3"><span class="c22">Setting up Git, GitHub and Atom</span></h2><p class="c0"><span class="c2">Git was already installed in my Mac, and is part of Atom by default. So no need to install anything more. But there is a lot of other setting up to be done. </span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Before making the first Git push, I set up the files to ignore by adding the following items to my </span><span class="c6">.gitignore</span><span>&nbsp;file. These are: the environment files that are set up by the system; or data files that are created at run time; or personal information that I don&rsquo;t want you to see! Note the </span><span class="c6">**/</span><span class="c2">&nbsp;syntax which forces the file to be ignored from all subfolders.</span></p><p class="c0 c4"><span class="c31"></span></p><ul class="c8 lst-kix_qkzlw47atwrv-0 start"><li class="c0 c3"><span class="c6">__pycache__* </span><span class="c2">: used by Python runtime </span></li><li class="c0 c3"><span class="c6">Icon*, **/*.DS_Store</span><span class="c2">&nbsp;: hidden files used by macOS</span></li><li class="c0 c3"><span class="c6">.git</span><span>&nbsp;: hidden files used by Git</span></li><li class="c0 c3"><span class="c6">*_old</span><span>&nbsp;: a useful way of hiding files you might be tinkering way </span></li><li class="c0 c3"><span class="c6">credentials.py</span><span class="c2">&nbsp;: secrets needed for the API</span></li><li class="c0 c3"><span class="c6">**/*_bar.svg, **/*_pie.svg</span><span class="c2">&nbsp;: these graphs are made from the data at run time</span></li><li class="c0 c3"><span class="c6">database.sqlite3</span><span>&nbsp;: created by the main code on first connection and updated at run time</span></li></ul><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Next up is to create the target repository on GitHub. This is done by logging into the GitHub dashboard, and creating a new repository from there. Mine is called </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://github.com/Schmoiger/pybloom&amp;sa=D&amp;ust=1603647715889000&amp;usg=AOvVaw3_Lel1FE4iaknSdtNRTTgV">https://github.com/Schmoiger/pybloom</a></span><span class="c2">&nbsp;and I encourage you to go have a look there.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Git (the local repository) needs to know this GitHub (remote repository) URL, so the next step is to add it to the Git config. This is done from Terminal, using the following command:</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">git remote add origin </span><span class="c6">https://github.com/</span><span class="c1">&lt;your username&gt;/&lt;your app name&gt;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>This command associates the name </span><span class="c6">origin</span><span>&nbsp;to the remote repository URL, which makes management within Git and Atom a little easier. (If you&rsquo;re so inclined, you could instead </span><span class="c12">clone</span><span class="c2">&nbsp;my repo instead, and work on my code. We&rsquo;ll do this in the next section on setting up the Raspberry Pi) Now we&rsquo;ve told Git where your remote repository is, we&rsquo;ve got to tell who you are, so that Git can tell GitHub. In other words, we have to set up your email address in Git to be accepted by GitHub as an authenticated user.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">git config --global user.email &quot;email@example.com&quot;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">The email address is the one set up in GitHub. It doesn&rsquo;t have to be a real address; GitHub will set up a &ldquo;noreply&rdquo; email for you if you wish.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>We don&rsquo;t configure the password in the same way. Instead, if you now boot Atom you should see a login window in the GitHub pane. This asks for the login token, which you&rsquo;ll need to get from </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://github.atom.io/login&amp;sa=D&amp;ust=1603647715891000&amp;usg=AOvVaw3iyvp84PNJPCDDG4AAp-HM">https://github.atom.io/login</a></span><span class="c2">, then paste into Atom.</span></p><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.504mvcgehqb"><span class="c22">Setting up the Raspberry Pi</span></h2><p class="c0"><span class="c2">Git comes pre-installed in Raspberry Pi OS, so no further installation necessary. But as with the Mac, there is configuration to be done.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c1">git config --global user.name &quot;&lt;your username&gt;&quot;</span></p><p class="c0"><span class="c1">git config --global user.email &quot;&lt;your email&gt;&quot;</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">First step is to tell the git instance on the RPi who you are. By now everyone has hundreds of username/ email combinations. Rather than creating another one, I&rsquo;m re-using my GitHub identity.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c6">git clone </span><span class="c6">https://github.com/Schmoiger/pybloom.git</span><span class="c1">&nbsp;Projects</span></p><p class="c0 c4"><span class="c1"></span></p><p class="c0"><span>If you&rsquo;re cloning my repo into your </span><span class="c6">Projects</span><span>&nbsp;folder, use the statement above, and a copy of the repo will be cloned into a </span><span class="c6">pybloom</span><span class="c2">&nbsp;subfolder. Otherwise change the url and the destination to suit your own environment.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>The final step is to copy across the</span><span class="c6">&nbsp;credentials.py</span><span>&nbsp;file into the </span><span class="c6">pybloom</span><span class="c2">&nbsp;folder, as it has all your secrets for the API login.</span></p><h2 class="c11" id="h.10ghuwz0zyvf"><span class="c22">Documentation</span></h2><p class="c0"><span class="c2">Arguably, the most important part of the repository is the documentation. I&rsquo;ve created three:</span></p><p class="c0 c4"><span class="c2"></span></p><ul class="c8 lst-kix_qbgeynhpr352-0 start"><li class="c0 c3"><span class="c2">README.md - bite-sized summary of the key things you need to know to use the program</span></li><li class="c0 c3"><span>Blog post - this set of posts (not in GitHub, but on </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://blog.mindrocketnow.com&amp;sa=D&amp;ust=1603647715893000&amp;usg=AOvVaw0_6Yr4vN5ZRyNTuQbtt3xk">https://blog.mindrocketnow.com</a></span><span class="c2">)</span></li><li class="c0 c3"><span class="c2">PyBloom_manual.html - all the post put together into a single document, for convenience</span></li></ul><p class="c0 c4"><span class="c2"></span></p><h2 class="c11" id="h.8vv1nmyjo62o"><span class="c22">Putting it together</span></h2><p class="c0"><span class="c35 c33">.gitignore</span></p><p class="c0"><span class="c1">__pycache__*</span></p><p class="c0"><span class="c1">Icon*</span></p><p class="c0"><span class="c1">.git</span></p><p class="c0"><span class="c1">**/*.DS_Store</span></p><p class="c0"><span class="c1">**/*_bar.svg</span></p><p class="c0"><span class="c1">**/*_pie.svg</span></p><p class="c0"><span class="c1">*_old</span></p><p class="c0"><span class="c1">credentials.py</span></p><p class="c0"><span class="c1">database.sqlite3</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span>Thank you for joining me on this journey. Hope it&rsquo;s been a little help with your own exploration. Also visit </span><span class="c19"><a class="c10" href="https://www.google.com/url?q=https://github.com/Schmoiger/pybloom&amp;sa=D&amp;ust=1603647715894000&amp;usg=AOvVaw0NcI94DnJ6SrquRL-4QV7x">https://github.com/Schmoiger/pybloom</a></span><span class="c2">&nbsp;for the full story. </span></p><p class="c0 c4"><span class="c2"></span></p></div></body></html>